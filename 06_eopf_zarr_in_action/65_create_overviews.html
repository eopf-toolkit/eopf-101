<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Creating Zarr Overviews</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../06_eopf_zarr_in_action/65_reservoir_surface_monitoring.html" rel="next">
<link href="../06_eopf_zarr_in_action/64_flood_mapping_valencia.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-0dd2bd5de344125cf763a379ddc3eb04.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<!-- Privacy-friendly analytics by Plausible -->
<script async="" src="https://plausible.io/js/pa-IdJjKOvKq9lif5cw4UK5i.js"></script>
<script>
  window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
  plausible.init()
</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../06_eopf_zarr_in_action/61_sardinia_s2_tfci.html"><strong>EOPF Zarr in Action</strong></a></li><li class="breadcrumb-item"><a href="../06_eopf_zarr_in_action/65_create_overviews.html"><span class="chapter-title">Creating Zarr Overviews</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../img/EOPF_FINAL_LOGO.png" alt="" class="sidebar-logo light-content py-0 d-lg-inline d-none">
      <img src="../img/EOPF_FINAL_LOGO.png" alt="" class="sidebar-logo dark-content py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://github.com/eopf-toolkit/eopf-101" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title"><strong>ESA EOPF 101</strong></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>About EOPF</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_about_eopf/11_about_eopf.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introduction to the EOPF</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_about_eopf/12_about_cloudoptimized_formats.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">About cloud-optimised formats</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_about_eopf/13_overview_eopf_datasets.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Overview of EOPF Zarr Products</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>About EOPF Zarr</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_about_eopf_zarr/21_what_is_zarr.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Overview of the EOPF Zarr format</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_about_eopf_zarr/22_zarr_structure_S1GRD.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Discover EOPF Zarr - Sentinel-1 GRD</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_about_eopf_zarr/23_S1_basic_operations.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Operations with EOPF Zarr - Sentinel-1 GRD</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_about_eopf_zarr/24_zarr_struct_S2L2A.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Discover EOPF Zarr - Sentinel-2 L2A</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_about_eopf_zarr/25_zarr_struct_S3.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Discover EOPF Zarr - Sentinel-3 SLSTR Level-2 LST</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>About Chunking</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_about_chunking/31_zarr_chunking_intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">An introduction to Chunking</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_about_chunking/32_zarr_chunking_strat.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Best practices and Chunking optimisation in EOPF</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>EOPF and STAC</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_eopf_and_stac/41_stac_intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introduction to STAC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_eopf_and_stac/42_eopf_stac_zarr_tutorial.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Explore the web interface of the EOPF Zarr STAC Catalog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_eopf_and_stac/43_eopf_stac_connection.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Access the EOPF Zarr STAC API with Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_eopf_and_stac/44_eopf_stac_xarray_tutorial.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">From STAC to Data: Accessing EOPF Zarr with xarray</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>Tools to work with EOPF Zarr</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_zarr_tools/51_eopf_stac_r.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Access the EOPF Zarr STAC API with R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_zarr_tools/52_eopf_stac_qgis.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Access EOPF Zarr in QGIS Using STAC</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>EOPF Zarr in Action</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_eopf_zarr_in_action/61_sardinia_s2_tfci.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Fire in Sardinia 2025 - Part 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_eopf_zarr_in_action/62_sardinia_s3_lst.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Fire in Sardinia 2025 - Part 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_eopf_zarr_in_action/63_sardinia_dNBR.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Fire in Sardinia 2025 - Part 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_eopf_zarr_in_action/64_flood_mapping_valencia.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Flood Mapping - Time Series Analysis in Valencia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_eopf_zarr_in_action/65_create_overviews.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Creating Zarr Overviews</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_eopf_zarr_in_action/65_reservoir_surface_monitoring.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Reservoir Surface Monitoring</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_eopf_zarr_in_action/66_use_overviews.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Visualising Multiscale Pyramids</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../glossary.html" class="sidebar-item-text sidebar-link"><span class="chapter-title"><strong>Glossary</strong></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link"><span class="chapter-title"><strong>References</strong></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#what-we-will-learn" id="toc-what-we-will-learn" class="nav-link" data-scroll-target="#what-we-will-learn">What we will learn</a></li>
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link" data-scroll-target="#prerequisites">Prerequisites</a></li>
  <li><a href="#copy-remote-dataset-to-local-storage" id="toc-copy-remote-dataset-to-local-storage" class="nav-link" data-scroll-target="#copy-remote-dataset-to-local-storage">Copy Remote Dataset to Local Storage</a></li>
  <li><a href="#compute-overviews-in-memory" id="toc-compute-overviews-in-memory" class="nav-link" data-scroll-target="#compute-overviews-in-memory">Compute Overviews (In-Memory)</a></li>
  <li><a href="#attach-multiscales-metadata" id="toc-attach-multiscales-metadata" class="nav-link" data-scroll-target="#attach-multiscales-metadata">Attach Multiscales Metadata</a>
  <ul class="collapse">
  <li><a href="#write-overviews-to-local-zarr-store" id="toc-write-overviews-to-local-zarr-store" class="nav-link" data-scroll-target="#write-overviews-to-local-zarr-store">Write Overviews to Local Zarr Store</a></li>
  </ul></li>
  <li><a href="#now-it-is-your-turn" id="toc-now-it-is-your-turn" class="nav-link" data-scroll-target="#now-it-is-your-turn">üí™ Now it is your turn</a>
  <ul class="collapse">
  <li><a href="#task-1-experiment-with-different-scale-factors" id="toc-task-1-experiment-with-different-scale-factors" class="nav-link" data-scroll-target="#task-1-experiment-with-different-scale-factors">Task 1: Experiment With Different Scale Factors</a></li>
  <li><a href="#task-2-apply-to-your-own-dataset" id="toc-task-2-apply-to-your-own-dataset" class="nav-link" data-scroll-target="#task-2-apply-to-your-own-dataset">Task 2: Apply To Your Own Dataset</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#whats-next" id="toc-whats-next" class="nav-link" data-scroll-target="#whats-next">What‚Äôs next?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../06_eopf_zarr_in_action/61_sardinia_s2_tfci.html"><strong>EOPF Zarr in Action</strong></a></li><li class="breadcrumb-item"><a href="../06_eopf_zarr_in_action/65_create_overviews.html"><span class="chapter-title">Creating Zarr Overviews</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">Creating Zarr Overviews</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><a href="https://jupyterhub.user.eopf.eodc.eu/hub/login?next=%2Fhub%2Fspawn%3Fnext%3D%252Fhub%252Fuser-redirect%252Fgit-pull%253Frepo%253Dhttps%253A%252F%252Fgithub.com%252Feopf-toolkit%252Feopf-101%2526branch%253Dmain%2526urlpath%253Dlab%252Ftree%252Feopf-101%252F06_eopf_zarr_in_action%252F65_create_overviews.ipynb%23fancy-forms-config=%7B%22profile%22%3A%22choose-your-environment%22%2C%22image%22%3A%22unlisted_choice%22%2C%22image%3Aunlisted_choice%22%3A%224zm3809f.c1.de1.container-registry.ovh.net%2Feopf-toolkit-python%2Feopf-toolkit-python%3Alatest%22%2C%22autoStart%22%3A%22true%22%7D" target="_blank"> <button style="background-color:#0072ce; color:white; padding:0.6em 1.2em; font-size:1rem; border:none; border-radius:6px; margin-top:1em;"> üöÄ Launch this notebook in JupyterLab </button> </a></p>
<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction">Introduction</h3>
<p>Large satellite products, such as Sentinel-2 Level-2A scenes, contain tens of millions of pixels per band. Accessing or visualising them at full resolution is often unnecessary, especially for exploratory analysis, map rendering, or quality checks. Multiscale pyramids address this by providing progressively coarser versions of the original data, allowing client applications to request only the level of detail required. This approach reduces computational load, improves user experience, and aligns with modern cloud-native geospatial workflows.</p>
<p>Our approach consist of two notebooks:</p>
<ul>
<li><strong>Part 1: Creating Zarr Overviews</strong></li>
<li><a href="../06_eopf_zarr_in_action/66_use_overviews.html">Part 2: Visualising Multiscale Pyramids</a></li>
</ul>
<p>In this notebook, we will demonstrate how to create overviews (also called <strong>multiscale pyramids</strong>) for large Earth Observation datasets stored in Zarr format. Overviews are downscaled representations of gridded data that support efficient visualisation and scalable access to high-resolution datasets. They enable fast inspection at multiple zoom levels, reduce data transfer volumes, and improve performance when working with cloud-optimised storage.</p>
</section>
<section id="what-we-will-learn" class="level3">
<h3 class="anchored" data-anchor-id="what-we-will-learn">What we will learn</h3>
<ul>
<li>üóÇÔ∏è How to compute multiscale overview levels from high-resolution satellite data</li>
<li>üìä How to attach GeoZarr-compliant metadata to datasets</li>
<li>üíæ How to write overview pyramids to Zarr storage</li>
</ul>
</section>
<section id="prerequisites" class="level3">
<h3 class="anchored" data-anchor-id="prerequisites">Prerequisites</h3>
<p>This notebook uses: - <strong>Dataset</strong>: Sentinel-2 L2A reflectance data from EODC object storage (hosted by the STAC catalogue) - <strong>Resolution</strong>: 10m spatial resolution (10980 √ó 10980 pixels) - <strong>Bands</strong>: Blue (b02), Green (b03), Red (b04), NIR (b08)</p>
<p>The workflow follows a <strong>compute-then-write pattern</strong> that separates in-memory computation from disk persistence, allowing validation before committing changes.</p>
<hr>
<section id="import-libraries" class="level4">
<h4 class="anchored" data-anchor-id="import-libraries">Import libraries</h4>
<div id="4" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os, warnings, json, s3fs, zarr, dask</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    bucket <span class="op">=</span> os.environ[<span class="st">"BUCKET_NAME"</span>]</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    access <span class="op">=</span> os.environ[<span class="st">"ACCESS_KEY"</span>]</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    secret <span class="op">=</span> os.environ[<span class="st">"SECRET_KEY"</span>]</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    bucket_endpoint <span class="op">=</span> os.environ[<span class="st">"BUCKET_ENDPOINT"</span>]</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyError</span> <span class="im">as</span> e:</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">RuntimeError</span>(</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Missing required environment variable: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Please set BUCKET_NAME, ACCESS_KEY, and SECRET_KEY"</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># S3 filesystem</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>fs <span class="op">=</span> s3fs.S3FileSystem(</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    key<span class="op">=</span>access,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    secret<span class="op">=</span>secret,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    client_kwargs<span class="op">=</span>{<span class="st">"endpoint_url"</span>: bucket_endpoint},</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="copy-remote-dataset-to-local-storage" class="level2">
<h2 class="anchored" data-anchor-id="copy-remote-dataset-to-local-storage">Copy Remote Dataset to Local Storage</h2>
<p>The starting point for our overviews starts with the ‚Äúlocal‚Äù access to the STAC zarr item we are interested in. We do this based on two main reasons:</p>
<ul>
<li>The remote dataset is read-only (object storage) and we need a writable local copy to add new groups (L1-L5)</li>
<li>This preserves the complete original structure</li>
</ul>
<p>To make sure that we use a convenient scene, we select a source URL from the STAC catalogue.</p>
<div id="7" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>remote_url <span class="op">=</span> (<span class="st">"https://objects.eodc.eu/e05ab01a9d56408d82ac32d69a5aae2a:202508-s02msil2a/31/products/cpm_v256/S2A_MSIL2A_20250831T135741_N0511_R010_T26WPD_20250831T185012.zarr"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>store_path <span class="op">=</span> (<span class="st">"S2A_MSIL2A_20250831T135741_N0511_R010_T26WPD_20250831T185012.zarr"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>base_store <span class="op">=</span> fs.get_mapper(<span class="ss">f"</span><span class="sc">{</span>bucket<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>store_path<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>As a first step, we download the remote Zarr dataset and saves it as a Zarr copy ready on a S3 bucket for exploration. Chunking helps large datasets load faster especially when used in visualisation tools that read data in small spatial tiles.</p>
<div id="9" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Copying remote Zarr to local storage... (may take several minutes)"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    s2l2a_remote <span class="op">=</span> xr.open_datatree(remote_url, engine<span class="op">=</span><span class="st">"zarr"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">RuntimeError</span>(<span class="ss">f"Failed to open remote dataset: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ch">\n</span><span class="ss">Check network connectivity and URL"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Copying to s3://</span><span class="sc">{</span>base_store<span class="sc">}</span><span class="ss"> ..."</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>s2l2a_remote.to_zarr(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    store<span class="op">=</span>base_store,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    mode<span class="op">=</span><span class="st">"w"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    consolidated<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    zarr_version<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    compute<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Copying remote Zarr to local storage... (may take several minutes)</code></pre>
</div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">GroupNotFoundError</span>                        Traceback (most recent call last)
<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/xarray/backends/zarr.py:1868</span>, in <span class="ansi-cyan-fg">_get_open_params</span><span class="ansi-blue-fg">(store, mode, synchronizer, group, consolidated, consolidate_on_close, chunk_store, storage_options, zarr_version, use_zarr_fill_value_as_mask, zarr_format)</span>
<span class="ansi-green-fg">   1867</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1868</span>     zarr_root_group = <span class="ansi-yellow-bg">zarr</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_consolidated</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">open_kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1869</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> (<span style="font-weight:bold;color:rgb(215,95,95)">ValueError</span>, <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>):
<span class="ansi-green-fg">   1870</span>     <span style="font-style:italic;color:rgb(95,135,135)"># ValueError in zarr-python 3.x, KeyError in 2.x.</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/api/synchronous.py:238</span>, in <span class="ansi-cyan-fg">open_consolidated</span><span class="ansi-blue-fg">(use_consolidated, *args, **kwargs)</span>
<span class="ansi-green-fg">    234</span> <span style="font-style:italic" class="ansi-yellow-fg">"""</span>
<span class="ansi-green-fg">    235</span> <span style="font-style:italic" class="ansi-yellow-fg">Alias for [`open_group`][zarr.api.synchronous.open_group] with ``use_consolidated=True``.</span>
<span class="ansi-green-fg">    236</span> <span style="font-style:italic" class="ansi-yellow-fg">"""</span>
<span class="ansi-green-fg">    237</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> Group(
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">238</span>     <span class="ansi-yellow-bg">sync</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">async_api</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_consolidated</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">use_consolidated</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">use_consolidated</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    239</span> )

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/core/sync.py:159</span>, in <span class="ansi-cyan-fg">sync</span><span class="ansi-blue-fg">(coro, loop, timeout)</span>
<span class="ansi-green-fg">    158</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(return_result, <span style="font-weight:bold;color:rgb(215,95,95)">BaseException</span>):
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">159</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> return_result
<span class="ansi-green-fg">    160</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/core/sync.py:119</span>, in <span class="ansi-cyan-fg">_runner</span><span class="ansi-blue-fg">(coro)</span>
<span class="ansi-green-fg">    118</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">119</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="font-weight:bold;color:rgb(0,135,0)">await</span> coro
<span class="ansi-green-fg">    120</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">Exception</span> <span style="font-weight:bold;color:rgb(0,135,0)">as</span> ex:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/api/asynchronous.py:415</span>, in <span class="ansi-cyan-fg">open_consolidated</span><span class="ansi-blue-fg">(use_consolidated, *args, **kwargs)</span>
<span class="ansi-green-fg">    411</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>(
<span class="ansi-green-fg">    412</span>         <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">use_consolidated</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg"> must be </span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">True</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg"> in </span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">open_consolidated</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">. Use </span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">open</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg"> with </span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">    413</span>         <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">use_consolidated=False</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg"> to bypass consolidated metadata.</span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">    414</span>     )
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">415</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="font-weight:bold;color:rgb(0,135,0)">await</span> open_group(*args, use_consolidated=use_consolidated, **kwargs)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/api/asynchronous.py:881</span>, in <span class="ansi-cyan-fg">open_group</span><span class="ansi-blue-fg">(store, mode, cache_attrs, synchronizer, path, chunk_store, storage_options, zarr_version, zarr_format, meta_array, attributes, use_consolidated)</span>
<span class="ansi-green-fg">    880</span> msg = <span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">No group found in store </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>store<span style="font-weight:bold;color:rgb(175,95,135)">!r}</span><span class="ansi-yellow-fg"> at path </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>store_path.path<span style="font-weight:bold;color:rgb(175,95,135)">!r}</span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">881</span> <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> GroupNotFoundError(msg)

<span class="ansi-red-fg">GroupNotFoundError</span>: No group found in store 'https://objects.eodc.eu/e05ab01a9d56408d82ac32d69a5aae2a:202508-s02msil2a/31/products/cpm_v256/S2A_MSIL2A_20250831T135741_N0511_R010_T26WPD_20250831T185012.zarr' at path ''

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">GroupNotFoundError</span>                        Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[3]</span><span class="ansi-green-fg">, line 3</span>
<span class="ansi-green-fg">      2</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">3</span>     s2l2a_remote = <span class="ansi-yellow-bg">xr</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_datatree</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">remote_url</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">engine</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-fg ansi-yellow-bg">"</span><span class="ansi-yellow-fg ansi-yellow-bg">zarr</span><span class="ansi-yellow-fg ansi-yellow-bg">"</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">      4</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">Exception</span> <span style="font-weight:bold;color:rgb(0,135,0)">as</span> e:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/xarray/backends/api.py:1076</span>, in <span class="ansi-cyan-fg">open_datatree</span><span class="ansi-blue-fg">(filename_or_obj, engine, chunks, cache, decode_cf, mask_and_scale, decode_times, decode_timedelta, use_cftime, concat_characters, decode_coords, drop_variables, create_default_indexes, inline_array, chunked_array_type, from_array_kwargs, backend_kwargs, **kwargs)</span>
<span class="ansi-green-fg">   1074</span> overwrite_encoded_chunks = kwargs.pop(<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">overwrite_encoded_chunks</span><span class="ansi-yellow-fg">"</span>, <span style="font-weight:bold;color:rgb(0,135,0)">None</span>)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1076</span> backend_tree = <span class="ansi-yellow-bg">backend</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_datatree</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">   1077</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">filename_or_obj</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1078</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">drop_variables</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">drop_variables</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1079</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">decoders</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1080</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1081</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1083</span> tree = _datatree_from_backend_datatree(
<span class="ansi-green-fg">   1084</span>     backend_tree,
<span class="ansi-green-fg">   1085</span>     filename_or_obj,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">   1096</span>     **kwargs,
<span class="ansi-green-fg">   1097</span> )

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/xarray/backends/zarr.py:1710</span>, in <span class="ansi-cyan-fg">ZarrBackendEntrypoint.open_datatree</span><span class="ansi-blue-fg">(self, filename_or_obj, mask_and_scale, decode_times, concat_characters, decode_coords, drop_variables, use_cftime, decode_timedelta, group, mode, synchronizer, consolidated, chunk_store, storage_options, zarr_version, zarr_format)</span>
<span class="ansi-green-fg">   1709</span> filename_or_obj = _normalize_path(filename_or_obj)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1710</span> groups_dict = <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_groups_as_dict</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">   1711</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">filename_or_obj</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">filename_or_obj</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1712</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">mask_and_scale</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mask_and_scale</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1713</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">decode_times</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">decode_times</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1714</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">concat_characters</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">concat_characters</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1715</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">decode_coords</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">decode_coords</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1716</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">drop_variables</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">drop_variables</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1717</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">use_cftime</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">use_cftime</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1718</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">decode_timedelta</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">decode_timedelta</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1719</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">group</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">group</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1720</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1721</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1722</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">consolidated</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">consolidated</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1723</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1724</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1725</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1726</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1727</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1729</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> datatree_from_dict_with_io_cleanup(groups_dict)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/xarray/backends/zarr.py:1759</span>, in <span class="ansi-cyan-fg">ZarrBackendEntrypoint.open_groups_as_dict</span><span class="ansi-blue-fg">(self, filename_or_obj, mask_and_scale, decode_times, concat_characters, decode_coords, drop_variables, use_cftime, decode_timedelta, group, mode, synchronizer, consolidated, chunk_store, storage_options, zarr_version, zarr_format)</span>
<span class="ansi-green-fg">   1757</span>     parent = <span style="color:rgb(0,135,0)">str</span>(NodePath(<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">/</span><span class="ansi-yellow-fg">"</span>))
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1759</span> stores = <span class="ansi-yellow-bg">ZarrStore</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_store</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">   1760</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">filename_or_obj</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1761</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">group</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">parent</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1762</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1763</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1764</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">consolidated</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">consolidated</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1765</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">consolidate_on_close</span><span class="ansi-yellow-bg">=</span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">False</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1766</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1767</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1768</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1769</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1770</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1772</span> groups_dict = {}

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/xarray/backends/zarr.py:645</span>, in <span class="ansi-cyan-fg">ZarrStore.open_store</span><span class="ansi-blue-fg">(cls, store, mode, synchronizer, group, consolidated, consolidate_on_close, chunk_store, storage_options, append_dim, write_region, safe_chunks, align_chunks, zarr_version, zarr_format, use_zarr_fill_value_as_mask, write_empty, cache_members)</span>
<span class="ansi-green-fg">    619</span> <span style="color:rgb(175,0,255)">@classmethod</span>
<span class="ansi-green-fg">    620</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">open_store</span>(
<span class="ansi-green-fg">    621</span>     <span style="color:rgb(0,135,0)">cls</span>,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    638</span>     cache_members: <span style="color:rgb(0,135,0)">bool</span> = <span style="font-weight:bold;color:rgb(0,135,0)">True</span>,
<span class="ansi-green-fg">    639</span> ):
<span class="ansi-green-fg">    640</span>     (
<span class="ansi-green-fg">    641</span>         zarr_group,
<span class="ansi-green-fg">    642</span>         consolidate_on_close,
<span class="ansi-green-fg">    643</span>         close_store_on_close,
<span class="ansi-green-fg">    644</span>         use_zarr_fill_value_as_mask,
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">645</span>     ) = <span class="ansi-yellow-bg">_get_open_params</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    646</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    647</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    648</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    649</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">group</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">group</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    650</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">consolidated</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">consolidated</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    651</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">consolidate_on_close</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">consolidate_on_close</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    652</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    653</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    654</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    655</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">use_zarr_fill_value_as_mask</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">use_zarr_fill_value_as_mask</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    656</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    657</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    659</span>     <span style="font-weight:bold;color:rgb(0,135,0)">from</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg ansi-bold">zarr</span><span style="color:rgb(188,188,188)"> </span><span style="font-weight:bold;color:rgb(0,135,0)">import</span> Group

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/xarray/backends/zarr.py:1872</span>, in <span class="ansi-cyan-fg">_get_open_params</span><span class="ansi-blue-fg">(store, mode, synchronizer, group, consolidated, consolidate_on_close, chunk_store, storage_options, zarr_version, use_zarr_fill_value_as_mask, zarr_format)</span>
<span class="ansi-green-fg">   1871</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1872</span>     zarr_root_group = <span class="ansi-yellow-bg">zarr</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_group</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">open_kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1873</span>     emit_user_level_warning(
<span class="ansi-green-fg">   1874</span>         <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">Failed to open Zarr store with consolidated metadata, </span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">   1875</span>         <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">but successfully read with non-consolidated metadata. </span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">   1885</span>         <span style="font-weight:bold;color:rgb(215,95,95)">RuntimeWarning</span>,
<span class="ansi-green-fg">   1886</span>     )

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/api/synchronous.py:549</span>, in <span class="ansi-cyan-fg">open_group</span><span class="ansi-blue-fg">(store, mode, cache_attrs, synchronizer, path, chunk_store, storage_options, zarr_version, zarr_format, meta_array, attributes, use_consolidated)</span>
<span class="ansi-green-fg">    493</span> <span style="font-style:italic" class="ansi-yellow-fg">"""Open a group using file-mode-like semantics.</span>
<span class="ansi-green-fg">    494</span> 
<span class="ansi-green-fg">    495</span> <span style="font-style:italic" class="ansi-yellow-fg">Parameters</span>
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    546</span> <span style="font-style:italic" class="ansi-yellow-fg">    The new group.</span>
<span class="ansi-green-fg">    547</span> <span style="font-style:italic" class="ansi-yellow-fg">"""</span>
<span class="ansi-green-fg">    548</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> Group(
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">549</span>     <span class="ansi-yellow-bg">sync</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    550</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">async_api</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_group</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    551</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    552</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    553</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">cache_attrs</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">cache_attrs</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    554</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    555</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">path</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">path</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    556</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    557</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    558</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    559</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    560</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">meta_array</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">meta_array</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    561</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">attributes</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">attributes</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    562</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">use_consolidated</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">use_consolidated</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    563</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    564</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    565</span> )

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/core/sync.py:159</span>, in <span class="ansi-cyan-fg">sync</span><span class="ansi-blue-fg">(coro, loop, timeout)</span>
<span class="ansi-green-fg">    158</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(return_result, <span style="font-weight:bold;color:rgb(215,95,95)">BaseException</span>):
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">159</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> return_result
<span class="ansi-green-fg">    160</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/core/sync.py:119</span>, in <span class="ansi-cyan-fg">_runner</span><span class="ansi-blue-fg">(coro)</span>
<span class="ansi-green-fg">    118</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">119</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="font-weight:bold;color:rgb(0,135,0)">await</span> coro
<span class="ansi-green-fg">    120</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">Exception</span> <span style="font-weight:bold;color:rgb(0,135,0)">as</span> ex:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/api/asynchronous.py:881</span>, in <span class="ansi-cyan-fg">open_group</span><span class="ansi-blue-fg">(store, mode, cache_attrs, synchronizer, path, chunk_store, storage_options, zarr_version, zarr_format, meta_array, attributes, use_consolidated)</span>
<span class="ansi-green-fg">    880</span> msg = <span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">No group found in store </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>store<span style="font-weight:bold;color:rgb(175,95,135)">!r}</span><span class="ansi-yellow-fg"> at path </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>store_path.path<span style="font-weight:bold;color:rgb(175,95,135)">!r}</span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">881</span> <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> GroupNotFoundError(msg)

<span class="ansi-red-fg">GroupNotFoundError</span>: No group found in store 'https://objects.eodc.eu/e05ab01a9d56408d82ac32d69a5aae2a:202508-s02msil2a/31/products/cpm_v256/S2A_MSIL2A_20250831T135741_N0511_R010_T26WPD_20250831T185012.zarr' at path ''

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">RuntimeError</span>                              Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[3]</span><span class="ansi-green-fg">, line 5</span>
<span class="ansi-green-fg">      3</span>     s2l2a_remote = xr.open_datatree(remote_url, engine=<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">zarr</span><span class="ansi-yellow-fg">"</span>)
<span class="ansi-green-fg">      4</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">Exception</span> <span style="font-weight:bold;color:rgb(0,135,0)">as</span> e:
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">5</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">RuntimeError</span>(<span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">Failed to open remote dataset: </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>e<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="font-weight:bold;color:rgb(175,95,0)">\n</span><span class="ansi-yellow-fg">Check network connectivity and URL</span><span class="ansi-yellow-fg">"</span>)
<span class="ansi-green-fg">      6</span> <span style="color:rgb(0,135,0)">print</span>(<span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">Copying to s3://</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>base_store<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span class="ansi-yellow-fg"> ...</span><span class="ansi-yellow-fg">"</span>)
<span class="ansi-green-fg">      7</span> s2l2a_remote.to_zarr(
<span class="ansi-green-fg">      8</span>     store=base_store,
<span class="ansi-green-fg">      9</span>     mode=<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">w</span><span class="ansi-yellow-fg">"</span>,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">     12</span>     compute=<span style="font-weight:bold;color:rgb(0,135,0)">True</span>,
<span class="ansi-green-fg">     13</span> )

<span class="ansi-red-fg">RuntimeError</span>: Failed to open remote dataset: No group found in store 'https://objects.eodc.eu/e05ab01a9d56408d82ac32d69a5aae2a:202508-s02msil2a/31/products/cpm_v256/S2A_MSIL2A_20250831T135741_N0511_R010_T26WPD_20250831T185012.zarr' at path ''
Check network connectivity and URL</pre>
</div>
</div>
</div>
<p>Then, we can access the dataset from the S3 bucket and look inside the group that contains the 10-metre reflectance data to understand which variables, dimensions, and coordinates it contains.</p>
<div id="11" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Load Local Dataset and Inspect Structure ---</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>variable_group_path <span class="op">=</span> <span class="st">"measurements/reflectance/r10m"</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>r10m_store <span class="op">=</span> fs.get_mapper(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"</span><span class="sc">{</span>bucket<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>store_path<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>variable_group_path<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> xr.open_dataset(r10m_store, engine<span class="op">=</span><span class="st">"zarr"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>dataset</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in notebooks */

:root {
  --xr-font-color0: var(
    --jp-content-font-color0,
    var(--pst-color-text-base rgba(0, 0, 0, 1))
  );
  --xr-font-color2: var(
    --jp-content-font-color2,
    var(--pst-color-text-base, rgba(0, 0, 0, 0.54))
  );
  --xr-font-color3: var(
    --jp-content-font-color3,
    var(--pst-color-text-base, rgba(0, 0, 0, 0.38))
  );
  --xr-border-color: var(
    --jp-border-color2,
    hsl(from var(--pst-color-on-background, white) h s calc(l - 10))
  );
  --xr-disabled-color: var(
    --jp-layout-color3,
    hsl(from var(--pst-color-on-background, white) h s calc(l - 40))
  );
  --xr-background-color: var(
    --jp-layout-color0,
    var(--pst-color-on-background, white)
  );
  --xr-background-color-row-even: var(
    --jp-layout-color1,
    hsl(from var(--pst-color-on-background, white) h s calc(l - 5))
  );
  --xr-background-color-row-odd: var(
    --jp-layout-color2,
    hsl(from var(--pst-color-on-background, white) h s calc(l - 15))
  );
}

html[theme="dark"],
html[data-theme="dark"],
body[data-theme="dark"],
body.vscode-dark {
  --xr-font-color0: var(
    --jp-content-font-color0,
    var(--pst-color-text-base, rgba(255, 255, 255, 1))
  );
  --xr-font-color2: var(
    --jp-content-font-color2,
    var(--pst-color-text-base, rgba(255, 255, 255, 0.54))
  );
  --xr-font-color3: var(
    --jp-content-font-color3,
    var(--pst-color-text-base, rgba(255, 255, 255, 0.38))
  );
  --xr-border-color: var(
    --jp-border-color2,
    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 10))
  );
  --xr-disabled-color: var(
    --jp-layout-color3,
    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 40))
  );
  --xr-background-color: var(
    --jp-layout-color0,
    var(--pst-color-on-background, #111111)
  );
  --xr-background-color-row-even: var(
    --jp-layout-color1,
    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 5))
  );
  --xr-background-color-row-odd: var(
    --jp-layout-color2,
    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 15))
  );
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
  line-height: 1.6;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-obj-name,
.xr-group-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-group-name::before {
  content: "üìÅ";
  padding-right: 0.3em;
}

.xr-group-name,
.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
  margin-block-start: 0;
  margin-block-end: 0;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: inline-block;
  opacity: 0;
  height: 0;
  margin: 0;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
  border: 2px solid transparent !important;
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:focus + label {
  border: 2px solid var(--xr-font-color0) !important;
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: "‚ñ∫";
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: "‚ñº";
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-top: 4px;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-group-box {
  display: inline-grid;
  grid-template-columns: 0px 20px auto;
  width: 100%;
}

.xr-group-box-vline {
  grid-column-start: 1;
  border-right: 0.2em solid;
  border-color: var(--xr-border-color);
  width: 0px;
}

.xr-group-box-hline {
  grid-column-start: 2;
  grid-row-start: 1;
  height: 1em;
  width: 20px;
  border-bottom: 0.2em solid;
  border-color: var(--xr-border-color);
}

.xr-group-box-contents {
  grid-column-start: 3;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: "(";
}

.xr-dim-list:after {
  content: ")";
}

.xr-dim-list li:not(:last-child):after {
  content: ",";
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  border-color: var(--xr-background-color-row-odd);
  margin-bottom: 0;
  padding-top: 2px;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
  border-color: var(--xr-background-color-row-even);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  border-top: 2px dotted var(--xr-background-color);
  padding-bottom: 20px !important;
  padding-top: 10px !important;
}

.xr-var-attrs-in + label,
.xr-var-data-in + label,
.xr-index-data-in + label {
  padding: 0 1px;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-data > pre,
.xr-index-data > pre,
.xr-var-data > table > tbody > tr {
  background-color: transparent !important;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}

.xr-var-attrs-in:checked + label > .xr-icon-file-text2,
.xr-var-data-in:checked + label > .xr-icon-database,
.xr-index-data-in:checked + label > .xr-icon-database {
  color: var(--xr-font-color0);
  filter: drop-shadow(1px 1px 5px var(--xr-font-color2));
  stroke-width: 0.8px;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.Dataset&gt; Size: 4GB
Dimensions:  (y: 10980, x: 10980)
Coordinates:
  * y        (y) int64 88kB 7900015 7900005 7899995 ... 7790245 7790235 7790225
  * x        (x) int64 88kB 600005 600015 600025 600035 ... 709775 709785 709795
Data variables:
    b02      (y, x) float64 964MB ...
    b03      (y, x) float64 964MB ...
    b04      (y, x) float64 964MB ...
    b08      (y, x) float64 964MB ...
Attributes:
    multiscales:  {'version': '1.0', 'resampling_method': 'average', 'variabl...</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.Dataset</div></div><ul class="xr-sections"><li class="xr-section-item"><input id="section-3d653020-8c1b-450f-a7cb-4a62abedafce" class="xr-section-summary-in" type="checkbox" disabled=""><label for="section-3d653020-8c1b-450f-a7cb-4a62abedafce" class="xr-section-summary" title="Expand/collapse section">Dimensions:</label><div class="xr-section-inline-details"><ul class="xr-dim-list"><li><span class="xr-has-index">y</span>: 10980</li><li><span class="xr-has-index">x</span>: 10980</li></ul></div><div class="xr-section-details"></div></li><li class="xr-section-item"><input id="section-0c3bc44f-48da-46a8-a14b-ac19e3cac020" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-0c3bc44f-48da-46a8-a14b-ac19e3cac020" class="xr-section-summary">Coordinates: <span>(2)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">y</span></div><div class="xr-var-dims">(y)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">7900015 7900005 ... 7790235 7790225</div><input id="attrs-54aae096-091c-4781-9af6-2cbd27a00402" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-54aae096-091c-4781-9af6-2cbd27a00402" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-454c42c0-8f72-4188-b48d-f61abab5e1e2" class="xr-var-data-in" type="checkbox"><label for="data-454c42c0-8f72-4188-b48d-f61abab5e1e2" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([7900015, 7900005, 7899995, ..., 7790245, 7790235, 7790225],
      shape=(10980,))</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">x</span></div><div class="xr-var-dims">(x)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">600005 600015 ... 709785 709795</div><input id="attrs-94e36308-0dc6-4487-aef8-3b0f76721ecd" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-94e36308-0dc6-4487-aef8-3b0f76721ecd" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-fc46482e-805e-496d-804e-238ec854a382" class="xr-var-data-in" type="checkbox"><label for="data-fc46482e-805e-496d-804e-238ec854a382" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([600005, 600015, 600025, ..., 709775, 709785, 709795], shape=(10980,))</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-5c8f320e-3dd9-4f48-a5d3-dc22fba1a7f0" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-5c8f320e-3dd9-4f48-a5d3-dc22fba1a7f0" class="xr-section-summary">Data variables: <span>(4)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span>b02</span></div><div class="xr-var-dims">(y, x)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">...</div><input id="attrs-987d5cc4-2bb5-4b8b-8539-84935857fe26" class="xr-var-attrs-in" type="checkbox"><label for="attrs-987d5cc4-2bb5-4b8b-8539-84935857fe26" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-ebce4f2b-4896-451b-abb0-e132c22608db" class="xr-var-data-in" type="checkbox"><label for="data-ebce4f2b-4896-451b-abb0-e132c22608db" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>_eopf_attrs :</span></dt><dd>{'add_offset': -0.1, 'coordinates': ['x', 'y'], 'dimensions': ['y', 'x'], 'dtype': '&lt;u2', 'eopf_is_masked': True, 'eopf_target_dtype': '&lt;f8', 'fill_value': 0, 'long_name': 'BOA reflectance from MSI acquisition at spectral band b02 492.7 nm', 'scale_factor': 0.0001, 'units': 'digital_counts'}</dd><dt><span>dtype :</span></dt><dd>&lt;u2</dd><dt><span>fill_value :</span></dt><dd>0</dd><dt><span>long_name :</span></dt><dd>BOA reflectance from MSI acquisition at spectral band b02 492.7 nm</dd><dt><span>proj:bbox :</span></dt><dd>[600000.0, 7790220.0, 709800.0, 7900020.0]</dd><dt><span>proj:epsg :</span></dt><dd>32626</dd><dt><span>proj:shape :</span></dt><dd>[10980, 10980]</dd><dt><span>proj:transform :</span></dt><dd>[10.0, 0.0, 600000.0, 0.0, -10.0, 7900020.0, 0.0, 0.0, 1.0]</dd><dt><span>proj:wkt2 :</span></dt><dd>PROJCS["WGS 84 / UTM zone 26N",GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4326"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-27],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","32626"]]</dd><dt><span>units :</span></dt><dd>digital_counts</dd><dt><span>valid_max :</span></dt><dd>65535</dd><dt><span>valid_min :</span></dt><dd>1</dd></dl></div><div class="xr-var-data"><pre>[120560400 values with dtype=float64]</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>b03</span></div><div class="xr-var-dims">(y, x)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">...</div><input id="attrs-8f3453fd-b1ca-4239-8a20-e43d754585fa" class="xr-var-attrs-in" type="checkbox"><label for="attrs-8f3453fd-b1ca-4239-8a20-e43d754585fa" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-7f69a225-1866-4e1c-b1bc-89a09c28a772" class="xr-var-data-in" type="checkbox"><label for="data-7f69a225-1866-4e1c-b1bc-89a09c28a772" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>_eopf_attrs :</span></dt><dd>{'add_offset': -0.1, 'coordinates': ['x', 'y'], 'dimensions': ['y', 'x'], 'dtype': '&lt;u2', 'eopf_is_masked': True, 'eopf_target_dtype': '&lt;f8', 'fill_value': 0, 'long_name': 'BOA reflectance from MSI acquisition at spectral band b03 559.8 nm', 'scale_factor': 0.0001, 'units': 'digital_counts'}</dd><dt><span>dtype :</span></dt><dd>&lt;u2</dd><dt><span>fill_value :</span></dt><dd>0</dd><dt><span>long_name :</span></dt><dd>BOA reflectance from MSI acquisition at spectral band b03 559.8 nm</dd><dt><span>proj:bbox :</span></dt><dd>[600000.0, 7790220.0, 709800.0, 7900020.0]</dd><dt><span>proj:epsg :</span></dt><dd>32626</dd><dt><span>proj:shape :</span></dt><dd>[10980, 10980]</dd><dt><span>proj:transform :</span></dt><dd>[10.0, 0.0, 600000.0, 0.0, -10.0, 7900020.0, 0.0, 0.0, 1.0]</dd><dt><span>proj:wkt2 :</span></dt><dd>PROJCS["WGS 84 / UTM zone 26N",GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4326"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-27],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","32626"]]</dd><dt><span>units :</span></dt><dd>digital_counts</dd><dt><span>valid_max :</span></dt><dd>65535</dd><dt><span>valid_min :</span></dt><dd>1</dd></dl></div><div class="xr-var-data"><pre>[120560400 values with dtype=float64]</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>b04</span></div><div class="xr-var-dims">(y, x)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">...</div><input id="attrs-bfd81891-ee7b-4c07-9371-2821a53c970a" class="xr-var-attrs-in" type="checkbox"><label for="attrs-bfd81891-ee7b-4c07-9371-2821a53c970a" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-4d61304e-c3c5-4c58-8e41-cf46ca0ebce1" class="xr-var-data-in" type="checkbox"><label for="data-4d61304e-c3c5-4c58-8e41-cf46ca0ebce1" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>_eopf_attrs :</span></dt><dd>{'add_offset': -0.1, 'coordinates': ['x', 'y'], 'dimensions': ['y', 'x'], 'dtype': '&lt;u2', 'eopf_is_masked': True, 'eopf_target_dtype': '&lt;f8', 'fill_value': 0, 'long_name': 'BOA reflectance from MSI acquisition at spectral band b04 664.6 nm', 'scale_factor': 0.0001, 'units': 'digital_counts'}</dd><dt><span>dtype :</span></dt><dd>&lt;u2</dd><dt><span>fill_value :</span></dt><dd>0</dd><dt><span>long_name :</span></dt><dd>BOA reflectance from MSI acquisition at spectral band b04 664.6 nm</dd><dt><span>proj:bbox :</span></dt><dd>[600000.0, 7790220.0, 709800.0, 7900020.0]</dd><dt><span>proj:epsg :</span></dt><dd>32626</dd><dt><span>proj:shape :</span></dt><dd>[10980, 10980]</dd><dt><span>proj:transform :</span></dt><dd>[10.0, 0.0, 600000.0, 0.0, -10.0, 7900020.0, 0.0, 0.0, 1.0]</dd><dt><span>proj:wkt2 :</span></dt><dd>PROJCS["WGS 84 / UTM zone 26N",GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4326"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-27],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","32626"]]</dd><dt><span>units :</span></dt><dd>digital_counts</dd><dt><span>valid_max :</span></dt><dd>65535</dd><dt><span>valid_min :</span></dt><dd>1</dd></dl></div><div class="xr-var-data"><pre>[120560400 values with dtype=float64]</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>b08</span></div><div class="xr-var-dims">(y, x)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">...</div><input id="attrs-4219bfa0-5801-4a2d-a085-09c048f20554" class="xr-var-attrs-in" type="checkbox"><label for="attrs-4219bfa0-5801-4a2d-a085-09c048f20554" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-0baea223-2d3c-41a3-a81f-14f95ca9fba9" class="xr-var-data-in" type="checkbox"><label for="data-0baea223-2d3c-41a3-a81f-14f95ca9fba9" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>_eopf_attrs :</span></dt><dd>{'add_offset': -0.1, 'coordinates': ['x', 'y'], 'dimensions': ['y', 'x'], 'dtype': '&lt;u2', 'eopf_is_masked': True, 'eopf_target_dtype': '&lt;f8', 'fill_value': 0, 'long_name': 'BOA reflectance from MSI acquisition at spectral band b08 832.8 nm', 'scale_factor': 0.0001, 'units': 'digital_counts'}</dd><dt><span>dtype :</span></dt><dd>&lt;u2</dd><dt><span>fill_value :</span></dt><dd>0</dd><dt><span>long_name :</span></dt><dd>BOA reflectance from MSI acquisition at spectral band b08 832.8 nm</dd><dt><span>proj:bbox :</span></dt><dd>[600000.0, 7790220.0, 709800.0, 7900020.0]</dd><dt><span>proj:epsg :</span></dt><dd>32626</dd><dt><span>proj:shape :</span></dt><dd>[10980, 10980]</dd><dt><span>proj:transform :</span></dt><dd>[10.0, 0.0, 600000.0, 0.0, -10.0, 7900020.0, 0.0, 0.0, 1.0]</dd><dt><span>proj:wkt2 :</span></dt><dd>PROJCS["WGS 84 / UTM zone 26N",GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4326"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-27],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","32626"]]</dd><dt><span>units :</span></dt><dd>digital_counts</dd><dt><span>valid_max :</span></dt><dd>65535</dd><dt><span>valid_min :</span></dt><dd>1</dd></dl></div><div class="xr-var-data"><pre>[120560400 values with dtype=float64]</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-ec5f35be-5219-4612-8362-a45b5c5dc85d" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-ec5f35be-5219-4612-8362-a45b5c5dc85d" class="xr-section-summary">Attributes: <span>(1)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"><dt><span>multiscales :</span></dt><dd>{'version': '1.0', 'resampling_method': 'average', 'variables': ['b02', 'b03', 'b04', 'b08'], 'layout': [{'id': 'L0', 'path': '.', 'cell_size': [10.0, 10.0]}, {'id': 'L1', 'path': 'overviews/L1', 'derived_from': 'L0', 'factors': [2, 2], 'resampling_method': 'average', 'cell_size': [20.0, 20.0]}, {'id': 'L2', 'path': 'overviews/L2', 'derived_from': 'L1', 'factors': [4, 4], 'resampling_method': 'average', 'cell_size': [40.0, 40.0]}, {'id': 'L3', 'path': 'overviews/L3', 'derived_from': 'L2', 'factors': [8, 8], 'resampling_method': 'average', 'cell_size': [80.0, 80.0]}, {'id': 'L4', 'path': 'overviews/L4', 'derived_from': 'L3', 'factors': [16, 16], 'resampling_method': 'average', 'cell_size': [160.0, 160.0]}, {'id': 'L5', 'path': 'overviews/L5', 'derived_from': 'L4', 'factors': [32, 32], 'resampling_method': 'average', 'cell_size': [320.0, 320.0]}, {'id': 'L6', 'path': 'overviews/L6', 'derived_from': 'L5', 'factors': [64, 64], 'resampling_method': 'average', 'cell_size': [640.0, 640.0]}, {'id': 'L7', 'path': 'overviews/L7', 'derived_from': 'L6', 'factors': [128, 128], 'resampling_method': 'average', 'cell_size': [1280.0, 1280.0]}]}</dd></dl></div></li></ul></div></div>
</div>
</div>
</section>
<section id="compute-overviews-in-memory" class="level2">
<h2 class="anchored" data-anchor-id="compute-overviews-in-memory">Compute Overviews (In-Memory)</h2>
<p>Now we compute the overview levels <strong>in memory only</strong> - no data is written to disk at this stage.</p>
<p>We extract the reflectance group at 10m resolution and automatically discover variables and dimensions.</p>
<p><strong>Key operations:</strong> - Open the local Zarr dataset as a datatree - Extract the reflectance group and convert to an xarray Dataset - Automatically discover all variables and dimensions - Identify spatial coordinate names (x, y)</p>
<p>In this step, we identify the spatial dimensions and variables in the dataset and define the scale levels that will be used to generate lower-resolution overviews.</p>
<div id="14" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>scales <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">64</span>, <span class="dv">128</span>]  <span class="co"># Scale factors for each level</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>variables <span class="op">=</span> [var <span class="cf">for</span> var <span class="kw">in</span> dataset.data_vars]  <span class="co"># Discover variables</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>spatial_dims <span class="op">=</span> [dim <span class="cf">for</span> dim <span class="kw">in</span> dataset.dims]  <span class="co"># Discover dimensions</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>x_dim <span class="op">=</span> <span class="bu">next</span>((d <span class="cf">for</span> d <span class="kw">in</span> spatial_dims <span class="cf">if</span> d <span class="kw">in</span> [<span class="st">'x'</span>, <span class="st">'X'</span>, <span class="st">'lon'</span>, <span class="st">'longitude'</span>]), <span class="st">'x'</span>)  <span class="co"># Identify x dimension</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>y_dim <span class="op">=</span> <span class="bu">next</span>((d <span class="cf">for</span> d <span class="kw">in</span> spatial_dims <span class="cf">if</span> d <span class="kw">in</span> [<span class="st">'y'</span>, <span class="st">'Y'</span>, <span class="st">'lat'</span>, <span class="st">'latitude'</span>]), <span class="st">'y'</span>)  <span class="co"># Identify y dimension</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Variables: </span><span class="sc">{</span>variables<span class="sc">}</span><span class="ss"> | Dims: </span><span class="sc">{</span>spatial_dims<span class="sc">}</span><span class="ss"> | Shape: </span><span class="sc">{</span>dataset[variables[<span class="dv">0</span>]]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss"> | Using: x_dim='</span><span class="sc">{</span>x_dim<span class="sc">}</span><span class="ss">', y_dim='</span><span class="sc">{</span>y_dim<span class="sc">}</span><span class="ss">'</span><span class="ch">\n</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables: ['b02', 'b03', 'b04', 'b08'] | Dims: ['y', 'x'] | Shape: (10980, 10980) | Using: x_dim='x', y_dim='y'
</code></pre>
</div>
</div>
<p>Accessing such information allows us to generate a series of lower-resolution overview datasets directly in memory.</p>
<p>For each scale factor, we use xarray‚Äôs <code>coarsen()</code> function to average groups of pixels along the spatial dimensions (x, y). Each coarsened version is stored under a level name like L1, L2, etc., representing progressively coarser spatial resolutions.</p>
<div id="16" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>overviews <span class="op">=</span> {}  <span class="co"># Generate in-memory overview datasets</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, factor <span class="kw">in</span> <span class="bu">enumerate</span>(scales):</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    level_id <span class="op">=</span> <span class="ss">f"L</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    coarsened <span class="op">=</span> dataset.coarsen({x_dim: factor, y_dim: factor}, boundary<span class="op">=</span><span class="st">"trim"</span>).mean()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    overviews[level_id] <span class="op">=</span> coarsened[variables]</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Created </span><span class="sc">{</span><span class="bu">len</span>(overviews)<span class="sc">}</span><span class="ss"> overview levels:"</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> level_id, level_ds <span class="kw">in</span> overviews.items():</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>level_id<span class="sc">}</span><span class="ss">: shape </span><span class="sc">{</span>level_ds[variables[<span class="dv">0</span>]]<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">, dims </span><span class="sc">{</span><span class="bu">dict</span>(level_ds.dims)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Overview datasets created successfully (in memory only, not written to disk)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Created 7 overview levels:
  L1: shape (5490, 5490), dims {'y': 5490, 'x': 5490}
  L2: shape (2745, 2745), dims {'y': 2745, 'x': 2745}
  L3: shape (1372, 1372), dims {'y': 1372, 'x': 1372}
  L4: shape (686, 686), dims {'y': 686, 'x': 686}
  L5: shape (343, 343), dims {'y': 343, 'x': 343}
  L6: shape (171, 171), dims {'y': 171, 'x': 171}
  L7: shape (85, 85), dims {'y': 85, 'x': 85}

Overview datasets created successfully (in memory only, not written to disk)</code></pre>
</div>
</div>
</section>
<section id="attach-multiscales-metadata" class="level2">
<h2 class="anchored" data-anchor-id="attach-multiscales-metadata">Attach Multiscales Metadata</h2>
<p>Once the data has been processed, relating it with the GeoZarr-compliant metadata will enhance the application and self description:</p>
<ul>
<li><strong>Version</strong>: Schema version (‚Äú1.0‚Äù)</li>
<li><strong>Resampling method</strong>: How data was aggregated (‚Äúaverage‚Äù)</li>
<li><strong>Variables</strong>: Which bands have overviews</li>
<li><strong>Layout</strong>: The complete hierarchy including L0 (base) and all derived levels</li>
</ul>
<p>The metadata is stored in <code>dataset.attrs["multiscales"]</code> following the GeoZarr Overviews specification. This ensures interoperability with GeoZarr-aware tools and libraries.</p>
<p>Here we prepare the information needed to describe the overview hierarchy in the GeoZarr metadata. We set <code>overview_path</code> to indicate where the overview groups will be stored, record the <code>resampling_method("average")</code> used to create them, and compute the base spatial resolutions (<code>x_res</code> and <code>y_res</code>) from the coordinate spacing.</p>
<div id="19" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>overview_path <span class="op">=</span> <span class="st">"overviews"</span>  <span class="co"># Where overviews are written ("." for direct children)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>resampling_method <span class="op">=</span> <span class="st">"average"</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>x_res <span class="op">=</span> <span class="bu">abs</span>(<span class="bu">float</span>(dataset[<span class="st">'x'</span>].values[<span class="dv">1</span>] <span class="op">-</span> dataset[<span class="st">'x'</span>].values[<span class="dv">0</span>]))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>y_res <span class="op">=</span> <span class="bu">abs</span>(<span class="bu">float</span>(dataset[<span class="st">'y'</span>].values[<span class="dv">1</span>] <span class="op">-</span> dataset[<span class="st">'y'</span>].values[<span class="dv">0</span>]))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now, we build the multiscales layout metadata that describes how all overview levels relate to the base dataset.</p>
<p>The first entry (L0) represents the original data, including its spatial resolution (cell_size). Each subsequent level (L1, L2, ‚Ä¶) is added to the layout with information about its path, the level it was derived from, the scale factors applied, the resampling method, and its corresponding cell size.</p>
<p>Finally, this complete structure is stored in <code>dataset.attrs["multiscales"]</code> following the GeoZarr Overviews specification (draft). The printed JSON summary shows the final metadata layout that GeoZarr-aware tools can use to identify and navigate between resolution levels.</p>
<div id="21" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>layout <span class="op">=</span> [{<span class="st">"id"</span>: <span class="st">"L0"</span>, <span class="st">"path"</span>: <span class="st">"."</span>, <span class="st">"cell_size"</span>: [x_res, y_res]}]  <span class="co"># Base level (native data at current group)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, factor <span class="kw">in</span> <span class="bu">enumerate</span>(scales):</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    level_id <span class="op">=</span> <span class="ss">f"L</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    level_path <span class="op">=</span> level_id <span class="cf">if</span> overview_path <span class="op">==</span> <span class="st">"."</span> <span class="cf">else</span> <span class="ss">f"</span><span class="sc">{</span>overview_path<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>level_id<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    level_cell_size <span class="op">=</span> [x_res <span class="op">*</span> factor, y_res <span class="op">*</span> factor]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    layout.append({<span class="st">"id"</span>: level_id, <span class="st">"path"</span>: level_path, <span class="st">"derived_from"</span>: <span class="st">"L0"</span> <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="ss">f"L</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>, <span class="st">"factors"</span>: [factor, factor], <span class="st">"resampling_method"</span>: resampling_method, <span class="st">"cell_size"</span>: level_cell_size})</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>dataset.attrs[<span class="st">"multiscales"</span>] <span class="op">=</span> {<span class="st">"version"</span>: <span class="st">"1.0"</span>, <span class="st">"resampling_method"</span>: resampling_method, <span class="st">"variables"</span>: variables, <span class="st">"layout"</span>: layout}</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Metadata structure:"</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(json.dumps(dataset.attrs[<span class="st">"multiscales"</span>], indent<span class="op">=</span><span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Metadata structure:
{
  "version": "1.0",
  "resampling_method": "average",
  "variables": [
    "b02",
    "b03",
    "b04",
    "b08"
  ],
  "layout": [
    {
      "id": "L0",
      "path": ".",
      "cell_size": [
        10.0,
        10.0
      ]
    },
    {
      "id": "L1",
      "path": "overviews/L1",
      "derived_from": "L0",
      "factors": [
        2,
        2
      ],
      "resampling_method": "average",
      "cell_size": [
        20.0,
        20.0
      ]
    },
    {
      "id": "L2",
      "path": "overviews/L2",
      "derived_from": "L1",
      "factors": [
        4,
        4
      ],
      "resampling_method": "average",
      "cell_size": [
        40.0,
        40.0
      ]
    },
    {
      "id": "L3",
      "path": "overviews/L3",
      "derived_from": "L2",
      "factors": [
        8,
        8
      ],
      "resampling_method": "average",
      "cell_size": [
        80.0,
        80.0
      ]
    },
    {
      "id": "L4",
      "path": "overviews/L4",
      "derived_from": "L3",
      "factors": [
        16,
        16
      ],
      "resampling_method": "average",
      "cell_size": [
        160.0,
        160.0
      ]
    },
    {
      "id": "L5",
      "path": "overviews/L5",
      "derived_from": "L4",
      "factors": [
        32,
        32
      ],
      "resampling_method": "average",
      "cell_size": [
        320.0,
        320.0
      ]
    },
    {
      "id": "L6",
      "path": "overviews/L6",
      "derived_from": "L5",
      "factors": [
        64,
        64
      ],
      "resampling_method": "average",
      "cell_size": [
        640.0,
        640.0
      ]
    },
    {
      "id": "L7",
      "path": "overviews/L7",
      "derived_from": "L6",
      "factors": [
        128,
        128
      ],
      "resampling_method": "average",
      "cell_size": [
        1280.0,
        1280.0
      ]
    }
  ]
}</code></pre>
</div>
</div>
<div id="22" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>new_attrs <span class="op">=</span> dataset.attrs.copy()   <span class="co"># includes your multiscales metadata</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>json_bytes <span class="op">=</span> json.dumps(new_attrs).encode(<span class="st">"utf-8"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># FSMap stores values as bytes</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>r10m_store[<span class="st">'.zattrs'</span>] <span class="op">=</span> json_bytes</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="write-overviews-to-local-zarr-store" class="level3">
<h3 class="anchored" data-anchor-id="write-overviews-to-local-zarr-store">Write Overviews to Local Zarr Store</h3>
<p>The final step consists of adding the computed overviews to the Zarr store copy.</p>
<p><strong>Overview path options:</strong> - <code>overview_path="."</code> - Write overviews as direct children (L1, L2, L3, ‚Ä¶) - <code>overview_path="overviews"</code> - Write overviews in a subfolder (overviews/L1, overviews/L2, ‚Ä¶)</p>
<p><strong>Write operations:</strong> 1. <strong>Write L1-L5</strong> - Add overview levels as subgroups 2. <strong>Add metadata</strong> - Update group attributes with multiscales metadata</p>
<p><strong>Key point:</strong> Native data stays at the group level. The multiscales metadata uses <code>path: "."</code> for L0 to reference the existing native data without duplication.</p>
<p><strong>Result with <code>overview_path="."</code>:</strong></p>
<pre><code>measurements/reflectance/r10m/
‚îú‚îÄ‚îÄ b02, b03, b04, b08  # Native data (L0 via path=".")
‚îú‚îÄ‚îÄ x, y                # Coordinates
‚îú‚îÄ‚îÄ L1/                 # Overview levels (direct children)
‚îú‚îÄ‚îÄ L2/
‚îú‚îÄ‚îÄ L3/
‚îú‚îÄ‚îÄ L4/
‚îú‚îÄ‚îÄ L5/
‚îî‚îÄ‚îÄ .zattrs             # multiscales metadata</code></pre>
<p><strong>Alternative with <code>overview_path="overviews"</code>:</strong></p>
<pre><code>measurements/reflectance/r10m/
‚îú‚îÄ‚îÄ b02, b03, b04, b08  # Native data (L0 via path=".")
‚îú‚îÄ‚îÄ x, y                # Coordinates
‚îú‚îÄ‚îÄ overviews/          # Overview levels in subfolder
‚îÇ   ‚îú‚îÄ‚îÄ L1/
‚îÇ   ‚îú‚îÄ‚îÄ L2/
‚îÇ   ‚îú‚îÄ‚îÄ L3/
‚îÇ   ‚îú‚îÄ‚îÄ L4/
‚îÇ   ‚îî‚îÄ‚îÄ L5/
‚îî‚îÄ‚îÄ .zattrs             # multiscales metadata</code></pre>
<div id="24" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Adding overviews to </span><span class="sc">{</span>variable_group_path<span class="sc">}</span><span class="ss"> | Variables: </span><span class="sc">{</span>variables<span class="sc">}</span><span class="ss"> | Path: '</span><span class="sc">{</span>overview_path<span class="sc">}</span><span class="ss">'</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the overview group folder on S3</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>zarr.open_group(store<span class="op">=</span>base_store, mode<span class="op">=</span><span class="st">"a"</span>, zarr_version<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Writing </span><span class="sc">{</span><span class="bu">len</span>(overviews)<span class="sc">}</span><span class="ss"> overview levels..."</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> level_id, level_dataset <span class="kw">in</span> overviews.items():</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    level_store <span class="op">=</span> fs.get_mapper(</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>bucket<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>store_path<span class="sc">}</span><span class="ss">/"</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>variable_group_path<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>overview_path<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>level_id<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    level_dataset.to_zarr(</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        store<span class="op">=</span>level_store,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"a"</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>        zarr_version<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Write coordinates + attrs into r10m group</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>coords_only <span class="op">=</span> xr.Dataset(coords<span class="op">=</span>dataset.coords, attrs<span class="op">=</span>dataset.attrs)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>coords_only.to_zarr(</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    store<span class="op">=</span>r10m_store,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    mode<span class="op">=</span><span class="st">"a"</span>,</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    zarr_version<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Generating consolidated metadata for </span><span class="sc">{</span>overview_path<span class="sc">}</span><span class="ss">/"</span>)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>zarr.consolidate_metadata(store<span class="op">=</span>base_store)</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Successfully added overviews to </span><span class="sc">{</span>variable_group_path<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final structure:</span><span class="ch">\n</span><span class="ss">  </span><span class="sc">{</span>variable_group_path<span class="sc">}</span><span class="ss">/"</span>)</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"    ‚îú‚îÄ‚îÄ </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(variables)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"    ‚îú‚îÄ‚îÄ </span><span class="sc">{</span>x_dim<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>y_dim<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"    ‚îú‚îÄ‚îÄ </span><span class="sc">{</span>overview_path<span class="sc">}</span><span class="ss">/"</span>)</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> level_id <span class="kw">in</span> overviews.keys():</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"    ‚îÇ   ‚îú‚îÄ‚îÄ </span><span class="sc">{</span>level_id<span class="sc">}</span><span class="ss">/"</span>)</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"    ‚îî‚îÄ‚îÄ .zattrs"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Adding overviews to measurements/reflectance/r10m | Variables: ['b02', 'b03', 'b04', 'b08'] | Path: 'overviews'

Writing 7 overview levels...
Generating consolidated metadata for overviews/

Successfully added overviews to measurements/reflectance/r10m

Final structure:
  measurements/reflectance/r10m/
    ‚îú‚îÄ‚îÄ b02, b03, b04, b08
    ‚îú‚îÄ‚îÄ x, y
    ‚îú‚îÄ‚îÄ overviews/
    ‚îÇ   ‚îú‚îÄ‚îÄ L1/
    ‚îÇ   ‚îú‚îÄ‚îÄ L2/
    ‚îÇ   ‚îú‚îÄ‚îÄ L3/
    ‚îÇ   ‚îú‚îÄ‚îÄ L4/
    ‚îÇ   ‚îú‚îÄ‚îÄ L5/
    ‚îÇ   ‚îú‚îÄ‚îÄ L6/
    ‚îÇ   ‚îú‚îÄ‚îÄ L7/
    ‚îî‚îÄ‚îÄ .zattrs</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="now-it-is-your-turn" class="level2">
<h2 class="anchored" data-anchor-id="now-it-is-your-turn">üí™ Now it is your turn</h2>
<p>With everything we have learnt so far, you are now able to create multiscale overviews for your own datasets.</p>
<section id="task-1-experiment-with-different-scale-factors" class="level3">
<h3 class="anchored" data-anchor-id="task-1-experiment-with-different-scale-factors">Task 1: Experiment With Different Scale Factors</h3>
<p>Try modifying the <code>scales</code> list to create different pyramid structures. For example: - <strong>Fewer levels</strong>: <code>scales = [2, 4, 8]</code> for a smaller pyramid - <strong>More aggressive downsampling</strong>: <code>scales = [4, 16, 64]</code> for rapid zoom levels - <strong>Fine-grained levels</strong>: <code>scales = [2, 3, 4, 6, 8]</code> for smoother transitions</p>
</section>
<section id="task-2-apply-to-your-own-dataset" class="level3">
<h3 class="anchored" data-anchor-id="task-2-apply-to-your-own-dataset">Task 2: Apply To Your Own Dataset</h3>
<p>Use this notebook as a template for your own Earth Observation data: 1. Replace the URL with your own Zarr dataset 2. Let the code discover variables and dimensions automatically 3. Adjust scale factors based on your data resolution 4. Validate and write the results</p>
<br>
<hr>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This tutorial demonstrated the complete workflow for creating GeoZarr-compliant multiscale overviews:</p>
<ol type="1">
<li>‚úÖ Load and discover dataset structure automatically</li>
<li>‚úÖ Compute overview levels in memory (no disk I/O)</li>
<li>‚úÖ Attach specification-compliant metadata</li>
<li>‚úÖ Write to Zarr storage</li>
</ol>
<p><strong>Key takeaways:</strong> - The <strong>compute-then-write pattern</strong> separates computation from I/O - <strong>Dynamic discovery</strong> makes code adaptable to different datasets</p>
<br>
<hr>
</section>
<section id="whats-next" class="level2">
<h2 class="anchored" data-anchor-id="whats-next">What‚Äôs next?</h2>
<p>In <a href="../06_eopf_zarr_in_action/66_use_overviews.html">the next notebook of this chapter</a> we will visualise the generated overviews with map libraries for progressive rendering.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../06_eopf_zarr_in_action/64_flood_mapping_valencia.html" class="pagination-link" aria-label="Flood Mapping - Time Series Analysis in Valencia">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Flood Mapping - Time Series Analysis in Valencia</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../06_eopf_zarr_in_action/65_reservoir_surface_monitoring.html" class="pagination-link" aria-label="Reservoir Surface Monitoring">
        <span class="nav-page-text"><span class="chapter-title">Reservoir Surface Monitoring</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Development Seed, thriveGEO and SparkGeo</p>
</div>   
    <div class="nav-footer-center">
<p>License: Apache 2.0</p>
</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link active" href="https://github.com/eopf-toolkit/eopf-101" aria-current="page">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>