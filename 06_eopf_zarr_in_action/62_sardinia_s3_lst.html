<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Fire in Sardinia 2025 - Part 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../06_eopf_zarr_in_action/63_sardinia_dNBR.html" rel="next">
<link href="../06_eopf_zarr_in_action/61_sardinia_s2_tfci.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-0dd2bd5de344125cf763a379ddc3eb04.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<!-- Privacy-friendly analytics by Plausible -->
<script async="" src="https://plausible.io/js/pa-IdJjKOvKq9lif5cw4UK5i.js"></script>
<script>
  window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
  plausible.init()
</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../06_eopf_zarr_in_action/61_sardinia_s2_tfci.html"><strong>EOPF Zarr in Action</strong></a></li><li class="breadcrumb-item"><a href="../06_eopf_zarr_in_action/62_sardinia_s3_lst.html"><span class="chapter-title">Fire in Sardinia 2025 - Part 2</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../img/EOPF_FINAL_LOGO.png" alt="" class="sidebar-logo light-content py-0 d-lg-inline d-none">
      <img src="../img/EOPF_FINAL_LOGO.png" alt="" class="sidebar-logo dark-content py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://github.com/eopf-toolkit/eopf-101" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title"><strong>ESA EOPF 101</strong></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>About EOPF</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_about_eopf/11_about_eopf.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introduction to the EOPF</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_about_eopf/12_about_cloudoptimized_formats.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">About cloud-optimised formats</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_about_eopf/13_overview_eopf_datasets.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Overview of EOPF Zarr Products</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>About EOPF Zarr</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_about_eopf_zarr/21_what_is_zarr.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Overview of the EOPF Zarr format</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_about_eopf_zarr/22_zarr_structure_S1GRD.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Discover EOPF Zarr - Sentinel-1 GRD</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_about_eopf_zarr/23_S1_basic_operations.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Operations with EOPF Zarr - Sentinel-1 GRD</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_about_eopf_zarr/24_zarr_struct_S2L2A.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Discover EOPF Zarr - Sentinel-2 L2A</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_about_eopf_zarr/25_zarr_struct_S3.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Discover EOPF Zarr - Sentinel-3 SLSTR Level-2 LST</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>About Chunking</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_about_chunking/31_zarr_chunking_intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">An introduction to Chunking</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_about_chunking/32_zarr_chunking_strat.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Best practices and Chunking optimisation in EOPF</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>EOPF and STAC</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_eopf_and_stac/41_stac_intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introduction to STAC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_eopf_and_stac/42_eopf_stac_zarr_tutorial.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Explore the web interface of the EOPF Zarr STAC Catalog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_eopf_and_stac/43_eopf_stac_connection.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Access the EOPF Zarr STAC API with Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_eopf_and_stac/44_eopf_stac_xarray_tutorial.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">From STAC to Data: Accessing EOPF Zarr with xarray</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>Tools to work with EOPF Zarr</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_zarr_tools/51_eopf_stac_r.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Access the EOPF Zarr STAC API with R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_zarr_tools/52_eopf_stac_qgis.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Access EOPF Zarr in QGIS Using STAC</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>EOPF Zarr in Action</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_eopf_zarr_in_action/61_sardinia_s2_tfci.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Fire in Sardinia 2025 - Part 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_eopf_zarr_in_action/62_sardinia_s3_lst.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Fire in Sardinia 2025 - Part 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_eopf_zarr_in_action/63_sardinia_dNBR.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Fire in Sardinia 2025 - Part 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_eopf_zarr_in_action/64_flood_mapping_valencia.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Flood Mapping - Time Series Analysis in Valencia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_eopf_zarr_in_action/65_create_overviews.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Creating Zarr Overviews</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_eopf_zarr_in_action/65_reservoir_surface_monitoring.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Reservoir Surface Monitoring</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_eopf_zarr_in_action/66_use_overviews.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Visualising Multiscale Pyramids</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../glossary.html" class="sidebar-item-text sidebar-link"><span class="chapter-title"><strong>Glossary</strong></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link"><span class="chapter-title"><strong>References</strong></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#what-we-will-learn" id="toc-what-we-will-learn" class="nav-link" data-scroll-target="#what-we-will-learn">What we will learn</a></li>
  <li><a href="#setting-up-the-environment" id="toc-setting-up-the-environment" class="nav-link" data-scroll-target="#setting-up-the-environment">Setting up the environment</a>
  <ul class="collapse">
  <li><a href="#initiate-a-dask-cluster" id="toc-initiate-a-dask-cluster" class="nav-link" data-scroll-target="#initiate-a-dask-cluster">Initiate a Dask cluster</a></li>
  <li><a href="#establish-a-connection-to-the-eopf-stac-catalog" id="toc-establish-a-connection-to-the-eopf-stac-catalog" class="nav-link" data-scroll-target="#establish-a-connection-to-the-eopf-stac-catalog">Establish a connection to the EOPF STAC Catalog</a></li>
  <li><a href="#define-search-paramters" id="toc-define-search-paramters" class="nav-link" data-scroll-target="#define-search-paramters">Define search paramters</a></li>
  </ul></li>
  <li><a href="#overview-of-processing-steps" id="toc-overview-of-processing-steps" class="nav-link" data-scroll-target="#overview-of-processing-steps">Overview of processing steps</a>
  <ul class="collapse">
  <li><a href="#retrieve-land-surface-temperature-lst-from-sentinel-3-slstr-l2" id="toc-retrieve-land-surface-temperature-lst-from-sentinel-3-slstr-l2" class="nav-link" data-scroll-target="#retrieve-land-surface-temperature-lst-from-sentinel-3-slstr-l2">Retrieve Land Surface Temperature (LST) from Sentinel-3 SLSTR L2</a></li>
  <li><a href="#create-sentinel-2-l2a-true-color-composite" id="toc-create-sentinel-2-l2a-true-color-composite" class="nav-link" data-scroll-target="#create-sentinel-2-l2a-true-color-composite">Create Sentinel-2 L2A True-Color composite</a></li>
  <li><a href="#overlay-sentinel-2-true-color-composite-with-sentinel-3-lst-data" id="toc-overlay-sentinel-2-true-color-composite-with-sentinel-3-lst-data" class="nav-link" data-scroll-target="#overlay-sentinel-2-true-color-composite-with-sentinel-3-lst-data">Overlay Sentinel-2 True-Color composite with Sentinel-3 LST data</a></li>
  <li><a href="#calculating-processing-time" id="toc-calculating-processing-time" class="nav-link" data-scroll-target="#calculating-processing-time">Calculating processing time</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#whats-next" id="toc-whats-next" class="nav-link" data-scroll-target="#whats-next">What‚Äôs next?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../06_eopf_zarr_in_action/61_sardinia_s2_tfci.html"><strong>EOPF Zarr in Action</strong></a></li><li class="breadcrumb-item"><a href="../06_eopf_zarr_in_action/62_sardinia_s3_lst.html"><span class="chapter-title">Fire in Sardinia 2025 - Part 2</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">Fire in Sardinia 2025 - Part 2</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><a href="https://jupyterhub.user.eopf.eodc.eu/hub/login?next=%2Fhub%2Fspawn%3Fnext%3D%252Fhub%252Fuser-redirect%252Fgit-pull%253Frepo%253Dhttps%253A%252F%252Fgithub.com%252Feopf-toolkit%252Feopf-101%2526branch%253Dmain%2526urlpath%253Dlab%252Ftree%252Feopf-101%252F06_eopf_zarr_in_action%252F62_sardinia_s3_lst.ipynb%23fancy-forms-config=%7B%22profile%22%3A%22choose-your-environment%22%2C%22image%22%3A%22unlisted_choice%22%2C%22image%3Aunlisted_choice%22%3A%224zm3809f.c1.de1.container-registry.ovh.net%2Feopf-toolkit-python%2Feopf-toolkit-python%3Alatest%22%2C%22autoStart%22%3A%22true%22%7D" target="_blank"> <button style="background-color:#0072ce; color:white; padding:0.6em 1.2em; font-size:1rem; border:none; border-radius:6px; margin-top:1em;"> üöÄ Launch this notebook in JupyterLab </button> </a></p>
<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction">Introduction</h3>
<p>On <strong>June 10th, 2025</strong>, a significant wildfire in Italy‚Äôs Nuoro Province in Sardinia burned approximately 1000 hectares, a scale that is clearly visible in satellite imagery with a 20-meter resolution. <a href="https://forest-fire.emergency.copernicus.eu/apps/effis_current_situation/">The European Forest Fire Information System (EFFIS)</a> keeps record of these events.</p>
<p>This notebook demonstrates how two different <code>.zarr</code> encoded <strong>Sentinel Mission products</strong> can be combined to provide a compelling and informative overview of an active fire event.<br></p>
<p>First, we will use reflectance data from <strong>Sentinel-2 L2A</strong> to locate the area of the fire on the ground. At the same time, we will use data from <strong>Sentinel-3 SLSTR Land Surface Temperature</strong> (LST) to demonstrate the intense heat emanating from the fire.</p>
<p>By combining these two datasets, we will not only be able to see the fire location and its state on the day of the event, but also understand its thermal intensity, providing a more complete perspective on its dynamics.</p>
<p>This notebook is the second a series of three notebook:</p>
<ul>
<li><a href="../06_eopf_zarr_in_action/61_sardinia_s2_tfci.html">Part 1 - Compare Sentinel-2 True- and False-Color composites before and after a fire event</a></li>
<li><strong>Part 2 - Analyse fire intensity with Sentinel-2 and -3 data</strong></li>
<li><a href="../06_eopf_zarr_in_action/63_sardinia_dNBR.html">Part 3 - Assess burn severity with the normalised burn ratio (dNBR)</a></li>
</ul>
</section>
<section id="what-we-will-learn" class="level3">
<h3 class="anchored" data-anchor-id="what-we-will-learn">What we will learn</h3>
<ul>
<li>‚úÇÔ∏è Extract and clip data from Sentinel-3 SLSTR L2</li>
<li>üõ∞Ô∏è Visualise potential fires based on the relationship between Sentinel-2 and Sentinel-3 available items through the <a href="">EOPF STAC Catalog</a></li>
<li>üî≠ Demostrate the smooth multi-mission integration capabilities <code>.zarr</code> format offers to the community</li>
</ul>
<hr>
<section id="import-libraries" class="level4">
<h4 class="anchored" data-anchor-id="import-libraries">Import libraries</h4>
<div id="7" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> distributed <span class="im">import</span> LocalCluster</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac_client <span class="im">import</span> Client</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyproj <span class="im">import</span> Transformer</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartopy.crs <span class="im">as</span> ccrs</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartopy.feature <span class="im">as</span> cfeature</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> skimage <span class="im">import</span> exposure</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> BoundaryNorm, ListedColormap</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="helper-functions" class="level4">
<h4 class="anchored" data-anchor-id="helper-functions">Helper functions</h4>
<p>This notebook makes use of a set of functions that are all listed inside the <a href="./zarr_wf_utils.py">zarr_wf_utils.py</a> script. Inside the script, we will find costumised functions that allow us to mask, normalise and extract specific areas of our items of interest.</p>
<div id="10" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import our utility functions</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> zarr_wf_utils <span class="im">import</span> (</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    validate_scl,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    mask_sub_utm,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    normalisation_str_gm,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    mask_sub_latlon,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    lat_lon_to_utm_box,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    zarr_mask_latlon</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
</section>
</section>
<section id="setting-up-the-environment" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-the-environment">Setting up the environment</h2>
<section id="initiate-a-dask-cluster" class="level3">
<h3 class="anchored" data-anchor-id="initiate-a-dask-cluster">Initiate a Dask cluster</h3>
<p>The first step is to initiate a <strong>virtual Dask cluster</strong>. This cluster consists of a scheduler (the ‚Äúbrain‚Äù) and several workers (the ‚Äúhands‚Äù), which enables faster processing of large datasets by breaking down tasks and running them in parallel.</p>
<p>A client is then created to manage communication between the code and this cluster. For more information, feel free to visit the <strong>dask</strong> <a href="https://docs.dask.org/en/stable/">documentation</a> and the tutorial <a href="http://docs.dask.org/en/stable/#how-to-use-dask">How to use dask</a>.</p>
<div id="15" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we are interested in the performance the code will have</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>st <span class="op">=</span> time.time()</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>cluster <span class="op">=</span> LocalCluster()</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> cluster.get_client()</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>client</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>
    <div style="width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;"> </div>
    <div style="margin-left: 48px;">
        <h3 style="margin-bottom: 0px;" class="anchored">Client</h3>
        <p style="color: #9D9D9D; margin-bottom: 0px;">Client-96d771cc-eae6-11f0-8ff4-aaf5311b8903</p>
        
<table class="caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Connection method:</strong> Cluster object</td>
<td style="text-align: left;"><strong>Cluster type:</strong> distributed.LocalCluster</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:8787/status" target="_blank">http://127.0.0.1:8787/status</a></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>


        

        
            <details>
            <summary style="margin-bottom: 20px;"><h3 style="display: inline;" class="anchored">Cluster Info</h3></summary>
            <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output">
    <div style="width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;">
    </div>
    <div style="margin-left: 48px;">
        <h3 style="margin-bottom: 0px; margin-top: 0px;" class="anchored">LocalCluster</h3>
        <p style="color: #9D9D9D; margin-bottom: 0px;">a4b02ae3</p>
        
<table class="caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:8787/status" target="_blank">http://127.0.0.1:8787/status</a></td>
<td style="text-align: left;"><strong>Workers:</strong> 4</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Total threads:</strong> 8</td>
<td style="text-align: left;"><strong>Total memory:</strong> 31.35 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Status:</strong> running</td>
<td style="text-align: left;"><strong>Using processes:</strong> True</td>
</tr>
</tbody>
</table>


        <details>
            <summary style="margin-bottom: 20px;">
                <h3 style="display: inline;" class="anchored">Scheduler Info</h3>
            </summary>

            <div style="">
    <div>
        <div style="width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;"> </div>
        <div style="margin-left: 48px;">
            <h3 style="margin-bottom: 0px;" class="anchored">Scheduler</h3>
            <p style="color: #9D9D9D; margin-bottom: 0px;">Scheduler-eff7bbd0-12c7-4a5c-8a7d-cde09d4db851</p>
            
<table class="caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:39023</td>
<td style="text-align: left;"><strong>Workers:</strong> 0</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:8787/status" target="_blank">http://127.0.0.1:8787/status</a></td>
<td style="text-align: left;"><strong>Total threads:</strong> 0</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Started:</strong> Just now</td>
<td style="text-align: left;"><strong>Total memory:</strong> 0 B</td>
</tr>
</tbody>
</table>

        </div>
    </div>

    <details style="margin-left: 48px;">
        <summary style="margin-bottom: 20px;">
            <h3 style="display: inline;" class="anchored">Workers</h3>
        </summary>

        
        <div style="margin-bottom: 20px;">
            <div style="width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;"> </div>
            <div style="margin-left: 48px;">
            <details>
                <summary>
                    <h4 style="margin-bottom: 0px; display: inline;" class="anchored">Worker: 0</h4>
                </summary>
                
<table class="caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:38869</td>
<td style="text-align: left;"><strong>Total threads:</strong> 2</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:35197/status" target="_blank">http://127.0.0.1:35197/status</a></td>
<td style="text-align: left;"><strong>Memory:</strong> 7.84 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Nanny:</strong> tcp://127.0.0.1:39195</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td colspan="2" style="text-align: left;"><strong>Local directory:</strong> /tmp/dask-scratch-space/worker-b11gpfc1</td>
</tr>
</tbody>
</table>

            </details>
            </div>
        </div>
        
        <div style="margin-bottom: 20px;">
            <div style="width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;"> </div>
            <div style="margin-left: 48px;">
            <details>
                <summary>
                    <h4 style="margin-bottom: 0px; display: inline;" class="anchored">Worker: 1</h4>
                </summary>
                
<table class="caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:36039</td>
<td style="text-align: left;"><strong>Total threads:</strong> 2</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:45879/status" target="_blank">http://127.0.0.1:45879/status</a></td>
<td style="text-align: left;"><strong>Memory:</strong> 7.84 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Nanny:</strong> tcp://127.0.0.1:40115</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td colspan="2" style="text-align: left;"><strong>Local directory:</strong> /tmp/dask-scratch-space/worker-amcsn119</td>
</tr>
</tbody>
</table>

            </details>
            </div>
        </div>
        
        <div style="margin-bottom: 20px;">
            <div style="width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;"> </div>
            <div style="margin-left: 48px;">
            <details>
                <summary>
                    <h4 style="margin-bottom: 0px; display: inline;" class="anchored">Worker: 2</h4>
                </summary>
                
<table class="caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:34333</td>
<td style="text-align: left;"><strong>Total threads:</strong> 2</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:38629/status" target="_blank">http://127.0.0.1:38629/status</a></td>
<td style="text-align: left;"><strong>Memory:</strong> 7.84 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Nanny:</strong> tcp://127.0.0.1:35273</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td colspan="2" style="text-align: left;"><strong>Local directory:</strong> /tmp/dask-scratch-space/worker-lkm5b_h8</td>
</tr>
</tbody>
</table>

            </details>
            </div>
        </div>
        
        <div style="margin-bottom: 20px;">
            <div style="width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;"> </div>
            <div style="margin-left: 48px;">
            <details>
                <summary>
                    <h4 style="margin-bottom: 0px; display: inline;" class="anchored">Worker: 3</h4>
                </summary>
                
<table class="caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:45613</td>
<td style="text-align: left;"><strong>Total threads:</strong> 2</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:46879/status" target="_blank">http://127.0.0.1:46879/status</a></td>
<td style="text-align: left;"><strong>Memory:</strong> 7.84 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Nanny:</strong> tcp://127.0.0.1:34483</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td colspan="2" style="text-align: left;"><strong>Local directory:</strong> /tmp/dask-scratch-space/worker-ii_8bpxu</td>
</tr>
</tbody>
</table>

            </details>
            </div>
        </div>
        

    </details>
</div>

        </details>
    </div>
</div>
            </details>
        

    </div>
</div>
</div>
</div>
</section>
<section id="establish-a-connection-to-the-eopf-stac-catalog" class="level3">
<h3 class="anchored" data-anchor-id="establish-a-connection-to-the-eopf-stac-catalog">Establish a connection to the EOPF STAC Catalog</h3>
<p>Data is retrieved from the <a href="https://stac.browser.user.eopf.eodc.eu/?.language=en">EOPF STAC Catalogue</a> endpoint. Once the connection is established, we can query the catalog based on specific search criteria.</p>
<div id="18" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>eopf_stac_api_root_endpoint <span class="op">=</span> <span class="st">"https://stac.core.eopf.eodc.eu/"</span> <span class="co">#root starting point</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>eopf_catalog <span class="op">=</span> Client.<span class="bu">open</span>(url<span class="op">=</span>eopf_stac_api_root_endpoint) <span class="co"># calls the selected url</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>eopf_catalog</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="4">


<style>
.pystac-summary {
    cursor: pointer;
    display: list-item;
    list-style: revert;
    margin-bottom: 0 !important;

    .pystac-l {
        padding-left: 0.5em;
        color: rgb(64, 128, 128);
        font-style: italic;
    }
}
.pystac-row {
    overflow-wrap: break-word;
    padding-left: .825em;

    .pystac-k {
        display: inline-block;
        margin: 0px 0.5em 0px 0px;
    }
    .pystac-v {
        color: rgb(186, 33, 33);
    }
}
.pystac-k {
    color: rgb(0, 128, 0);
    font-weight: 700;
}
.pystac-wrap {
  display: block !important;
}
.pystac-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}
</style>
<div>
<div class="pystac-text-repr-fallback">
    &lt;Client id=eopf-sample-service-stac-api&gt;
</div>
<div class="jp-RenderedJSON jp-mod-trusted jp-OutputArea-output pystac-wrap" style="display:none">
    <div class="container" style="line-height: normal;">
        <ul style="padding: 0px; margin: 0px; list-style: none; display: block;">
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"Catalog"</span>
        </li>
    
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">id</span>
            <span class="pystac-v">"eopf-sample-service-stac-api"</span>
        </li>
    
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">stac_version</span>
            <span class="pystac-v">"1.1.0"</span>
        </li>
    
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">description</span>
            <span class="pystac-v">"STAC catalog of the EOPF Sentinel Zarr Samples Service"</span>
        </li>
    
                
            
                
                    <li><details>
        <summary class="pystac-summary"><span class="pystac-k">links</span><span class="pystac-l">[] 21 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">0</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"self"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">1</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"root"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"EOPF Sentinel Zarr Samples Service STAC API"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">2</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"data"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/collections"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">3</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"conformance"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/conformance"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"STAC/OGC conformance classes implemented by this server"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">4</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"search"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/search"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/geo+json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"STAC search"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">method</span>
            <span class="pystac-v">"GET"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">5</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"search"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/search"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/geo+json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"STAC search"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">method</span>
            <span class="pystac-v">"POST"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">6</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"http://www.opengis.net/def/rel/ogc/1.0/queryables"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/queryables"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/schema+json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Queryables"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">method</span>
            <span class="pystac-v">"GET"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">7</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/collections/sentinel-2-l2a"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Sentinel-2 Level-2A"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">8</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/collections/sentinel-3-slstr-l1-rbt"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Sentinel-3 SLSTR Level-1 RBT"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">9</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/collections/sentinel-2-l1c"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Sentinel-2 Level-1C"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">10</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/collections/sentinel-3-olci-l2-lrr"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Sentinel-3 OLCI Level-2 LRR"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">11</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/collections/sentinel-3-olci-l2-lfr"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Sentinel-3 OLCI Level-2 LFR"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">12</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/collections/sentinel-3-olci-l1-efr"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Sentinel-3 OLCI Level-1 EFR"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">13</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/collections/sentinel-1-l1-slc"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Sentinel-1 Level-1 SLC"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">14</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/collections/sentinel-1-l1-grd"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Sentinel-1 Level-1 GRD"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">15</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/collections/sentinel-1-l2-ocn"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Sentinel-1 Level-2 OCN"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">16</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/collections/sentinel-3-slstr-l2-frp"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Sentinel-3 SLSTR Level-2 FRP"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">17</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/collections/sentinel-3-slstr-l2-lst"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Sentinel-3 SLSTR Level-2 LST"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">18</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"child"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/collections/sentinel-3-olci-l1-err"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/json"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"Sentinel-3 OLCI Level-1 ERR"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">19</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"service-desc"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/api"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"application/vnd.oai.openapi+json;version=3.0"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"OpenAPI service description"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li><details>
            <summary class="pystac-summary"><span class="pystac-k">20</span></summary>
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">rel</span>
            <span class="pystac-v">"service-doc"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">href</span>
            <span class="pystac-v">"https://stac.core.eopf.eodc.eu/api.html"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">type</span>
            <span class="pystac-v">"text/html"</span>
        </li>
    
            
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"OpenAPI service documentation"</span>
        </li>
    
            
        
    </ul>
        </details></li>
    
            
        
    </ul>
        
    </details></li>
                
            
                
                    <li><details>
        <summary class="pystac-summary"><span class="pystac-k">conformsTo</span><span class="pystac-l">[] 21 items</span></summary>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">0</span>
            <span class="pystac-v">"http://www.opengis.net/spec/cql2/1.0/conf/basic-cql2"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">1</span>
            <span class="pystac-v">"http://www.opengis.net/spec/cql2/1.0/conf/cql2-json"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">2</span>
            <span class="pystac-v">"http://www.opengis.net/spec/cql2/1.0/conf/cql2-text"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">3</span>
            <span class="pystac-v">"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/core"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">4</span>
            <span class="pystac-v">"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/geojson"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">5</span>
            <span class="pystac-v">"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/oas30"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">6</span>
            <span class="pystac-v">"http://www.opengis.net/spec/ogcapi-features-3/1.0/conf/features-filter"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">7</span>
            <span class="pystac-v">"http://www.opengis.net/spec/ogcapi-features-3/1.0/conf/filter"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">8</span>
            <span class="pystac-v">"https://api.stacspec.org/v1.0.0-rc.2/item-search#filter"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">9</span>
            <span class="pystac-v">"https://api.stacspec.org/v1.0.0/collections"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">10</span>
            <span class="pystac-v">"https://api.stacspec.org/v1.0.0/collections/extensions/transaction"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">11</span>
            <span class="pystac-v">"https://api.stacspec.org/v1.0.0/core"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">12</span>
            <span class="pystac-v">"https://api.stacspec.org/v1.0.0/item-search"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">13</span>
            <span class="pystac-v">"https://api.stacspec.org/v1.0.0/item-search#fields"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">14</span>
            <span class="pystac-v">"https://api.stacspec.org/v1.0.0/item-search#query"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">15</span>
            <span class="pystac-v">"https://api.stacspec.org/v1.0.0/item-search#sort"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">16</span>
            <span class="pystac-v">"https://api.stacspec.org/v1.0.0/ogcapi-features"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">17</span>
            <span class="pystac-v">"https://api.stacspec.org/v1.0.0/ogcapi-features#fields"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">18</span>
            <span class="pystac-v">"https://api.stacspec.org/v1.0.0/ogcapi-features#query"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">19</span>
            <span class="pystac-v">"https://api.stacspec.org/v1.0.0/ogcapi-features#sort"</span>
        </li>
    
            
        
    </ul>
        
            <ul style="margin: 0px; padding: 0px 0px 0px 1.75em; list-style: none; display: block;">
        
            
                
        <li class="pystac-row">
            <span class="pystac-k">20</span>
            <span class="pystac-v">"https://api.stacspec.org/v1.0.0/ogcapi-features/extensions/transaction"</span>
        </li>
    
            
        
    </ul>
        
    </details></li>
                
            
                
                    
        <li class="pystac-row">
            <span class="pystac-k">title</span>
            <span class="pystac-v">"EOPF Sentinel Zarr Samples Service STAC API"</span>
        </li>
    
                
            
        </ul>
    </div>
</div>
</div>
</div>
</div>
</section>
<section id="define-search-paramters" class="level3">
<h3 class="anchored" data-anchor-id="define-search-paramters">Define search paramters</h3>
<div id="20" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The timeframe and area of interest for our filtering</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>fire_d <span class="op">=</span> <span class="st">'2025-06-11'</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>fire_d_s3 <span class="op">=</span> <span class="st">'2025-06-10'</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>def_collection <span class="op">=</span> <span class="st">''</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>search_bbox <span class="op">=</span> (<span class="fl">8.847198</span>,<span class="fl">40.193395</span>,<span class="fl">8.938865</span>,<span class="fl">40.241895</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Definition of the transformer parameters for reprojection and correct overlay of layers</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>transformer <span class="op">=</span> Transformer.from_crs(<span class="st">"EPSG:4326"</span>, <span class="st">"EPSG:32632"</span>, always_xy<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>t_utm_to_deg <span class="op">=</span> Transformer.from_crs(<span class="st">"EPSG:32632"</span>,<span class="st">"EPSG:4326"</span>, always_xy<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining a larger bounding box for better visualisation:</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>bbox_vis <span class="op">=</span> (<span class="fl">8.649555</span>,<span class="fl">40.073583</span>,<span class="fl">9.127893</span>,<span class="fl">40.343840</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># A fixed geographic bounding box to highlight the AOI in the map format</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>map_box <span class="op">=</span> search_bbox</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># A new list with the converted UTM coordinates</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>bbox_utm <span class="op">=</span> lat_lon_to_utm_box((bbox_vis[<span class="dv">0</span>], bbox_vis[<span class="dv">1</span>]),(bbox_vis[<span class="dv">2</span>], bbox_vis[<span class="dv">3</span>]), transformer)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert the coordinates of the map_box</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co"># map_box = lat_lon_to_utm_box((map_box[0], map_box[1]),(map_box[2], map_box[3]))</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="overview-of-processing-steps" class="level2">
<h2 class="anchored" data-anchor-id="overview-of-processing-steps">Overview of processing steps</h2>
<p>In the following, we will go through three main processing steps:<br></p>
<ul>
<li>Step 1: Retrieving and visualising Land Surface Temperature from Sentinel-3 SLSTR L2 data</li>
<li>Step 2: Creating a True-Color composite of Sentinel-2 L2A data, and</li>
<li>Step 3: Overlaying both datasets, the True-Color composite with the Land Surface Temperature information</li>
</ul>
<section id="retrieve-land-surface-temperature-lst-from-sentinel-3-slstr-l2" class="level3">
<h3 class="anchored" data-anchor-id="retrieve-land-surface-temperature-lst-from-sentinel-3-slstr-l2">Retrieve Land Surface Temperature (LST) from Sentinel-3 SLSTR L2</h3>
<p>Land Surface Temperature (LST) data, can be retrieved from the Sentinel-3 SLSTR L2 collection. This data helps to identify temperature anomalies over the Earth‚Äôs Surface, which can be a strong indicator of an active fire.</p>
<p>In the following, we query the EOPF STAC Catalog to retrieve Land Surface Temperature from Sentinel-3 SLSTR L2 data.</p>
<p>The search below introduces a new argument to the search: <code>query</code>. This argument allows us to go into the <code>.zarr</code> attributes metadata and filter based on specific parameters of the items we are interested in. We will filter for ‚Äú<strong>Non-Time Critical</strong>‚Äù items.</p>
<div id="25" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifying the Sentinel-3 SLSTR L2 LST collection name</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>def_collection <span class="op">=</span> <span class="st">'sentinel-3-slstr-l2-lst'</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Search the catalog for items matching the criteria:</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>s3_l2 <span class="op">=</span> <span class="bu">list</span>(eopf_catalog.search(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                bbox<span class="op">=</span> search_bbox,  <span class="co"># A bounding box input to define the area of interest</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                datetime<span class="op">=</span> fire_d_s3, <span class="co"># A datetime string input to specify the time range</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                collections<span class="op">=</span>def_collection, <span class="co"># The collection name to search within</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                query <span class="op">=</span> {<span class="st">"product:timeliness_category"</span>: {<span class="st">'eq'</span>:<span class="st">'NT'</span>}} <span class="co"># A query to filter by timeliness category</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                                                                     <span class="co"># in the Catalog</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                ).item_collection())</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the URLs for the product assets from the search results</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>av_urls <span class="op">=</span> [item.assets[<span class="st">"product"</span>].href <span class="cf">for</span> item <span class="kw">in</span> s3_l2]</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Search Results:"</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Total Items Found for Sentinel-3 SLSRT over Sardinia:  '</span>,<span class="bu">len</span>(av_urls))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Search Results:
Total Items Found for Sentinel-3 SLSRT over Sardinia:   5</code></pre>
</div>
</div>
<p>After filtering the catalog, we open the <strong>first</strong> available Sentinel-3 SLSTR item, which corresponds to our specific timeframe of the selected day.</p>
<p>For optimising the subsequent plotting, we can extract key information from the retrieved item, such as the date and the specific item time. Afterwards, we access the <strong>Land Surface Temperature</strong> (LST) asset. The LST data is available under the group <code>measurements</code>.</p>
<div id="27" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the last item from the list of URLs as a Zarr data tree</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>lst_zarr <span class="op">=</span> xr.open_datatree(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    av_urls[<span class="op">-</span><span class="dv">1</span>], <span class="co"># Input: URL of the last Zarr item in the av_urls list</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    engine<span class="op">=</span><span class="st">"zarr"</span> <span class="co"># Specify the Zarr engine for opening the file</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the start date and time from the data tree's metadata</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>date_zarr_lst <span class="op">=</span> lst_zarr.attrs[<span class="st">'stac_discovery'</span>][<span class="st">'properties'</span>][<span class="st">'start_datetime'</span>][:<span class="dv">10</span>]</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>time_zarr_lst <span class="op">=</span> lst_zarr.attrs[<span class="st">'stac_discovery'</span>][<span class="st">'properties'</span>][<span class="st">'start_datetime'</span>][<span class="dv">11</span>:<span class="dv">19</span>]</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Access the 'measurements' group within the data tree</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>meas_lst <span class="op">=</span> lst_zarr.measurements</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># The output is the measurements data group</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>meas_lst</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">GroupNotFoundError</span>                        Traceback (most recent call last)
<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/xarray/backends/zarr.py:1868</span>, in <span class="ansi-cyan-fg">_get_open_params</span><span class="ansi-blue-fg">(store, mode, synchronizer, group, consolidated, consolidate_on_close, chunk_store, storage_options, zarr_version, use_zarr_fill_value_as_mask, zarr_format)</span>
<span class="ansi-green-fg">   1867</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1868</span>     zarr_root_group = <span class="ansi-yellow-bg">zarr</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_consolidated</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">open_kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1869</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> (<span style="font-weight:bold;color:rgb(215,95,95)">ValueError</span>, <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>):
<span class="ansi-green-fg">   1870</span>     <span style="font-style:italic;color:rgb(95,135,135)"># ValueError in zarr-python 3.x, KeyError in 2.x.</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/api/synchronous.py:238</span>, in <span class="ansi-cyan-fg">open_consolidated</span><span class="ansi-blue-fg">(use_consolidated, *args, **kwargs)</span>
<span class="ansi-green-fg">    234</span> <span style="font-style:italic" class="ansi-yellow-fg">"""</span>
<span class="ansi-green-fg">    235</span> <span style="font-style:italic" class="ansi-yellow-fg">Alias for [`open_group`][zarr.api.synchronous.open_group] with ``use_consolidated=True``.</span>
<span class="ansi-green-fg">    236</span> <span style="font-style:italic" class="ansi-yellow-fg">"""</span>
<span class="ansi-green-fg">    237</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> Group(
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">238</span>     <span class="ansi-yellow-bg">sync</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">async_api</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_consolidated</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">use_consolidated</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">use_consolidated</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    239</span> )

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/core/sync.py:159</span>, in <span class="ansi-cyan-fg">sync</span><span class="ansi-blue-fg">(coro, loop, timeout)</span>
<span class="ansi-green-fg">    158</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(return_result, <span style="font-weight:bold;color:rgb(215,95,95)">BaseException</span>):
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">159</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> return_result
<span class="ansi-green-fg">    160</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/core/sync.py:119</span>, in <span class="ansi-cyan-fg">_runner</span><span class="ansi-blue-fg">(coro)</span>
<span class="ansi-green-fg">    118</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">119</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="font-weight:bold;color:rgb(0,135,0)">await</span> coro
<span class="ansi-green-fg">    120</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">Exception</span> <span style="font-weight:bold;color:rgb(0,135,0)">as</span> ex:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/api/asynchronous.py:415</span>, in <span class="ansi-cyan-fg">open_consolidated</span><span class="ansi-blue-fg">(use_consolidated, *args, **kwargs)</span>
<span class="ansi-green-fg">    411</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>(
<span class="ansi-green-fg">    412</span>         <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">use_consolidated</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg"> must be </span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">True</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg"> in </span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">open_consolidated</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">. Use </span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">open</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg"> with </span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">    413</span>         <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">use_consolidated=False</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg"> to bypass consolidated metadata.</span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">    414</span>     )
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">415</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="font-weight:bold;color:rgb(0,135,0)">await</span> open_group(*args, use_consolidated=use_consolidated, **kwargs)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/api/asynchronous.py:881</span>, in <span class="ansi-cyan-fg">open_group</span><span class="ansi-blue-fg">(store, mode, cache_attrs, synchronizer, path, chunk_store, storage_options, zarr_version, zarr_format, meta_array, attributes, use_consolidated)</span>
<span class="ansi-green-fg">    880</span> msg = <span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">No group found in store </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>store<span style="font-weight:bold;color:rgb(175,95,135)">!r}</span><span class="ansi-yellow-fg"> at path </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>store_path.path<span style="font-weight:bold;color:rgb(175,95,135)">!r}</span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">881</span> <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> GroupNotFoundError(msg)

<span class="ansi-red-fg">GroupNotFoundError</span>: No group found in store 'https://objects.eodc.eu:443/e05ab01a9d56408d82ac32d69a5aae2a:202506-s03slslst/10/products/cpm_v256/S3B_SL_2_LST____20250610T091849_20250610T092149_20250611T160034_0179_107_264_2340_ESA_O_NT_004.zarr' at path ''

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">GroupNotFoundError</span>                        Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[7]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> <span style="font-style:italic;color:rgb(95,135,135)"># Open the last item from the list of URLs as a Zarr data tree</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> lst_zarr = <span class="ansi-yellow-bg">xr</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_datatree</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">      3</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">av_urls</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">-</span><span class="ansi-green-fg ansi-yellow-bg">1</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="font-style:italic;color:rgb(95,135,135)" class="ansi-yellow-bg"># Input: URL of the last Zarr item in the av_urls list</span>
<span class="ansi-green-fg">      4</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">engine</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-fg ansi-yellow-bg">"</span><span class="ansi-yellow-fg ansi-yellow-bg">zarr</span><span class="ansi-yellow-fg ansi-yellow-bg">"</span><span class="ansi-yellow-bg"> </span><span style="font-style:italic;color:rgb(95,135,135)" class="ansi-yellow-bg"># Specify the Zarr engine for opening the file</span>
<span class="ansi-green-fg">      5</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">      7</span> <span style="font-style:italic;color:rgb(95,135,135)"># Extract the start date and time from the data tree's metadata</span>
<span class="ansi-green-fg">      8</span> date_zarr_lst = lst_zarr.attrs[<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">stac_discovery</span><span class="ansi-yellow-fg">'</span>][<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">properties</span><span class="ansi-yellow-fg">'</span>][<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">start_datetime</span><span class="ansi-yellow-fg">'</span>][:<span class="ansi-green-fg">10</span>]

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/xarray/backends/api.py:1076</span>, in <span class="ansi-cyan-fg">open_datatree</span><span class="ansi-blue-fg">(filename_or_obj, engine, chunks, cache, decode_cf, mask_and_scale, decode_times, decode_timedelta, use_cftime, concat_characters, decode_coords, drop_variables, create_default_indexes, inline_array, chunked_array_type, from_array_kwargs, backend_kwargs, **kwargs)</span>
<span class="ansi-green-fg">   1064</span> decoders = _resolve_decoders_kwargs(
<span class="ansi-green-fg">   1065</span>     decode_cf,
<span class="ansi-green-fg">   1066</span>     open_backend_dataset_parameters=backend.open_dataset_parameters,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">   1072</span>     decode_coords=decode_coords,
<span class="ansi-green-fg">   1073</span> )
<span class="ansi-green-fg">   1074</span> overwrite_encoded_chunks = kwargs.pop(<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">overwrite_encoded_chunks</span><span class="ansi-yellow-fg">"</span>, <span style="font-weight:bold;color:rgb(0,135,0)">None</span>)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1076</span> backend_tree = <span class="ansi-yellow-bg">backend</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_datatree</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">   1077</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">filename_or_obj</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1078</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">drop_variables</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">drop_variables</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1079</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">decoders</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1080</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1081</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1083</span> tree = _datatree_from_backend_datatree(
<span class="ansi-green-fg">   1084</span>     backend_tree,
<span class="ansi-green-fg">   1085</span>     filename_or_obj,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">   1096</span>     **kwargs,
<span class="ansi-green-fg">   1097</span> )
<span class="ansi-green-fg">   1099</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> tree

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/xarray/backends/zarr.py:1710</span>, in <span class="ansi-cyan-fg">ZarrBackendEntrypoint.open_datatree</span><span class="ansi-blue-fg">(self, filename_or_obj, mask_and_scale, decode_times, concat_characters, decode_coords, drop_variables, use_cftime, decode_timedelta, group, mode, synchronizer, consolidated, chunk_store, storage_options, zarr_version, zarr_format)</span>
<span class="ansi-green-fg">   1689</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">open_datatree</span>(
<span class="ansi-green-fg">   1690</span>     <span style="color:rgb(0,135,0)">self</span>,
<span class="ansi-green-fg">   1691</span>     filename_or_obj: T_PathFileOrDataStore,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">   1707</span>     zarr_format=<span style="font-weight:bold;color:rgb(0,135,0)">None</span>,
<span class="ansi-green-fg">   1708</span> ) -&gt; DataTree:
<span class="ansi-green-fg">   1709</span>     filename_or_obj = _normalize_path(filename_or_obj)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1710</span>     groups_dict = <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_groups_as_dict</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">   1711</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">filename_or_obj</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">filename_or_obj</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1712</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">mask_and_scale</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mask_and_scale</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1713</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">decode_times</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">decode_times</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1714</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">concat_characters</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">concat_characters</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1715</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">decode_coords</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">decode_coords</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1716</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">drop_variables</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">drop_variables</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1717</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">use_cftime</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">use_cftime</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1718</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">decode_timedelta</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">decode_timedelta</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1719</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">group</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">group</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1720</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1721</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1722</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">consolidated</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">consolidated</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1723</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1724</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1725</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1726</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1727</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1729</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> datatree_from_dict_with_io_cleanup(groups_dict)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/xarray/backends/zarr.py:1759</span>, in <span class="ansi-cyan-fg">ZarrBackendEntrypoint.open_groups_as_dict</span><span class="ansi-blue-fg">(self, filename_or_obj, mask_and_scale, decode_times, concat_characters, decode_coords, drop_variables, use_cftime, decode_timedelta, group, mode, synchronizer, consolidated, chunk_store, storage_options, zarr_version, zarr_format)</span>
<span class="ansi-green-fg">   1756</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">   1757</span>     parent = <span style="color:rgb(0,135,0)">str</span>(NodePath(<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">/</span><span class="ansi-yellow-fg">"</span>))
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1759</span> stores = <span class="ansi-yellow-bg">ZarrStore</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_store</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">   1760</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">filename_or_obj</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1761</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">group</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">parent</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1762</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1763</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1764</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">consolidated</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">consolidated</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1765</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">consolidate_on_close</span><span class="ansi-yellow-bg">=</span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">False</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1766</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1767</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1768</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1769</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1770</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1772</span> groups_dict = {}
<span class="ansi-green-fg">   1773</span> <span style="font-weight:bold;color:rgb(0,135,0)">for</span> path_group, store <span style="font-weight:bold;color:rgb(175,0,255)">in</span> stores.items():

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/xarray/backends/zarr.py:645</span>, in <span class="ansi-cyan-fg">ZarrStore.open_store</span><span class="ansi-blue-fg">(cls, store, mode, synchronizer, group, consolidated, consolidate_on_close, chunk_store, storage_options, append_dim, write_region, safe_chunks, align_chunks, zarr_version, zarr_format, use_zarr_fill_value_as_mask, write_empty, cache_members)</span>
<span class="ansi-green-fg">    619</span> <span style="color:rgb(175,0,255)">@classmethod</span>
<span class="ansi-green-fg">    620</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">open_store</span>(
<span class="ansi-green-fg">    621</span>     <span style="color:rgb(0,135,0)">cls</span>,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    638</span>     cache_members: <span style="color:rgb(0,135,0)">bool</span> = <span style="font-weight:bold;color:rgb(0,135,0)">True</span>,
<span class="ansi-green-fg">    639</span> ):
<span class="ansi-green-fg">    640</span>     (
<span class="ansi-green-fg">    641</span>         zarr_group,
<span class="ansi-green-fg">    642</span>         consolidate_on_close,
<span class="ansi-green-fg">    643</span>         close_store_on_close,
<span class="ansi-green-fg">    644</span>         use_zarr_fill_value_as_mask,
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">645</span>     ) = <span class="ansi-yellow-bg">_get_open_params</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    646</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    647</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    648</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    649</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">group</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">group</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    650</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">consolidated</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">consolidated</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    651</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">consolidate_on_close</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">consolidate_on_close</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    652</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    653</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    654</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    655</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">use_zarr_fill_value_as_mask</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">use_zarr_fill_value_as_mask</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    656</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    657</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    659</span>     <span style="font-weight:bold;color:rgb(0,135,0)">from</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg ansi-bold">zarr</span><span style="color:rgb(188,188,188)"> </span><span style="font-weight:bold;color:rgb(0,135,0)">import</span> Group
<span class="ansi-green-fg">    661</span>     group_members: <span style="color:rgb(0,135,0)">dict</span>[<span style="color:rgb(0,135,0)">str</span>, Group] = {}

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/xarray/backends/zarr.py:1872</span>, in <span class="ansi-cyan-fg">_get_open_params</span><span class="ansi-blue-fg">(store, mode, synchronizer, group, consolidated, consolidate_on_close, chunk_store, storage_options, zarr_version, use_zarr_fill_value_as_mask, zarr_format)</span>
<span class="ansi-green-fg">   1869</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> (<span style="font-weight:bold;color:rgb(215,95,95)">ValueError</span>, <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>):
<span class="ansi-green-fg">   1870</span>     <span style="font-style:italic;color:rgb(95,135,135)"># ValueError in zarr-python 3.x, KeyError in 2.x.</span>
<span class="ansi-green-fg">   1871</span>     <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1872</span>         zarr_root_group = <span class="ansi-yellow-bg">zarr</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_group</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">open_kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1873</span>         emit_user_level_warning(
<span class="ansi-green-fg">   1874</span>             <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">Failed to open Zarr store with consolidated metadata, </span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">   1875</span>             <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">but successfully read with non-consolidated metadata. </span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">   1885</span>             <span style="font-weight:bold;color:rgb(215,95,95)">RuntimeWarning</span>,
<span class="ansi-green-fg">   1886</span>         )
<span class="ansi-green-fg">   1887</span>     <span style="font-weight:bold;color:rgb(0,135,0)">except</span> missing_exc <span style="font-weight:bold;color:rgb(0,135,0)">as</span> err:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/api/synchronous.py:549</span>, in <span class="ansi-cyan-fg">open_group</span><span class="ansi-blue-fg">(store, mode, cache_attrs, synchronizer, path, chunk_store, storage_options, zarr_version, zarr_format, meta_array, attributes, use_consolidated)</span>
<span class="ansi-green-fg">    478</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">open_group</span>(
<span class="ansi-green-fg">    479</span>     store: StoreLike | <span style="font-weight:bold;color:rgb(0,135,0)">None</span> = <span style="font-weight:bold;color:rgb(0,135,0)">None</span>,
<span class="ansi-green-fg">    480</span>     *,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    491</span>     use_consolidated: <span style="color:rgb(0,135,0)">bool</span> | <span style="color:rgb(0,135,0)">str</span> | <span style="font-weight:bold;color:rgb(0,135,0)">None</span> = <span style="font-weight:bold;color:rgb(0,135,0)">None</span>,
<span class="ansi-green-fg">    492</span> ) -&gt; Group:
<span class="ansi-green-fg">    493</span> <span style="color:rgb(188,188,188)">    </span><span style="font-style:italic" class="ansi-yellow-fg">"""Open a group using file-mode-like semantics.</span>
<span class="ansi-green-fg">    494</span> 
<span class="ansi-green-fg">    495</span> <span style="font-style:italic" class="ansi-yellow-fg">    Parameters</span>
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    546</span> <span style="font-style:italic" class="ansi-yellow-fg">        The new group.</span>
<span class="ansi-green-fg">    547</span> <span style="font-style:italic" class="ansi-yellow-fg">    """</span>
<span class="ansi-green-fg">    548</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> Group(
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">549</span>         <span class="ansi-yellow-bg">sync</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    550</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">async_api</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_group</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    551</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    552</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    553</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">cache_attrs</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">cache_attrs</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    554</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    555</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">path</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">path</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    556</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    557</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    558</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    559</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    560</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">meta_array</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">meta_array</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    561</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">attributes</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">attributes</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    562</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">use_consolidated</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">use_consolidated</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    563</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    564</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    565</span>     )

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/core/sync.py:159</span>, in <span class="ansi-cyan-fg">sync</span><span class="ansi-blue-fg">(coro, loop, timeout)</span>
<span class="ansi-green-fg">    156</span> return_result = <span style="color:rgb(0,135,0)">next</span>(<span style="color:rgb(0,135,0)">iter</span>(finished)).result()
<span class="ansi-green-fg">    158</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(return_result, <span style="font-weight:bold;color:rgb(215,95,95)">BaseException</span>):
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">159</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> return_result
<span class="ansi-green-fg">    160</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    161</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> return_result

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/core/sync.py:119</span>, in <span class="ansi-cyan-fg">_runner</span><span class="ansi-blue-fg">(coro)</span>
<span class="ansi-green-fg">    114</span> <span style="font-style:italic" class="ansi-yellow-fg">"""</span>
<span class="ansi-green-fg">    115</span> <span style="font-style:italic" class="ansi-yellow-fg">Await a coroutine and return the result of running it. If awaiting the coroutine raises an</span>
<span class="ansi-green-fg">    116</span> <span style="font-style:italic" class="ansi-yellow-fg">exception, the exception will be returned.</span>
<span class="ansi-green-fg">    117</span> <span style="font-style:italic" class="ansi-yellow-fg">"""</span>
<span class="ansi-green-fg">    118</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">119</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="font-weight:bold;color:rgb(0,135,0)">await</span> coro
<span class="ansi-green-fg">    120</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">Exception</span> <span style="font-weight:bold;color:rgb(0,135,0)">as</span> ex:
<span class="ansi-green-fg">    121</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> ex

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/api/asynchronous.py:881</span>, in <span class="ansi-cyan-fg">open_group</span><span class="ansi-blue-fg">(store, mode, cache_attrs, synchronizer, path, chunk_store, storage_options, zarr_version, zarr_format, meta_array, attributes, use_consolidated)</span>
<span class="ansi-green-fg">    874</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="font-weight:bold;color:rgb(0,135,0)">await</span> AsyncGroup.from_store(
<span class="ansi-green-fg">    875</span>         store_path,
<span class="ansi-green-fg">    876</span>         zarr_format=_zarr_format,
<span class="ansi-green-fg">    877</span>         overwrite=overwrite,
<span class="ansi-green-fg">    878</span>         attributes=attributes,
<span class="ansi-green-fg">    879</span>     )
<span class="ansi-green-fg">    880</span> msg = <span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">No group found in store </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>store<span style="font-weight:bold;color:rgb(175,95,135)">!r}</span><span class="ansi-yellow-fg"> at path </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>store_path.path<span style="font-weight:bold;color:rgb(175,95,135)">!r}</span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">881</span> <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> GroupNotFoundError(msg)

<span class="ansi-red-fg">GroupNotFoundError</span>: No group found in store 'https://objects.eodc.eu:443/e05ab01a9d56408d82ac32d69a5aae2a:202506-s03slslst/10/products/cpm_v256/S3B_SL_2_LST____20250610T091849_20250610T092149_20250611T160034_0179_107_264_2340_ESA_O_NT_004.zarr' at path ''</pre>
</div>
</div>
</div>
<p>To effectively overlay the data, we first need to process the Land Surface Temperature (LST) asset to cover the same area of interest. We can accomplish this by applying our pre-defined masking functions. Since the LST data is presented in <strong>EPSG:4326</strong>, we will use the <code>zarr_mask_latlon()</code> function to generate the boolean mask of interest over the data, followed by the <code>mask_sub_latlon()</code> function, which clips it to our area of interest.</p>
<div id="29" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The zarr_mask_latlon function is used to create a mask based on a bounding box and the measurements data</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>cols_lst , rows_lst <span class="op">=</span> zarr_mask_latlon(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    bbox_vis, <span class="co"># The input bounding box</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    meas_lst <span class="co"># The measurements group from the zarr data tree</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The mask_sub_latlon function then clips the land surface temperature data</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>lst_clip <span class="op">=</span> mask_sub_latlon(</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    meas_lst.lst, <span class="co"># The land surface temperature band from the measurements group</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    rows_lst, <span class="co"># The row indices for the mask</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    cols_lst <span class="co"># The column indices for the mask</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    ).values</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># The latitude data is clipped using the same mask indices</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>lat_lst <span class="op">=</span> mask_sub_latlon(meas_lst[<span class="st">'latitude'</span>],rows_lst, cols_lst).values</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># The longitude data is clipped using the same mask indices</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>lon_lst <span class="op">=</span> mask_sub_latlon(meas_lst[<span class="st">'longitude'</span>],rows_lst, cols_lst).values</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[8]</span><span class="ansi-green-fg">, line 4</span>
<span class="ansi-green-fg">      1</span> <span style="font-style:italic;color:rgb(95,135,135)"># The zarr_mask_latlon function is used to create a mask based on a bounding box and the measurements data</span>
<span class="ansi-green-fg">      2</span> cols_lst , rows_lst = zarr_mask_latlon(
<span class="ansi-green-fg">      3</span>     bbox_vis, <span style="font-style:italic;color:rgb(95,135,135)"># The input bounding box</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">4</span>     <span class="ansi-yellow-bg">meas_lst</span> <span style="font-style:italic;color:rgb(95,135,135)"># The measurements group from the zarr data tree</span>
<span class="ansi-green-fg">      5</span>     )
<span class="ansi-green-fg">      6</span> <span style="font-style:italic;color:rgb(95,135,135)"># The mask_sub_latlon function then clips the land surface temperature data</span>
<span class="ansi-green-fg">      7</span> lst_clip = mask_sub_latlon(
<span class="ansi-green-fg">      8</span>     meas_lst.lst, <span style="font-style:italic;color:rgb(95,135,135)"># The land surface temperature band from the measurements group</span>
<span class="ansi-green-fg">      9</span>     rows_lst, <span style="font-style:italic;color:rgb(95,135,135)"># The row indices for the mask</span>
<span class="ansi-green-fg">     10</span>     cols_lst <span style="font-style:italic;color:rgb(95,135,135)"># The column indices for the mask</span>
<span class="ansi-green-fg">     11</span>     ).values

<span class="ansi-red-fg">NameError</span>: name 'meas_lst' is not defined</pre>
</div>
</div>
</div>
<p>After clipping the data to our defined area of interest, we apply the <strong>temperature threshold</strong> to the data, filtering for only those pixels with <strong>temperatures above 312 Kelvin</strong>. This temperature range is a strong indicator of heat anomalies, which are often associated with active or developing fires.</p>
<div id="31" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To clip the data and prepare the array for an overlay with the TCI:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>lstf_clip <span class="op">=</span> np.where(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    lst_clip <span class="op">&lt;=</span> <span class="dv">312</span>, <span class="co"># values less than or equal to 312 K</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    np.nan, <span class="co"># The value to assign if the condition is true</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    lst_clip <span class="co"># The value to assign if the condition is false</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[9]</span><span class="ansi-green-fg">, line 3</span>
<span class="ansi-green-fg">      1</span> <span style="font-style:italic;color:rgb(95,135,135)"># To clip the data and prepare the array for an overlay with the TCI:</span>
<span class="ansi-green-fg">      2</span> lstf_clip = np.where(
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">3</span>     <span class="ansi-yellow-bg">lst_clip</span> &lt;= <span class="ansi-green-fg">312</span>, <span style="font-style:italic;color:rgb(95,135,135)"># values less than or equal to 312 K</span>
<span class="ansi-green-fg">      4</span>     np.nan, <span style="font-style:italic;color:rgb(95,135,135)"># The value to assign if the condition is true</span>
<span class="ansi-green-fg">      5</span>     lst_clip <span style="font-style:italic;color:rgb(95,135,135)"># The value to assign if the condition is false</span>
<span class="ansi-green-fg">      6</span>     )

<span class="ansi-red-fg">NameError</span>: name 'lst_clip' is not defined</pre>
</div>
</div>
</div>
<p>Creating a custom colour map that uses shades of red, with the most <strong>vibrant red</strong> indicating the <strong>hottest</strong> areas will enhance our visualisation. This colour map is applied to the LST data, allowing us to clearly and intuitively see the heat signatures that correspond with potential fire activity when the two layers are overlayed.</p>
<div id="33" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For colour ramp:</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>col_map <span class="op">=</span> ListedColormap([[<span class="fl">1.</span>, <span class="fl">140.</span><span class="op">/</span><span class="fl">255.</span>, <span class="dv">0</span>],[<span class="fl">178.</span><span class="op">/</span><span class="fl">255.</span>, <span class="fl">34.</span><span class="op">/</span><span class="fl">255.</span>, <span class="fl">34.</span><span class="op">/</span><span class="fl">255.</span>],[<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>]]) <span class="co"># red composite shades</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the boundaries for each colour in the ramp</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>bounds <span class="op">=</span> [<span class="dv">300</span>, <span class="dv">305</span>, <span class="dv">310</span>, <span class="dv">315</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the number of colours, which is one less than the number of bounds</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>ncolors <span class="op">=</span> <span class="bu">len</span>(bounds) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a normalisation object to map data values to colours based on the defined bounds</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> BoundaryNorm(bounds, col_map.N)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the box() function to create a polygon from the coordinates</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>map_box <span class="op">=</span> box(map_box[<span class="dv">0</span>],map_box[<span class="dv">1</span>],map_box[<span class="dv">2</span>],map_box[<span class="dv">3</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The final step of the Sentinel-3 SLSTR data processing is to <strong>visualise</strong> the temperature anomalies. We will prepare the filtered LST data to be overlaid over the True-Color composite of Sentinel-2 L2 data.</p>
<div id="35" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure to plot</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].imshow(lst_clip)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="st">'Clipped LST'</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the filtered land surface temperature data on the second subplot</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].imshow(lstf_clip)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_title(<span class="st">'Filtered LST'</span>) <span class="co"># Add a title for clarity</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the layout</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[11]</span><span class="ansi-green-fg">, line 3</span>
<span class="ansi-green-fg">      1</span> <span style="font-style:italic;color:rgb(95,135,135)"># Create a figure to plot</span>
<span class="ansi-green-fg">      2</span> fig, axs = plt.subplots(<span class="ansi-green-fg">1</span>, <span class="ansi-green-fg">2</span>)
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">3</span> axs[<span class="ansi-green-fg">0</span>].imshow(<span class="ansi-yellow-bg">lst_clip</span>)
<span class="ansi-green-fg">      4</span> axs[<span class="ansi-green-fg">0</span>].set_title(<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">Clipped LST</span><span class="ansi-yellow-fg">'</span>)
<span class="ansi-green-fg">      5</span> <span style="font-style:italic;color:rgb(95,135,135)"># Plot the filtered land surface temperature data on the second subplot</span>

<span class="ansi-red-fg">NameError</span>: name 'lst_clip' is not defined</pre>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="62_sardinia_s3_lst_files/figure-html/cell-12-output-2.png" width="581" height="416" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="create-sentinel-2-l2a-true-color-composite" class="level3">
<h3 class="anchored" data-anchor-id="create-sentinel-2-l2a-true-color-composite">Create Sentinel-2 L2A True-Color composite</h3>
<p>Following the parameters we defined before and the workflow described in the <a href="../06_eopf_zarr_in_action/61_sardinia_s2_tfci.html">first part</a> of this notebook series, we will filter the <strong>Sentinel-2 L2A</strong> data collection to match our event and AOI. This ensures that the visualisations we create are directly relevant to the fire event and set the stage for comparing it with the Land Surface Temperature data from Sentinel-3.</p>
<div id="38" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interest timeframe parameters for the filtering</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>date_p <span class="op">=</span> fire_d_s3 <span class="op">+</span> <span class="st">'T00:00:00Z/'</span> <span class="op">+</span> fire_d_s3 <span class="op">+</span> <span class="st">'T23:59:59.999999Z'</span> <span class="co"># interest period</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>def_collection <span class="op">=</span> <span class="st">'sentinel-2-l2a'</span> <span class="co"># collection</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>s2_col <span class="op">=</span> <span class="bu">list</span>(eopf_catalog.search(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                bbox<span class="op">=</span> search_bbox, <span class="co"># area</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                datetime<span class="op">=</span> date_p, <span class="co">#time frame</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                collections<span class="op">=</span>def_collection <span class="co"># collection</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                ).item_collection())</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>av_urls <span class="op">=</span> [item.assets[<span class="st">"product"</span>].href <span class="cf">for</span> item <span class="kw">in</span> s2_col]</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(av_urls)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[]</code></pre>
</div>
</div>
<p>As we can see, there is no capture available for the day on which the fire occurred. This is because <strong>Sentinel-2 L2A</strong> has a <strong>revisit time</strong> of <strong>five</strong> days at the equator, making it possible that, even when the constellation is synchronously retrieving data, the day in question may not be available.<br> In this case, we define the capture date as the one closest to the event, the <strong>11th June 2025</strong>.</p>
<div id="40" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interest timeframe parameters for the filtering</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>date_p <span class="op">=</span> fire_d <span class="op">+</span> <span class="st">'T00:00:00Z/'</span> <span class="op">+</span> fire_d <span class="op">+</span> <span class="st">'T23:59:59.999999Z'</span> <span class="co"># interest period</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>def_collection <span class="op">=</span> <span class="st">'sentinel-2-l2a'</span> <span class="co"># collection</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>s2_col <span class="op">=</span> <span class="bu">list</span>(eopf_catalog.search(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                bbox<span class="op">=</span> search_bbox, <span class="co"># area</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                datetime<span class="op">=</span> date_p, <span class="co">#time frame</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                collections<span class="op">=</span>def_collection <span class="co"># collection</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                ).item_collection())</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>av_urls <span class="op">=</span> [item.assets[<span class="st">"product"</span>].href <span class="cf">for</span> item <span class="kw">in</span> s2_col] </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>av_urls</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>['https://objects.eodc.eu:443/e05ab01a9d56408d82ac32d69a5aae2a:202506-s02msil2a/11/products/cpm_v256/S2C_MSIL2A_20250611T101041_N0511_R022_T32TMK_20250611T175918.zarr']</code></pre>
</div>
</div>
<p>Once we have obtained the available items from the <strong>Sentinel-2 L2A</strong> collection, we can open the asset as a xarray.DataTree.</p>
<p>To prepare the data for further processing, we will extract key metadata like the collection, date, time, and the spectral bands needed for the visualisation (which are conveniently grouped under <code>r20m</code> group).</p>
<p>These True-Color composite processing steps include: - Masking of invalid pixels - Clipping to AOI - Band selection - Normalisation - Composite creation - Equalisation</p>
<section id="masking-out-invalid-pixels" class="level4">
<h4 class="anchored" data-anchor-id="masking-out-invalid-pixels">Masking out invalid pixels</h4>
<div id="43" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We are interested in the datasets contained in the measurements bands for True Colour and False Colour Composites.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>s2_zarr <span class="op">=</span> xr.open_datatree(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    av_urls[<span class="dv">0</span>], engine<span class="op">=</span><span class="st">"zarr"</span>, <span class="co">#we always get the earliest one (the first available item goes last)</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    chunks<span class="op">=</span>{},</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    decode_timedelta<span class="op">=</span><span class="va">False</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Store interest parameters for further plotting:</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>date <span class="op">=</span> s2_zarr.attrs[<span class="st">'stac_discovery'</span>][<span class="st">'properties'</span>][<span class="st">'start_datetime'</span>][:<span class="dv">10</span>]</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>time_zarr <span class="op">=</span> s2_zarr.attrs[<span class="st">'stac_discovery'</span>][<span class="st">'properties'</span>][<span class="st">'start_datetime'</span>][<span class="dv">11</span>:<span class="dv">19</span>]</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>target_crs <span class="op">=</span> s2_zarr.attrs[<span class="st">"stac_discovery"</span>][<span class="st">"properties"</span>][<span class="st">"proj:epsg"</span>]</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the resolution group we are interested to analyse over:</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>zarr_meas <span class="op">=</span> s2_zarr.measurements.reflectance.r20m</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the cloud free mask at 20m resolution:</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>l2a_class_20m <span class="op">=</span> s2_zarr.conditions.mask.l2a_classification.r20m.scl</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>valid_mask <span class="op">=</span> validate_scl(l2a_class_20m)  <span class="co"># Boolean mask (10980x10980)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">GroupNotFoundError</span>                        Traceback (most recent call last)
<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/xarray/backends/zarr.py:1868</span>, in <span class="ansi-cyan-fg">_get_open_params</span><span class="ansi-blue-fg">(store, mode, synchronizer, group, consolidated, consolidate_on_close, chunk_store, storage_options, zarr_version, use_zarr_fill_value_as_mask, zarr_format)</span>
<span class="ansi-green-fg">   1867</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1868</span>     zarr_root_group = <span class="ansi-yellow-bg">zarr</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_consolidated</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">open_kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1869</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> (<span style="font-weight:bold;color:rgb(215,95,95)">ValueError</span>, <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>):
<span class="ansi-green-fg">   1870</span>     <span style="font-style:italic;color:rgb(95,135,135)"># ValueError in zarr-python 3.x, KeyError in 2.x.</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/api/synchronous.py:238</span>, in <span class="ansi-cyan-fg">open_consolidated</span><span class="ansi-blue-fg">(use_consolidated, *args, **kwargs)</span>
<span class="ansi-green-fg">    234</span> <span style="font-style:italic" class="ansi-yellow-fg">"""</span>
<span class="ansi-green-fg">    235</span> <span style="font-style:italic" class="ansi-yellow-fg">Alias for [`open_group`][zarr.api.synchronous.open_group] with ``use_consolidated=True``.</span>
<span class="ansi-green-fg">    236</span> <span style="font-style:italic" class="ansi-yellow-fg">"""</span>
<span class="ansi-green-fg">    237</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> Group(
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">238</span>     <span class="ansi-yellow-bg">sync</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">async_api</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_consolidated</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">use_consolidated</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">use_consolidated</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    239</span> )

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/core/sync.py:159</span>, in <span class="ansi-cyan-fg">sync</span><span class="ansi-blue-fg">(coro, loop, timeout)</span>
<span class="ansi-green-fg">    158</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(return_result, <span style="font-weight:bold;color:rgb(215,95,95)">BaseException</span>):
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">159</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> return_result
<span class="ansi-green-fg">    160</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/core/sync.py:119</span>, in <span class="ansi-cyan-fg">_runner</span><span class="ansi-blue-fg">(coro)</span>
<span class="ansi-green-fg">    118</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">119</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="font-weight:bold;color:rgb(0,135,0)">await</span> coro
<span class="ansi-green-fg">    120</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">Exception</span> <span style="font-weight:bold;color:rgb(0,135,0)">as</span> ex:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/api/asynchronous.py:415</span>, in <span class="ansi-cyan-fg">open_consolidated</span><span class="ansi-blue-fg">(use_consolidated, *args, **kwargs)</span>
<span class="ansi-green-fg">    411</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>(
<span class="ansi-green-fg">    412</span>         <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">use_consolidated</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg"> must be </span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">True</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg"> in </span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">open_consolidated</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">. Use </span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">open</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg"> with </span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">    413</span>         <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">use_consolidated=False</span><span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg"> to bypass consolidated metadata.</span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">    414</span>     )
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">415</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="font-weight:bold;color:rgb(0,135,0)">await</span> open_group(*args, use_consolidated=use_consolidated, **kwargs)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/api/asynchronous.py:881</span>, in <span class="ansi-cyan-fg">open_group</span><span class="ansi-blue-fg">(store, mode, cache_attrs, synchronizer, path, chunk_store, storage_options, zarr_version, zarr_format, meta_array, attributes, use_consolidated)</span>
<span class="ansi-green-fg">    880</span> msg = <span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">No group found in store </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>store<span style="font-weight:bold;color:rgb(175,95,135)">!r}</span><span class="ansi-yellow-fg"> at path </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>store_path.path<span style="font-weight:bold;color:rgb(175,95,135)">!r}</span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">881</span> <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> GroupNotFoundError(msg)

<span class="ansi-red-fg">GroupNotFoundError</span>: No group found in store 'https://objects.eodc.eu:443/e05ab01a9d56408d82ac32d69a5aae2a:202506-s02msil2a/11/products/cpm_v256/S2C_MSIL2A_20250611T101041_N0511_R022_T32TMK_20250611T175918.zarr' at path ''

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">GroupNotFoundError</span>                        Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[14]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> <span style="font-style:italic;color:rgb(95,135,135)"># We are interested in the datasets contained in the measurements bands for True Colour and False Colour Composites.</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> s2_zarr = <span class="ansi-yellow-bg">xr</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_datatree</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">      3</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">av_urls</span><span class="ansi-yellow-bg">[</span><span class="ansi-green-fg ansi-yellow-bg">0</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">engine</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-fg ansi-yellow-bg">"</span><span class="ansi-yellow-fg ansi-yellow-bg">zarr</span><span class="ansi-yellow-fg ansi-yellow-bg">"</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="font-style:italic;color:rgb(95,135,135)" class="ansi-yellow-bg">#we always get the earliest one (the first available item goes last)</span>
<span class="ansi-green-fg">      4</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">chunks</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">{</span><span class="ansi-yellow-bg">}</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">      5</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">decode_timedelta</span><span class="ansi-yellow-bg">=</span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">False</span>
<span class="ansi-green-fg">      6</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">      8</span> <span style="font-style:italic;color:rgb(95,135,135)"># Store interest parameters for further plotting:</span>
<span class="ansi-green-fg">      9</span> date = s2_zarr.attrs[<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">stac_discovery</span><span class="ansi-yellow-fg">'</span>][<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">properties</span><span class="ansi-yellow-fg">'</span>][<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">start_datetime</span><span class="ansi-yellow-fg">'</span>][:<span class="ansi-green-fg">10</span>]

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/xarray/backends/api.py:1076</span>, in <span class="ansi-cyan-fg">open_datatree</span><span class="ansi-blue-fg">(filename_or_obj, engine, chunks, cache, decode_cf, mask_and_scale, decode_times, decode_timedelta, use_cftime, concat_characters, decode_coords, drop_variables, create_default_indexes, inline_array, chunked_array_type, from_array_kwargs, backend_kwargs, **kwargs)</span>
<span class="ansi-green-fg">   1064</span> decoders = _resolve_decoders_kwargs(
<span class="ansi-green-fg">   1065</span>     decode_cf,
<span class="ansi-green-fg">   1066</span>     open_backend_dataset_parameters=backend.open_dataset_parameters,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">   1072</span>     decode_coords=decode_coords,
<span class="ansi-green-fg">   1073</span> )
<span class="ansi-green-fg">   1074</span> overwrite_encoded_chunks = kwargs.pop(<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">overwrite_encoded_chunks</span><span class="ansi-yellow-fg">"</span>, <span style="font-weight:bold;color:rgb(0,135,0)">None</span>)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1076</span> backend_tree = <span class="ansi-yellow-bg">backend</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_datatree</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">   1077</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">filename_or_obj</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1078</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">drop_variables</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">drop_variables</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1079</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">decoders</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1080</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1081</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1083</span> tree = _datatree_from_backend_datatree(
<span class="ansi-green-fg">   1084</span>     backend_tree,
<span class="ansi-green-fg">   1085</span>     filename_or_obj,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">   1096</span>     **kwargs,
<span class="ansi-green-fg">   1097</span> )
<span class="ansi-green-fg">   1099</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> tree

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/xarray/backends/zarr.py:1710</span>, in <span class="ansi-cyan-fg">ZarrBackendEntrypoint.open_datatree</span><span class="ansi-blue-fg">(self, filename_or_obj, mask_and_scale, decode_times, concat_characters, decode_coords, drop_variables, use_cftime, decode_timedelta, group, mode, synchronizer, consolidated, chunk_store, storage_options, zarr_version, zarr_format)</span>
<span class="ansi-green-fg">   1689</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">open_datatree</span>(
<span class="ansi-green-fg">   1690</span>     <span style="color:rgb(0,135,0)">self</span>,
<span class="ansi-green-fg">   1691</span>     filename_or_obj: T_PathFileOrDataStore,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">   1707</span>     zarr_format=<span style="font-weight:bold;color:rgb(0,135,0)">None</span>,
<span class="ansi-green-fg">   1708</span> ) -&gt; DataTree:
<span class="ansi-green-fg">   1709</span>     filename_or_obj = _normalize_path(filename_or_obj)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1710</span>     groups_dict = <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_groups_as_dict</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">   1711</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">filename_or_obj</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">filename_or_obj</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1712</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">mask_and_scale</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mask_and_scale</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1713</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">decode_times</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">decode_times</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1714</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">concat_characters</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">concat_characters</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1715</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">decode_coords</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">decode_coords</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1716</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">drop_variables</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">drop_variables</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1717</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">use_cftime</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">use_cftime</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1718</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">decode_timedelta</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">decode_timedelta</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1719</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">group</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">group</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1720</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1721</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1722</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">consolidated</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">consolidated</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1723</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1724</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1725</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1726</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1727</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1729</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> datatree_from_dict_with_io_cleanup(groups_dict)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/xarray/backends/zarr.py:1759</span>, in <span class="ansi-cyan-fg">ZarrBackendEntrypoint.open_groups_as_dict</span><span class="ansi-blue-fg">(self, filename_or_obj, mask_and_scale, decode_times, concat_characters, decode_coords, drop_variables, use_cftime, decode_timedelta, group, mode, synchronizer, consolidated, chunk_store, storage_options, zarr_version, zarr_format)</span>
<span class="ansi-green-fg">   1756</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">   1757</span>     parent = <span style="color:rgb(0,135,0)">str</span>(NodePath(<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">/</span><span class="ansi-yellow-fg">"</span>))
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1759</span> stores = <span class="ansi-yellow-bg">ZarrStore</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_store</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">   1760</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">filename_or_obj</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1761</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">group</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">parent</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1762</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1763</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1764</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">consolidated</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">consolidated</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1765</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">consolidate_on_close</span><span class="ansi-yellow-bg">=</span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">False</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1766</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1767</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1768</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1769</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   1770</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1772</span> groups_dict = {}
<span class="ansi-green-fg">   1773</span> <span style="font-weight:bold;color:rgb(0,135,0)">for</span> path_group, store <span style="font-weight:bold;color:rgb(175,0,255)">in</span> stores.items():

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/xarray/backends/zarr.py:645</span>, in <span class="ansi-cyan-fg">ZarrStore.open_store</span><span class="ansi-blue-fg">(cls, store, mode, synchronizer, group, consolidated, consolidate_on_close, chunk_store, storage_options, append_dim, write_region, safe_chunks, align_chunks, zarr_version, zarr_format, use_zarr_fill_value_as_mask, write_empty, cache_members)</span>
<span class="ansi-green-fg">    619</span> <span style="color:rgb(175,0,255)">@classmethod</span>
<span class="ansi-green-fg">    620</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">open_store</span>(
<span class="ansi-green-fg">    621</span>     <span style="color:rgb(0,135,0)">cls</span>,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    638</span>     cache_members: <span style="color:rgb(0,135,0)">bool</span> = <span style="font-weight:bold;color:rgb(0,135,0)">True</span>,
<span class="ansi-green-fg">    639</span> ):
<span class="ansi-green-fg">    640</span>     (
<span class="ansi-green-fg">    641</span>         zarr_group,
<span class="ansi-green-fg">    642</span>         consolidate_on_close,
<span class="ansi-green-fg">    643</span>         close_store_on_close,
<span class="ansi-green-fg">    644</span>         use_zarr_fill_value_as_mask,
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">645</span>     ) = <span class="ansi-yellow-bg">_get_open_params</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    646</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    647</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    648</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    649</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">group</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">group</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    650</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">consolidated</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">consolidated</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    651</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">consolidate_on_close</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">consolidate_on_close</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    652</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    653</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    654</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    655</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">use_zarr_fill_value_as_mask</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">use_zarr_fill_value_as_mask</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    656</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    657</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    659</span>     <span style="font-weight:bold;color:rgb(0,135,0)">from</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg ansi-bold">zarr</span><span style="color:rgb(188,188,188)"> </span><span style="font-weight:bold;color:rgb(0,135,0)">import</span> Group
<span class="ansi-green-fg">    661</span>     group_members: <span style="color:rgb(0,135,0)">dict</span>[<span style="color:rgb(0,135,0)">str</span>, Group] = {}

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/xarray/backends/zarr.py:1872</span>, in <span class="ansi-cyan-fg">_get_open_params</span><span class="ansi-blue-fg">(store, mode, synchronizer, group, consolidated, consolidate_on_close, chunk_store, storage_options, zarr_version, use_zarr_fill_value_as_mask, zarr_format)</span>
<span class="ansi-green-fg">   1869</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> (<span style="font-weight:bold;color:rgb(215,95,95)">ValueError</span>, <span style="font-weight:bold;color:rgb(215,95,95)">KeyError</span>):
<span class="ansi-green-fg">   1870</span>     <span style="font-style:italic;color:rgb(95,135,135)"># ValueError in zarr-python 3.x, KeyError in 2.x.</span>
<span class="ansi-green-fg">   1871</span>     <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1872</span>         zarr_root_group = <span class="ansi-yellow-bg">zarr</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_group</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">open_kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1873</span>         emit_user_level_warning(
<span class="ansi-green-fg">   1874</span>             <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">Failed to open Zarr store with consolidated metadata, </span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">   1875</span>             <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">but successfully read with non-consolidated metadata. </span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">   1885</span>             <span style="font-weight:bold;color:rgb(215,95,95)">RuntimeWarning</span>,
<span class="ansi-green-fg">   1886</span>         )
<span class="ansi-green-fg">   1887</span>     <span style="font-weight:bold;color:rgb(0,135,0)">except</span> missing_exc <span style="font-weight:bold;color:rgb(0,135,0)">as</span> err:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/api/synchronous.py:549</span>, in <span class="ansi-cyan-fg">open_group</span><span class="ansi-blue-fg">(store, mode, cache_attrs, synchronizer, path, chunk_store, storage_options, zarr_version, zarr_format, meta_array, attributes, use_consolidated)</span>
<span class="ansi-green-fg">    478</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg">open_group</span>(
<span class="ansi-green-fg">    479</span>     store: StoreLike | <span style="font-weight:bold;color:rgb(0,135,0)">None</span> = <span style="font-weight:bold;color:rgb(0,135,0)">None</span>,
<span class="ansi-green-fg">    480</span>     *,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    491</span>     use_consolidated: <span style="color:rgb(0,135,0)">bool</span> | <span style="color:rgb(0,135,0)">str</span> | <span style="font-weight:bold;color:rgb(0,135,0)">None</span> = <span style="font-weight:bold;color:rgb(0,135,0)">None</span>,
<span class="ansi-green-fg">    492</span> ) -&gt; Group:
<span class="ansi-green-fg">    493</span> <span style="color:rgb(188,188,188)">    </span><span style="font-style:italic" class="ansi-yellow-fg">"""Open a group using file-mode-like semantics.</span>
<span class="ansi-green-fg">    494</span> 
<span class="ansi-green-fg">    495</span> <span style="font-style:italic" class="ansi-yellow-fg">    Parameters</span>
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    546</span> <span style="font-style:italic" class="ansi-yellow-fg">        The new group.</span>
<span class="ansi-green-fg">    547</span> <span style="font-style:italic" class="ansi-yellow-fg">    """</span>
<span class="ansi-green-fg">    548</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> Group(
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">549</span>         <span class="ansi-yellow-bg">sync</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    550</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">async_api</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_group</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    551</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">store</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    552</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    553</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">cache_attrs</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">cache_attrs</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    554</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">synchronizer</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    555</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">path</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">path</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    556</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">chunk_store</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    557</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">storage_options</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    558</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_version</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    559</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">zarr_format</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    560</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">meta_array</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">meta_array</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    561</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">attributes</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">attributes</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    562</span> <span class="ansi-yellow-bg">                </span><span class="ansi-yellow-bg">use_consolidated</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">use_consolidated</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    563</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    564</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    565</span>     )

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/core/sync.py:159</span>, in <span class="ansi-cyan-fg">sync</span><span class="ansi-blue-fg">(coro, loop, timeout)</span>
<span class="ansi-green-fg">    156</span> return_result = <span style="color:rgb(0,135,0)">next</span>(<span style="color:rgb(0,135,0)">iter</span>(finished)).result()
<span class="ansi-green-fg">    158</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(return_result, <span style="font-weight:bold;color:rgb(215,95,95)">BaseException</span>):
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">159</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> return_result
<span class="ansi-green-fg">    160</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    161</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> return_result

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/core/sync.py:119</span>, in <span class="ansi-cyan-fg">_runner</span><span class="ansi-blue-fg">(coro)</span>
<span class="ansi-green-fg">    114</span> <span style="font-style:italic" class="ansi-yellow-fg">"""</span>
<span class="ansi-green-fg">    115</span> <span style="font-style:italic" class="ansi-yellow-fg">Await a coroutine and return the result of running it. If awaiting the coroutine raises an</span>
<span class="ansi-green-fg">    116</span> <span style="font-style:italic" class="ansi-yellow-fg">exception, the exception will be returned.</span>
<span class="ansi-green-fg">    117</span> <span style="font-style:italic" class="ansi-yellow-fg">"""</span>
<span class="ansi-green-fg">    118</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">119</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="font-weight:bold;color:rgb(0,135,0)">await</span> coro
<span class="ansi-green-fg">    120</span> <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">Exception</span> <span style="font-weight:bold;color:rgb(0,135,0)">as</span> ex:
<span class="ansi-green-fg">    121</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> ex

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">/opt/conda/lib/python3.12/site-packages/zarr/api/asynchronous.py:881</span>, in <span class="ansi-cyan-fg">open_group</span><span class="ansi-blue-fg">(store, mode, cache_attrs, synchronizer, path, chunk_store, storage_options, zarr_version, zarr_format, meta_array, attributes, use_consolidated)</span>
<span class="ansi-green-fg">    874</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="font-weight:bold;color:rgb(0,135,0)">await</span> AsyncGroup.from_store(
<span class="ansi-green-fg">    875</span>         store_path,
<span class="ansi-green-fg">    876</span>         zarr_format=_zarr_format,
<span class="ansi-green-fg">    877</span>         overwrite=overwrite,
<span class="ansi-green-fg">    878</span>         attributes=attributes,
<span class="ansi-green-fg">    879</span>     )
<span class="ansi-green-fg">    880</span> msg = <span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">No group found in store </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>store<span style="font-weight:bold;color:rgb(175,95,135)">!r}</span><span class="ansi-yellow-fg"> at path </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>store_path.path<span style="font-weight:bold;color:rgb(175,95,135)">!r}</span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">881</span> <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> GroupNotFoundError(msg)

<span class="ansi-red-fg">GroupNotFoundError</span>: No group found in store 'https://objects.eodc.eu:443/e05ab01a9d56408d82ac32d69a5aae2a:202506-s02msil2a/11/products/cpm_v256/S2C_MSIL2A_20250611T101041_N0511_R022_T32TMK_20250611T175918.zarr' at path ''</pre>
</div>
</div>
</div>
</section>
<section id="clipping-to-aoi" class="level4">
<h4 class="anchored" data-anchor-id="clipping-to-aoi">Clipping to AOI</h4>
<p>In a next step, we clip the retrieved item to our defined area of interest (AOI).</p>
<div id="46" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># True colour channels we are interested to retrieve coposite:</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>tc_red  <span class="op">=</span> <span class="st">'b04'</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>tc_green<span class="op">=</span> <span class="st">'b03'</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>tc_blue <span class="op">=</span> <span class="st">'b02'</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Boolean mask for the 'x' dimension (longitude/easting)</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>x_mask <span class="op">=</span> (zarr_meas[<span class="st">'x'</span>] <span class="op">&gt;=</span> bbox_utm[<span class="dv">0</span>]) <span class="op">&amp;</span> (zarr_meas[<span class="st">'x'</span>] <span class="op">&lt;=</span> bbox_utm[<span class="dv">2</span>])</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Boolean mask for the 'y' dimension (latitude/northing)</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>y_mask <span class="op">=</span> (zarr_meas[<span class="st">'y'</span>] <span class="op">&gt;=</span> bbox_utm[<span class="dv">1</span>]) <span class="op">&amp;</span> (zarr_meas[<span class="st">'y'</span>] <span class="op">&lt;=</span> bbox_utm[<span class="dv">3</span>])</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Combined mask for the bounding box</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>bbox_mask <span class="op">=</span> x_mask <span class="op">&amp;</span> y_mask</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract row and column indices where the mask is True</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>cols, rows <span class="op">=</span> np.where(bbox_mask)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[15]</span><span class="ansi-green-fg">, line 7</span>
<span class="ansi-green-fg">      4</span> tc_blue = <span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">b02</span><span class="ansi-yellow-fg">'</span>
<span class="ansi-green-fg">      6</span> <span style="font-style:italic;color:rgb(95,135,135)"># Boolean mask for the 'x' dimension (longitude/easting)</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">7</span> x_mask = (<span class="ansi-yellow-bg">zarr_meas</span>[<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">x</span><span class="ansi-yellow-fg">'</span>] &gt;= bbox_utm[<span class="ansi-green-fg">0</span>]) &amp; (zarr_meas[<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">x</span><span class="ansi-yellow-fg">'</span>] &lt;= bbox_utm[<span class="ansi-green-fg">2</span>])
<span class="ansi-green-fg">      8</span> <span style="font-style:italic;color:rgb(95,135,135)"># Boolean mask for the 'y' dimension (latitude/northing)</span>
<span class="ansi-green-fg">      9</span> y_mask = (zarr_meas[<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">y</span><span class="ansi-yellow-fg">'</span>] &gt;= bbox_utm[<span class="ansi-green-fg">1</span>]) &amp; (zarr_meas[<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">y</span><span class="ansi-yellow-fg">'</span>] &lt;= bbox_utm[<span class="ansi-green-fg">3</span>])

<span class="ansi-red-fg">NameError</span>: name 'zarr_meas' is not defined</pre>
</div>
</div>
</div>
</section>
<section id="band-selection-normalisation-composite-creation-and-equalisation" class="level4">
<h4 class="anchored" data-anchor-id="band-selection-normalisation-composite-creation-and-equalisation">Band selection, normalisation composite creation and equalisation</h4>
<p>In the next step, we proceed to select the relevant bands from the item, apply normalisation and equalisation, in order to visualise the True-Color composite of 11 June 2025 over the Nuoto region in Sardinia.</p>
<div id="49" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The tc_red, tc_green, and tc_blue variables are inputs specifying the band names</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>red <span class="op">=</span> zarr_meas[tc_red].where(valid_mask)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>gre <span class="op">=</span>  zarr_meas[tc_green].where(valid_mask)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>blu <span class="op">=</span>  zarr_meas[tc_blue].where(valid_mask)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The mask_sub_utm() function takes the bands and masks them to the valid rows and columns</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>red <span class="op">=</span> mask_sub_utm(red,rows, cols).values</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>gre <span class="op">=</span> mask_sub_utm(gre,rows, cols).values</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>blu <span class="op">=</span> mask_sub_utm(blu,rows, cols).values</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># The zarr_meas group is the input dataset containing the dimensions</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co"># by slicing the 'y' dimension array based on the minimum and maximum row indices</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>y_zarr <span class="op">=</span> zarr_meas[<span class="st">'y'</span>].isel(y<span class="op">=</span><span class="bu">slice</span>(rows.<span class="bu">min</span>(), rows.<span class="bu">max</span>() <span class="op">+</span> <span class="dv">1</span>)).values</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co"># also, the same for the 'x' dimension array based on the minimum and maximum column indices</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>x_zarr <span class="op">=</span> zarr_meas[<span class="st">'x'</span>].isel(x<span class="op">=</span><span class="bu">slice</span>(cols.<span class="bu">min</span>(), cols.<span class="bu">max</span>() <span class="op">+</span> <span class="dv">1</span>)).values</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>map_ext_deg <span class="op">=</span> <span class="bu">list</span>(t_utm_to_deg.transform(np.nanmin(x_zarr),np.nanmin(y_zarr)) <span class="op">+</span> </span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>                   t_utm_to_deg.transform(np.nanmax(x_zarr),np.nanmax(y_zarr)))</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Input: percentile range for contrast stretching</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>contrast_stretch_percentile<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">98</span>)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Input: gamma correction value</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>gamma<span class="op">=</span><span class="fl">1.8</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply normalisation to the red, green and blue bands using the specified percentile and gamma values</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>red_processed <span class="op">=</span> normalisation_str_gm(red, <span class="op">*</span>contrast_stretch_percentile, gamma)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>green_processed <span class="op">=</span> normalisation_str_gm(gre, <span class="op">*</span>contrast_stretch_percentile, gamma)</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>blue_processed <span class="op">=</span> normalisation_str_gm(blu, <span class="op">*</span>contrast_stretch_percentile, gamma)</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="co"># We stack the processed red, green, and blue arrays</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>rgb_composite_sm <span class="op">=</span> np.dstack((red_processed, green_processed, blue_processed)).astype(np.float32)</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding equalisation from skimage:</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>fire_tc <span class="op">=</span> exposure.equalize_adapthist(rgb_composite_sm)</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>plt.imshow(fire_tc)</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Equalised Composite'</span>) <span class="co"># Add a title for clarity</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[16]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> <span style="font-style:italic;color:rgb(95,135,135)"># The tc_red, tc_green, and tc_blue variables are inputs specifying the band names</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span> red = <span class="ansi-yellow-bg">zarr_meas</span>[tc_red].where(valid_mask)
<span class="ansi-green-fg">      3</span> gre =  zarr_meas[tc_green].where(valid_mask)
<span class="ansi-green-fg">      4</span> blu =  zarr_meas[tc_blue].where(valid_mask)

<span class="ansi-red-fg">NameError</span>: name 'zarr_meas' is not defined</pre>
</div>
</div>
</div>
</section>
</section>
<section id="overlay-sentinel-2-true-color-composite-with-sentinel-3-lst-data" class="level3">
<h3 class="anchored" data-anchor-id="overlay-sentinel-2-true-color-composite-with-sentinel-3-lst-data">Overlay Sentinel-2 True-Color composite with Sentinel-3 LST data</h3>
<p>And finally, we can <strong>georeference</strong> and overlay the two datasets, the True-Color composite from Sentinel-2 as well as the Land Surface Temperature information from Sentinel-3.</p>
<div id="52" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Overlay</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">8</span>))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the coordinate reference system (CRS) for latitude/longitude</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>data_ll <span class="op">=</span> ccrs.PlateCarree()</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes(projection<span class="op">=</span>data_ll)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the Sentinel-2 true-colour composite (TCI) image</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> ax.imshow(fire_tc, origin<span class="op">=</span><span class="st">'upper'</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                extent<span class="op">=</span>[map_ext_deg[<span class="dv">0</span>],map_ext_deg[<span class="dv">2</span>],map_ext_deg[<span class="dv">1</span>],map_ext_deg[<span class="dv">3</span>]],  <span class="co"># item</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>                transform<span class="op">=</span>data_ll)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the land surface temperature (LST) data as an overlay</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>im2 <span class="op">=</span> ax.imshow(lstf_clip, origin<span class="op">=</span><span class="st">'upper'</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>                extent<span class="op">=</span>[np.nanmin(lon_lst), np.nanmax(lon_lst),</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>                        np.nanmin(lat_lst), np.nanmax(lat_lst)],</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>                transform<span class="op">=</span>data_ll, <span class="co"># coordinates</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>                cmap<span class="op">=</span>col_map,  norm<span class="op">=</span>norm) <span class="co"># The custom colour map for LST</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(im2,ticks<span class="op">=</span>bounds, shrink<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">"Land Surface Temperature (K)"</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co"># features</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>ax.add_geometries(map_box, crs<span class="op">=</span>data_ll, facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'yellow'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">'-'</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>ax.gridlines(draw_labels<span class="op">=</span><span class="va">True</span>, dms<span class="op">=</span><span class="va">True</span>, x_inline<span class="op">=</span><span class="va">False</span>, y_inline<span class="op">=</span><span class="va">False</span>) <span class="co"># Add gridlines and labels</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust title and plot parameters for a tight layout</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Sentinel-2 L2A TCI + LST for the </span><span class="sc">{</span>fire_d_s3<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[17]</span><span class="ansi-green-fg">, line 8</span>
<span class="ansi-green-fg">      6</span> ax = plt.axes(projection=data_ll)
<span class="ansi-green-fg">      7</span> <span style="font-style:italic;color:rgb(95,135,135)"># Display the Sentinel-2 true-colour composite (TCI) image</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">8</span> img = ax.imshow(<span class="ansi-yellow-bg">fire_tc</span>, origin=<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">upper</span><span class="ansi-yellow-fg">'</span>,
<span class="ansi-green-fg">      9</span>                 extent=[map_ext_deg[<span class="ansi-green-fg">0</span>],map_ext_deg[<span class="ansi-green-fg">2</span>],map_ext_deg[<span class="ansi-green-fg">1</span>],map_ext_deg[<span class="ansi-green-fg">3</span>]],  <span style="font-style:italic;color:rgb(95,135,135)"># item</span>
<span class="ansi-green-fg">     10</span>                 transform=data_ll)
<span class="ansi-green-fg">     11</span> <span style="font-style:italic;color:rgb(95,135,135)"># Display the land surface temperature (LST) data as an overlay</span>
<span class="ansi-green-fg">     12</span> im2 = ax.imshow(lstf_clip, origin=<span class="ansi-yellow-fg">'</span><span class="ansi-yellow-fg">upper</span><span class="ansi-yellow-fg">'</span>,
<span class="ansi-green-fg">     13</span>                 extent=[np.nanmin(lon_lst), np.nanmax(lon_lst),
<span class="ansi-green-fg">     14</span>                         np.nanmin(lat_lst), np.nanmax(lat_lst)],
<span class="ansi-green-fg">     15</span>                 transform=data_ll, <span style="font-style:italic;color:rgb(95,135,135)"># coordinates</span>
<span class="ansi-green-fg">     16</span>                 cmap=col_map,  norm=norm) <span style="font-style:italic;color:rgb(95,135,135)"># The custom colour map for LST</span>

<span class="ansi-red-fg">NameError</span>: name 'fire_tc' is not defined</pre>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="62_sardinia_s3_lst_files/figure-html/cell-18-output-2.png" width="1061" height="540" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The <strong>Sentinel-2 L2A</strong> provides the geographical context of the landscape, while the <strong>Sentinel-3 SLSTR</strong> LST information provides an indication of the hottest areas on that day. This allows for a more accurate and immediate understanding of a fire‚Äôs behaviour during the event. We can see that the hottest detected spot over the area of interest is indeed aligned with the fire event location.<br></p>
<p>The overlay provides additional information, especially in conditions where optical views are limited. For example, during less light hours or through heavy smoke, the thermal data can still reveal the fire‚Äôs true footprint.</p>
</section>
<section id="calculating-processing-time" class="level3">
<h3 class="anchored" data-anchor-id="calculating-processing-time">Calculating processing time</h3>
<div id="55" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>et <span class="op">=</span> time.time()</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>total_t <span class="op">=</span> et <span class="op">-</span> st</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Total Running Time: '</span>, total_t,<span class="st">' seconds'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total Running Time:  4.452671527862549  seconds</code></pre>
</div>
</div>
<p>A significant takeaway from this process is its remarkable speed. The entire workflow, from data access to visualisation, is completed in under two minutes. Here is the key evident advantage of using <code>.zarr</code> encoding for wildfire detection. <br> EOPF enables us to quickly access and combine Sentinel data directly from the cloud without the need to download large volumes of data.</p>
<hr>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>By integrating items from <strong>Sentinel-2</strong> with critical thermal data from <strong>Sentinel-3</strong> through the <a href="">EOPF STAC Catalog</a> Collections, this notebook has demonstrated a complete and efficient workflow for analysing a real-world wildfire event. <br></p>
<p>We were able to create <strong>a powerful overlay</strong> that not only shows the <strong>geographical context</strong> of the <strong>burnt area</strong> but also precisely <strong>identifies</strong> the active <strong>heat signatures</strong> associated with the fire. This approach proves that combining different types of satellite data is essential for gaining a complete understanding of complex environmental events.</p>
<hr>
</section>
<section id="whats-next" class="level2">
<h2 class="anchored" data-anchor-id="whats-next">What‚Äôs next?</h2>
<p>Building on our visual analysis, the <a href="../06_eopf_zarr_in_action/63_sardinia_dNBR.html">next tutorial</a> will introduce a quantitative method to assess fire severity. We will calculate the <strong>Normalised Burn Ratio</strong> (NBR) using data from <strong>Sentinel-2</strong> satellite imagery.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../06_eopf_zarr_in_action/61_sardinia_s2_tfci.html" class="pagination-link" aria-label="Fire in Sardinia 2025 - Part 1">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Fire in Sardinia 2025 - Part 1</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../06_eopf_zarr_in_action/63_sardinia_dNBR.html" class="pagination-link" aria-label="Fire in Sardinia 2025 - Part 3">
        <span class="nav-page-text"><span class="chapter-title">Fire in Sardinia 2025 - Part 3</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Development Seed, thriveGEO and SparkGeo</p>
</div>   
    <div class="nav-footer-center">
<p>License: Apache 2.0</p>
</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link active" href="https://github.com/eopf-toolkit/eopf-101" aria-current="page">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>