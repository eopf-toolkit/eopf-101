<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Fire in Sardinia 2025 - Part 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./62_sardinia_s3_lst.html" rel="next">
<link href="./44_eopf_stac_xarray_tutorial.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-0dd2bd5de344125cf763a379ddc3eb04.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./61_sardinia_s2_tfci.html">EOPF Zarr in Action</a></li><li class="breadcrumb-item"><a href="./61_sardinia_s2_tfci.html"><span class="chapter-title">Fire in Sardinia 2025 - Part 1</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./img/EOPF_FINAL_LOGO.png" alt="" class="sidebar-logo light-content py-0 d-lg-inline d-none">
      <img src="./img/EOPF_FINAL_LOGO.png" alt="" class="sidebar-logo dark-content py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://github.com/eopf-toolkit/eopf-101" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title"><strong>ESA EOPF 101</strong></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>About EOPF</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_about_eopf.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introduction to the EOPF</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_about_cloudoptimized_formats.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">About cloud-optimised formats</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_overview_eopf_datasets.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Overview of EOPF Zarr Products</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>About EOPF Zarr</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_what_is_zarr.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Overview of the EOPF Zarr format</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_zarr_structure_S1GRD.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Discover EOPF Zarr - Sentinel-1 GRD</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_S1_basic_operations.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Operations with EOPF Zarr - Sentinel-1 GRD</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24_zarr_struct_S2L2A.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Discover EOPF Zarr - Sentinel-2 L2A</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25_zarr_struct_S3.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Discover EOPF Zarr - Sentinel-3 SLSTR Level-2 LST</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>About Chunking</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./31_zarr_chunking_intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">An introduction to Chunking</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./32_zarr_chunking_strat.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Best practices and Chunking optimisation in EOPF</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>EOPF and STAC</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./41_stac_intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introduction to STAC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./42_eopf_stac_zarr_tutorial.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Explore the web interface of the EOPF Zarr STAC Catalog</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./43_eopf_stac_connection.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Access the EOPF Zarr STAC API with Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./44_eopf_stac_xarray_tutorial.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">From STAC to Data: Accessing EOPF Zarr with xarray</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">[COMING SOON] Tools to work with EOPF Zarr</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">EOPF Zarr in Action</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./61_sardinia_s2_tfci.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Fire in Sardinia 2025 - Part 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./62_sardinia_s3_lst.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Fire in Sardinia 2025 - Part 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./63_sardinia_dNBR.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Fire in Sardinia 2025 - Part 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./64_flood_mapping_valencia.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Flood Mapping - Time Series Analysis in Valencia</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./glossary.html" class="sidebar-item-text sidebar-link"><span class="chapter-title"><strong>Glossary</strong></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link"><span class="chapter-title"><strong>References</strong></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#the-fire-event" id="toc-the-fire-event" class="nav-link" data-scroll-target="#the-fire-event">The Fire Event</a></li>
  <li><a href="#the-case-study" id="toc-the-case-study" class="nav-link" data-scroll-target="#the-case-study">The case study</a></li>
  <li><a href="#about-this-notebook" id="toc-about-this-notebook" class="nav-link" data-scroll-target="#about-this-notebook">About this notebook</a></li>
  <li><a href="#what-we-will-learn" id="toc-what-we-will-learn" class="nav-link" data-scroll-target="#what-we-will-learn">What we will learn</a></li>
  </ul></li>
  <li><a href="#setting-up-the-environment" id="toc-setting-up-the-environment" class="nav-link" data-scroll-target="#setting-up-the-environment">Setting up the environment</a>
  <ul class="collapse">
  <li><a href="#defining-parameters-for-querying-the-eopf-stac-catalog" id="toc-defining-parameters-for-querying-the-eopf-stac-catalog" class="nav-link" data-scroll-target="#defining-parameters-for-querying-the-eopf-stac-catalog">Defining parameters for querying the EOPF STAC catalog</a></li>
  <li><a href="#initiate-a-dask-cluster" id="toc-initiate-a-dask-cluster" class="nav-link" data-scroll-target="#initiate-a-dask-cluster">Initiate a Dask cluster</a></li>
  <li><a href="#establish-a-connection-to-the-eopf-stac-catalog" id="toc-establish-a-connection-to-the-eopf-stac-catalog" class="nav-link" data-scroll-target="#establish-a-connection-to-the-eopf-stac-catalog">Establish a connection to the EOPF STAC Catalog</a></li>
  </ul></li>
  <li><a href="#pre-fire-visualisation" id="toc-pre-fire-visualisation" class="nav-link" data-scroll-target="#pre-fire-visualisation">Pre-Fire Visualisation</a>
  <ul class="collapse">
  <li><a href="#pre-fire-true-colour-image" id="toc-pre-fire-true-colour-image" class="nav-link" data-scroll-target="#pre-fire-true-colour-image">Pre-Fire True Colour Image</a></li>
  <li><a href="#pre-fire-false-colour-image" id="toc-pre-fire-false-colour-image" class="nav-link" data-scroll-target="#pre-fire-false-colour-image">Pre-Fire False Colour Image</a></li>
  </ul></li>
  <li><a href="#post-fire-visualisation" id="toc-post-fire-visualisation" class="nav-link" data-scroll-target="#post-fire-visualisation">Post-Fire Visualisation</a>
  <ul class="collapse">
  <li><a href="#post-fire-true-colour-image" id="toc-post-fire-true-colour-image" class="nav-link" data-scroll-target="#post-fire-true-colour-image">Post-Fire True Colour Image</a></li>
  <li><a href="#post-fire-false-colour-image" id="toc-post-fire-false-colour-image" class="nav-link" data-scroll-target="#post-fire-false-colour-image">Post-Fire False Colour Image</a></li>
  </ul></li>
  <li><a href="#compare-pre--and-post-fire-composites" id="toc-compare-pre--and-post-fire-composites" class="nav-link" data-scroll-target="#compare-pre--and-post-fire-composites">Compare pre- and post-fire composites</a></li>
  <li><a href="#calculating-processing-time" id="toc-calculating-processing-time" class="nav-link" data-scroll-target="#calculating-processing-time">Calculating processing time</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#whats-next" id="toc-whats-next" class="nav-link" data-scroll-target="#whats-next">What’s next?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./61_sardinia_s2_tfci.html">EOPF Zarr in Action</a></li><li class="breadcrumb-item"><a href="./61_sardinia_s2_tfci.html"><span class="chapter-title">Fire in Sardinia 2025 - Part 1</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">Fire in Sardinia 2025 - Part 1</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Communities and ecosystems worldwide are under <strong>increasing threat</strong> from <strong>wildfires</strong>, a problem that is being made worse by <strong>climate change</strong>.<br></p>
<p>Monitoring these events is crucial, and <strong>satellite imagery</strong> is an invaluable tool in this effort. The <strong>Sentinel satellite missions</strong> offer valuable insights into the different stages of a fire. A <strong>True Colour Composite</strong> of Sentinel-2 data can be used to track smoke, <strong>False Colour Composites</strong> can clearly distinguish healthy vegetation from damaged or burnt areas. Furthermore, True- or False color composites can be combined with other data sources, such as Land Surface Temperature (LST) from <strong>Sentinel-3</strong>. Temperature anomalies retrieved from Sentinel-3 data are useful information to get a more comprehensive picture of a fire event.</p>
<section id="the-fire-event" class="level3">
<h3 class="anchored" data-anchor-id="the-fire-event">The Fire Event</h3>
<p>According to the <a href="https://alleanzacontroilcancro.it/en/istituto/istituto-istituto-superiore-sanita/">Italian National Institute of Health (ISS)</a>, between January and July 2025, Italy experienced a significant number of wildfires, with approximately 700 recorded incidents burning over 320 square kilometres.<br></p>
<p>We will focus on a specific fire that occurred in the <strong>Province of Nuoro</strong> in the Italian region of <strong>Sardinia</strong>, on <strong>June 10th, 2025</strong>. The <a href="https://forest-fire.emergency.copernicus.eu/?pk_vid=1c5add39a04f87ba17556907226604b6">European Forest Fire Information System (EFFIS)</a> estimated that it consumed an estimated 1000 hectares. Based on this area, we can expect it to be clearly visible in Sentinel-2 imagery with a 20-metre resolution.</p>
</section>
<section id="the-case-study" class="level3">
<h3 class="anchored" data-anchor-id="the-case-study">The case study</h3>
<p>This case study consists of a <strong>series</strong> of <strong>three notebooks</strong>:</p>
<ul>
<li><strong>Part 1 - Compare Sentinel-2 True- and False-Color composites before and after a fire event</strong></li>
<li><a href="./62_s3_lst.ipynb">Part 2 - Analyse fire intensity with Sentinel-2 and -3 data</a></li>
<li><a href="./63_sardinia_dNBR.html">Part 3 - Assess burn severity with the normalised burn ratio (dNBR)</a></li>
</ul>
<p>The three notebooks will guide you through a comprehensive <strong>remote sensing workflow</strong> for <strong>monitoring</strong> <strong>wildfires</strong> covering all stages of a <strong>fire life cycle</strong>: <strong>before</strong>, <strong>during</strong>, and <strong>after</strong> an event.</p>
</section>
<section id="about-this-notebook" class="level3">
<h3 class="anchored" data-anchor-id="about-this-notebook">About this notebook</h3>
<p>This notebook will take you through a practical example of how you can use Sentinel-2 data to visually compare an area before and after a wildfire event.<br></p>
<p>We will access Sentinel-2 data available at the <a href="https://stac.browser.user.eopf.eodc.eu/?.language=en">EOPF STAC Catalog</a> to compare the landscape before and after wildfire event. Such a comparison allows us to determine the extent of the damage caused by the wildfire. This comparison can be done by using different combinations of spectral bands to identify <strong>healthy</strong> vs.&nbsp;<strong>damaged</strong> vegetation.</p>
</section>
<section id="what-we-will-learn" class="level3">
<h3 class="anchored" data-anchor-id="what-we-will-learn">What we will learn</h3>
<ul>
<li>💨 Create cloud-free layers from Sentinel-2 L2A data for a clear view of the surface at a fire location.</li>
<li>✂️ Extract and clip specific areas of interest from satellite imagery using a STAC catalog and reprojected bounding boxes.</li>
<li>🛰️ Set a starting point for wildfire events analysis by visualising vegetation and land conditions using Sentinel-2 L2A imagery.</li>
</ul>
<hr>
<section id="import-libraries" class="level4">
<h4 class="anchored" data-anchor-id="import-libraries">Import libraries</h4>
<div id="10" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> distributed <span class="im">import</span> LocalCluster</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pystac_client <span class="im">import</span> Client</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyproj <span class="im">import</span> Transformer</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartopy.crs <span class="im">as</span> ccrs</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartopy.feature <span class="im">as</span> cfeature</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> skimage <span class="im">import</span> exposure</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> BoundaryNorm, ListedColormap</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="helper-functions" class="level4">
<h4 class="anchored" data-anchor-id="helper-functions">Helper functions</h4>
<p>This notebook makes use of a set of functions that are all listed inside the <a href="./zarr_wf_utils.py">zarr_wf_utils.py</a> script. Inside the script, we will find costumised functions that allow us to mask, normalise and extract specific areas of our items of interest.</p>
<div id="13" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import our utility functions</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> zarr_wf_utils <span class="im">import</span> (</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    validate_scl,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    mask_sub_utm,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    normalisation_str_gm,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    lat_lon_to_utm_box,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    zarr_mask_utm</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
</section>
</section>
</section>
<section id="setting-up-the-environment" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-the-environment">Setting up the environment</h2>
<section id="defining-parameters-for-querying-the-eopf-stac-catalog" class="level3">
<h3 class="anchored" data-anchor-id="defining-parameters-for-querying-the-eopf-stac-catalog">Defining parameters for querying the EOPF STAC catalog</h3>
<p>As a first step, we need to define specific parameters for our query, including:<br></p>
<ul>
<li>two <strong>key dates</strong> for our comparison: one date for a <strong>pre-fire</strong> view, <strong>3rd of June 2025</strong> (one week before the event) and a second for the <strong>post-fire</strong> view on <strong>21st June 2025</strong> (10 days after)</li>
<li>the <strong>data collection</strong> we are interested in, and</li>
<li><strong>bounding box</strong> information for the area of interest.</li>
</ul>
<p>In addition, we set the appropriate re-projection parameters to ensure a smooth and efficient workflow.</p>
<div id="18" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The timeframe and area of interest for our filtering</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>def_collection <span class="op">=</span> <span class="st">'sentinel-2-l2a'</span> <span class="co"># collection</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Before the fire:</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>pre_f  <span class="op">=</span> <span class="st">'2025-06-03'</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># After the fire:</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>post_f <span class="op">=</span> <span class="st">'2025-06-21'</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>search_bbox <span class="op">=</span> (<span class="fl">8.847198</span>,<span class="fl">40.193395</span>,<span class="fl">8.938865</span>,<span class="fl">40.241895</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Definition of the transformer parameters from lat/lon to UTM that ensure</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># correct overlay of layers</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>transformer <span class="op">=</span> Transformer.from_crs(<span class="st">"EPSG:4326"</span>, <span class="st">"EPSG:32632"</span>, always_xy<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>t_utm_to_deg <span class="op">=</span> Transformer.from_crs(<span class="st">"EPSG:32632"</span>,<span class="st">"EPSG:4326"</span>, always_xy<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="initiate-a-dask-cluster" class="level3">
<h3 class="anchored" data-anchor-id="initiate-a-dask-cluster">Initiate a Dask cluster</h3>
<p>In a next step we initiate a <strong>virtual Dask cluster</strong>. This cluster consists of a scheduler (the “brain”) and several workers (the “hands”), which enables faster processing of large datasets by breaking down tasks and running them in parallel. <br> A client is then created to manage communication between the code and this cluster.</p>
<p>For more information, feel free to visit the <strong>dask</strong> <a href="https://docs.dask.org/en/stable/">documentation</a> and the tutorial <a href="http://docs.dask.org/en/stable/#how-to-use-dask">How to use dask</a>.</p>
<div id="20" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To track the the performance the code will have</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>st <span class="op">=</span> time.time()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>cluster <span class="op">=</span> LocalCluster()</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> cluster.get_client()</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>client</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>
    <div style="width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;"> </div>
    <div style="margin-left: 48px;">
        <h3 style="margin-bottom: 0px;" class="anchored">Client</h3>
        <p style="color: #9D9D9D; margin-bottom: 0px;">Client-8e9375b2-9ad3-11f0-92cf-32d73740927e</p>
        
<table class="caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Connection method:</strong> Cluster object</td>
<td style="text-align: left;"><strong>Cluster type:</strong> distributed.LocalCluster</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:8787/status" target="_blank">http://127.0.0.1:8787/status</a></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>


        

        
            <details>
            <summary style="margin-bottom: 20px;"><h3 style="display: inline;" class="anchored">Cluster Info</h3></summary>
            <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output">
    <div style="width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;">
    </div>
    <div style="margin-left: 48px;">
        <h3 style="margin-bottom: 0px; margin-top: 0px;" class="anchored">LocalCluster</h3>
        <p style="color: #9D9D9D; margin-bottom: 0px;">84228c1a</p>
        
<table class="caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:8787/status" target="_blank">http://127.0.0.1:8787/status</a></td>
<td style="text-align: left;"><strong>Workers:</strong> 4</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Total threads:</strong> 4</td>
<td style="text-align: left;"><strong>Total memory:</strong> 15.62 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Status:</strong> running</td>
<td style="text-align: left;"><strong>Using processes:</strong> True</td>
</tr>
</tbody>
</table>


        <details>
            <summary style="margin-bottom: 20px;">
                <h3 style="display: inline;" class="anchored">Scheduler Info</h3>
            </summary>

            <div style="">
    <div>
        <div style="width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;"> </div>
        <div style="margin-left: 48px;">
            <h3 style="margin-bottom: 0px;" class="anchored">Scheduler</h3>
            <p style="color: #9D9D9D; margin-bottom: 0px;">Scheduler-e0f2e749-5ce7-402a-b471-82632451ac5c</p>
            
<table class="caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:34729</td>
<td style="text-align: left;"><strong>Workers:</strong> 0</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:8787/status" target="_blank">http://127.0.0.1:8787/status</a></td>
<td style="text-align: left;"><strong>Total threads:</strong> 0</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Started:</strong> Just now</td>
<td style="text-align: left;"><strong>Total memory:</strong> 0 B</td>
</tr>
</tbody>
</table>

        </div>
    </div>

    <details style="margin-left: 48px;">
        <summary style="margin-bottom: 20px;">
            <h3 style="display: inline;" class="anchored">Workers</h3>
        </summary>

        
        <div style="margin-bottom: 20px;">
            <div style="width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;"> </div>
            <div style="margin-left: 48px;">
            <details>
                <summary>
                    <h4 style="margin-bottom: 0px; display: inline;" class="anchored">Worker: 0</h4>
                </summary>
                
<table class="caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:37267</td>
<td style="text-align: left;"><strong>Total threads:</strong> 1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:41025/status" target="_blank">http://127.0.0.1:41025/status</a></td>
<td style="text-align: left;"><strong>Memory:</strong> 3.91 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Nanny:</strong> tcp://127.0.0.1:38603</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td colspan="2" style="text-align: left;"><strong>Local directory:</strong> /tmp/dask-scratch-space/worker-pcfvg6sn</td>
</tr>
</tbody>
</table>

            </details>
            </div>
        </div>
        
        <div style="margin-bottom: 20px;">
            <div style="width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;"> </div>
            <div style="margin-left: 48px;">
            <details>
                <summary>
                    <h4 style="margin-bottom: 0px; display: inline;" class="anchored">Worker: 1</h4>
                </summary>
                
<table class="caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:34281</td>
<td style="text-align: left;"><strong>Total threads:</strong> 1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:40807/status" target="_blank">http://127.0.0.1:40807/status</a></td>
<td style="text-align: left;"><strong>Memory:</strong> 3.91 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Nanny:</strong> tcp://127.0.0.1:45687</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td colspan="2" style="text-align: left;"><strong>Local directory:</strong> /tmp/dask-scratch-space/worker-myq9d4kz</td>
</tr>
</tbody>
</table>

            </details>
            </div>
        </div>
        
        <div style="margin-bottom: 20px;">
            <div style="width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;"> </div>
            <div style="margin-left: 48px;">
            <details>
                <summary>
                    <h4 style="margin-bottom: 0px; display: inline;" class="anchored">Worker: 2</h4>
                </summary>
                
<table class="caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:45487</td>
<td style="text-align: left;"><strong>Total threads:</strong> 1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:38325/status" target="_blank">http://127.0.0.1:38325/status</a></td>
<td style="text-align: left;"><strong>Memory:</strong> 3.91 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Nanny:</strong> tcp://127.0.0.1:39409</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td colspan="2" style="text-align: left;"><strong>Local directory:</strong> /tmp/dask-scratch-space/worker-r17enx_a</td>
</tr>
</tbody>
</table>

            </details>
            </div>
        </div>
        
        <div style="margin-bottom: 20px;">
            <div style="width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;"> </div>
            <div style="margin-left: 48px;">
            <details>
                <summary>
                    <h4 style="margin-bottom: 0px; display: inline;" class="anchored">Worker: 3</h4>
                </summary>
                
<table class="caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:35243</td>
<td style="text-align: left;"><strong>Total threads:</strong> 1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:46811/status" target="_blank">http://127.0.0.1:46811/status</a></td>
<td style="text-align: left;"><strong>Memory:</strong> 3.91 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Nanny:</strong> tcp://127.0.0.1:46021</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td colspan="2" style="text-align: left;"><strong>Local directory:</strong> /tmp/dask-scratch-space/worker-ugyzecv6</td>
</tr>
</tbody>
</table>

            </details>
            </div>
        </div>
        

    </details>
</div>

        </details>
    </div>
</div>
            </details>
        

    </div>
</div>
</div>
</div>
</section>
<section id="establish-a-connection-to-the-eopf-stac-catalog" class="level3">
<h3 class="anchored" data-anchor-id="establish-a-connection-to-the-eopf-stac-catalog">Establish a connection to the EOPF STAC Catalog</h3>
<p>Data is retrieved from the endpoint of the <a href="https://stac.browser.user.eopf.eodc.eu/?.language=en">EOPF STAC Catalog</a>. We can do this with the function <code>Client.open()</code> from the <code>pystac_client</code> library.</p>
<div id="22" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>eopf_stac_api_root_endpoint <span class="op">=</span> <span class="st">"https://stac.core.eopf.eodc.eu/"</span> <span class="co">#root starting point</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>eopf_catalog <span class="op">=</span> Client.<span class="bu">open</span>(url<span class="op">=</span>eopf_stac_api_root_endpoint) <span class="co"># calls the selected url</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="pre-fire-visualisation" class="level2">
<h2 class="anchored" data-anchor-id="pre-fire-visualisation">Pre-Fire Visualisation</h2>
<p>The first step is to create a <strong>visual representation</strong> of our area of interest for a day before the fire occured: 3 June 2025. We will use the parameters we defined at the beginning to query the STAC collection and retrieve the specific <strong>pre-fire</strong> images needed for our analysis.</p>
<p>With the <code>search()</code> function, you can query a STAC catalog based on given keyword arguments. As a result of the search, you see that one Item is returned from the STAC Catalog.</p>
<div id="24" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interest timeframe parameters for the filtering</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>date_pre <span class="op">=</span> pre_f <span class="op">+</span> <span class="st">'T00:00:00Z/'</span> <span class="op">+</span> pre_f <span class="op">+</span> <span class="st">'T23:59:59.999999Z'</span> <span class="co"># interest period</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>s2_col <span class="op">=</span> <span class="bu">list</span>(eopf_catalog.search(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                bbox<span class="op">=</span> search_bbox, <span class="co"># area</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                datetime<span class="op">=</span> date_pre, <span class="co">#time frame</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                collections<span class="op">=</span>def_collection <span class="co"># collection</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                ).item_collection())</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>av_urls <span class="op">=</span> [item.assets[<span class="st">"product"</span>].href <span class="cf">for</span> item <span class="kw">in</span> s2_col]  <span class="co"># stores the available Items URLs</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Search Results:"</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Total Items Found for Sentinel-2 L2A over Sardinia:  '</span>,<span class="bu">len</span>(av_urls))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Search Results:
Total Items Found for Sentinel-2 L2A over Sardinia:   1</code></pre>
</div>
</div>
<p>Now, we can retrieve the item and directly and open it as a <code>xarray.DataTree</code>. In addition, key information from the item’s properties is also extracted to verify key properties of the item.</p>
<div id="26" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We are interested in the datasets contained in the measurements bands for True Colour and False Colour Composites.</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>s2_zarr <span class="op">=</span> xr.open_datatree(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    av_urls[<span class="dv">0</span>], engine<span class="op">=</span><span class="st">"zarr"</span>, <span class="co">#we always get the earliest one (the first available item goes last)</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    chunks<span class="op">=</span>{},</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    decode_timedelta<span class="op">=</span><span class="va">False</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Store interest parameters for further plotting:</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>date <span class="op">=</span> s2_zarr.attrs[<span class="st">'stac_discovery'</span>][<span class="st">'properties'</span>][<span class="st">'start_datetime'</span>][:<span class="dv">10</span>]</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>time_zarr <span class="op">=</span> s2_zarr.attrs[<span class="st">'stac_discovery'</span>][<span class="st">'properties'</span>][<span class="st">'start_datetime'</span>][<span class="dv">11</span>:<span class="dv">19</span>]</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>target_crs <span class="op">=</span> s2_zarr.attrs[<span class="st">"stac_discovery"</span>][<span class="st">"properties"</span>][<span class="st">"proj:epsg"</span>]</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Item for the </span><span class="sc">{</span>date<span class="sc">}</span><span class="ss"> at </span><span class="sc">{</span>time_zarr<span class="sc">}</span><span class="ss">'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Item for the 2025-06-03 at 10:10:41</code></pre>
</div>
</div>
<p>The spectral bands we will need for our analysis are found within the <code>/reflectance</code> group, specifically under the <code>r20m</code> subgroup.<br></p>
<p>Before directly processing our assets of interest, we will filter out invalid pixels, such as pixels containing clouds, cloud shadows, or areas with no data. We will use the <strong>Scene Classification Layer</strong> (SCL) available inside the <code>.zarr</code> item, which is a separate asset located under the <code>/classification/r20m</code> group.</p>
<p>By using the pre-defined <code>validate_scl()</code> function, we can create a boolean mask that masks out invalid pixels.</p>
<div id="28" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the resolution group we are interested to analyse over:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>zarr_meas <span class="op">=</span> s2_zarr.measurements.reflectance.r20m</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the Scene Classification Layer at 20m resolution:</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>l2a_class_20m <span class="op">=</span> s2_zarr.conditions.mask.l2a_classification.r20m.scl</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function `validatae_scl` to mask out invalid pixels</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>valid_mask <span class="op">=</span> validate_scl(l2a_class_20m)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The visualisation we are intending to create covers a larger extent than the specific fire area. This helps us to better understand the event’s overall spatial extent. For this, we generate a bounding box to visually pinpoint the fire’s precise location within a wider composite image.</p>
<div id="30" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining a larger bounding box for better visualisation:</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>bbox_vis <span class="op">=</span> (<span class="fl">8.649555</span>,<span class="fl">40.073583</span>,<span class="fl">9.127893</span>,<span class="fl">40.343840</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># A fixed geographic bounding box to highlight the AOI in the map format</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>map_box <span class="op">=</span> search_bbox</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>In next step, we need to reproject the area of interest from EPSG: <strong>4326</strong> to UTM coordinates. Once the area is defined, our loaded data (<code>zarr_meas</code>) is masked using the defined <code>bbox_utm</code>. After extracting the area, only the valid pixels are selected.</p>
<div id="32" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A new list with the converted UTM coordinates</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>bbox_utm <span class="op">=</span> lat_lon_to_utm_box((bbox_vis[<span class="dv">0</span>], bbox_vis[<span class="dv">1</span>]),(bbox_vis[<span class="dv">2</span>], bbox_vis[<span class="dv">3</span>]),transformer)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the box() function to create a polygon from the coordinates</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>map_box <span class="op">=</span> box(map_box[<span class="dv">0</span>],map_box[<span class="dv">1</span>],map_box[<span class="dv">2</span>],map_box[<span class="dv">3</span>])</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Boolean mask for the 'x' dimension (longitude/easting)</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>x_mask <span class="op">=</span> (zarr_meas[<span class="st">'x'</span>] <span class="op">&gt;=</span> bbox_utm[<span class="dv">0</span>]) <span class="op">&amp;</span> (zarr_meas[<span class="st">'x'</span>] <span class="op">&lt;=</span> bbox_utm[<span class="dv">2</span>])</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Boolean mask for the 'y' dimension (latitude/northing)</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>y_mask <span class="op">=</span> (zarr_meas[<span class="st">'y'</span>] <span class="op">&gt;=</span> bbox_utm[<span class="dv">1</span>]) <span class="op">&amp;</span> (zarr_meas[<span class="st">'y'</span>] <span class="op">&lt;=</span> bbox_utm[<span class="dv">3</span>])</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Combined mask for the bounding box</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>bbox_mask <span class="op">=</span> x_mask <span class="op">&amp;</span> y_mask</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract row and column indices where the mask is True</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>cols,rows <span class="op">=</span> np.where(bbox_mask)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="pre-fire-true-colour-image" class="level3">
<h3 class="anchored" data-anchor-id="pre-fire-true-colour-image">Pre-Fire True Colour Image</h3>
<p>Once we have created the necessary masks, we can proceed to create True Color Image composites. For the composite creation, <code>zarr_meas</code> contains the assets we are interested in. The TCI composite makes use of the <strong>red</strong> (B04), <strong>green</strong> (B03), and <strong>blue</strong> (B02) bands to create a view that looks natural to the human eye.</p>
<p>xarray’s <code>where()</code> function allows us to apply the SLC filtering we had previously defined.</p>
<div id="34" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># True colour channels we are interested to retrieve composite:</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>tc_red  <span class="op">=</span> <span class="st">'b04'</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>tc_green<span class="op">=</span> <span class="st">'b03'</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>tc_blue <span class="op">=</span> <span class="st">'b02'</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The tc_red, tc_green, and tc_blue variables are inputs specifying the band names</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>red <span class="op">=</span> zarr_meas[tc_red].where(valid_mask)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>gre <span class="op">=</span> zarr_meas[tc_green].where(valid_mask)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>blu <span class="op">=</span> zarr_meas[tc_blue].where(valid_mask)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualising the green band:</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>plt.imshow(gre)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Green Reflectance (b03)'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>Text(0.5, 1.0, 'Green Reflectance (b03)')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="61_sardinia_s2_tfci_files/figure-html/cell-12-output-2.png" width="432" height="431" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The next step is to clip the retrieved asset to our area of interest which we defined earlier with specific bounding box information. We can apply the <code>mask_sub_utm()</code> function, which will masks the three bands to the defined bounding box.</p>
<p>It is important to point out that until now, we have not accessed on disk the data. Once we add the <code>.values</code> argument to the resulting _ from <code>mask_sub_utm()</code>, the data is accessed.</p>
<p><code>.zarr</code> contains <strong>x</strong> and <strong>y</strong> information for each of the pixels, and storing these values for a further geolocalisation of our item of interest is essential.</p>
<p>You can visualise the <strong>blue</strong> (B02) band to verify the clipped area.</p>
<div id="36" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The mask_sub_utm() function takes the bands and masks them to the valid rows and columns from the bbox_mask</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>red <span class="op">=</span> mask_sub_utm(red,rows, cols).values</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>gre <span class="op">=</span> mask_sub_utm(gre,rows, cols).values</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>blu <span class="op">=</span> mask_sub_utm(blu,rows, cols).values</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The zarr_meas group is the input dataset containing the dimensions</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># by slicing the 'y' dimension array based on the minimum and maximum row indices</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>y_zarr <span class="op">=</span> zarr_meas[<span class="st">'y'</span>].isel(y<span class="op">=</span><span class="bu">slice</span>(rows.<span class="bu">min</span>(), rows.<span class="bu">max</span>() <span class="op">+</span> <span class="dv">1</span>)).values</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># also, the same for the 'x' dimension array based on the minimum and maximum column indices</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>x_zarr <span class="op">=</span> zarr_meas[<span class="st">'x'</span>].isel(x<span class="op">=</span><span class="bu">slice</span>(cols.<span class="bu">min</span>(), cols.<span class="bu">max</span>() <span class="op">+</span> <span class="dv">1</span>)).values</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># We transform the original x,y bbox from our clip to decimal degree coordinates</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>map_ext_deg_pre <span class="op">=</span> <span class="bu">list</span>(t_utm_to_deg.transform(np.nanmin(x_zarr),np.nanmin(y_zarr)) <span class="op">+</span> </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>                   t_utm_to_deg.transform(np.nanmax(x_zarr),np.nanmax(y_zarr)))</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualising the clipped red band:</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>plt.imshow(blu)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Clipped Blue Reflectance (b02)'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>Text(0.5, 1.0, 'Clipped Blue Reflectance (b02)')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="61_sardinia_s2_tfci_files/figure-html/cell-13-output-2.png" width="552" height="431" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>To create the composite image, we need to <strong>normalise</strong> each of the input assets. Normalisation ensures that the bands have a consistent and predictable range of values. This supports optimal data processing and removes the influence of external factors (like changing light conditions) allowing for a meaningful comparison among generated composites.</p>
<p>The <code>normalisation_str_gm()</code> function achieves this by scaling the reflectance values to a standard range (0-255) using the percentile-based method.</p>
<p>Once the values for our three bands have been normalised, they can be stacked in an <strong>RGB</strong> format to generate the initial True Colour Image (TCI).</p>
<div id="38" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Input: percentile range for contrast stretching</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>contrast_stretch_percentile<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">98</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Input: gamma correction value</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>gamma<span class="op">=</span><span class="fl">1.8</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply normalisation to the red, green and blue bands using the specified percentile and gamma values</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>red_processed <span class="op">=</span> normalisation_str_gm(red, <span class="op">*</span>contrast_stretch_percentile, gamma)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>green_processed <span class="op">=</span> normalisation_str_gm(gre, <span class="op">*</span>contrast_stretch_percentile, gamma)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>blue_processed <span class="op">=</span> normalisation_str_gm(blu, <span class="op">*</span>contrast_stretch_percentile, gamma)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># We stack the processed red, green, and blue arrays</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>rgb_composite_sm <span class="op">=</span> np.dstack((red_processed, green_processed, blue_processed)).astype(np.float32)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>plt.imshow(rgb_composite_sm)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'RGB Composite'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>Text(0.5, 1.0, 'RGB Composite')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="61_sardinia_s2_tfci_files/figure-html/cell-14-output-2.png" width="552" height="431" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The image is currently displayed with a neutral colour ramp and with the non-valid masked pixels. Some of the details can be enhanced based on the information the overall composite contains.</p>
<p>For this, we can apply a <strong>histogram equalisation</strong>. This technique will adjust the brightness and improve the visibility of details within our image. <br> Through the <code>skimage</code> library, we can apply the <code>exposure.equalize_adapthist()</code> function. This method creates a more natural-looking and visually balanced composite.</p>
<div id="40" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding equalisation from skimage:</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>fire_tc <span class="op">=</span> exposure.equalize_adapthist(rgb_composite_sm)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>plt.imshow(fire_tc)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Equalised Composite'</span>) <span class="co"># Add a title for clarity</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>Text(0.5, 1.0, 'Equalised Composite')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="61_sardinia_s2_tfci_files/figure-html/cell-15-output-2.png" width="552" height="431" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="pre-fire-false-colour-image" class="level3">
<h3 class="anchored" data-anchor-id="pre-fire-false-colour-image">Pre-Fire False Colour Image</h3>
<p>Next, a <strong>False Colour Image</strong> (FCI) is created to provide a clearer overview of vegetation health.<br></p>
<p>This image uses the <strong>Shortwave Infrared</strong> (B12), <strong>Near-Infrared</strong> (B8a), and <strong>Blue</strong> (B02) bands. This specific combination enhances the distinction between <strong>healthy vegetation</strong>, which appears <strong>green</strong>, and <strong>damaged</strong> or <strong>burnt</strong> areas, which are shown in vivid, <strong>contrasting colours</strong>.</p>
<p>This False Colour composite will help us to better highlight the full extent of the fire.</p>
<div id="43" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The false colour channels we are interested to retrieve coposite:</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>fc_swir <span class="op">=</span> <span class="st">'b12'</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>fc_nir <span class="op">=</span>  <span class="st">'b8a'</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>fc_blue <span class="op">=</span> <span class="st">'b02'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Following the same principle as of the creation of the True Colour composite, we can choose the relevant bands and apply the masking and clipping steps.</p>
<div id="45" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The zarr_meas object is the input dataset containing the bands, fc_red, fc_green, fc_blue specify the bands</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The where() method is used to apply the boolean valid_mask to the bands</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>swir <span class="op">=</span> zarr_meas[fc_swir].where(valid_mask)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>nir <span class="op">=</span>  zarr_meas[fc_nir].where(valid_mask)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>blu <span class="op">=</span>  zarr_meas[fc_blue].where(valid_mask)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The mask_sub_utm() function takes the bands and masks them to the specified rows and columns</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>swir <span class="op">=</span> mask_sub_utm(swir,rows, cols).values</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>nir <span class="op">=</span> mask_sub_utm(nir,rows, cols).values</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>blu <span class="op">=</span> mask_sub_utm(blu,rows, cols).values</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Then, we can apply the normalisation function, followed by the stacking of the three bands. The False Colour composite $$$ explain the colouring</p>
<div id="47" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the normalisation function to each band</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>swir_processed <span class="op">=</span> normalisation_str_gm(swir, <span class="op">*</span>contrast_stretch_percentile, gamma)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>nir_processed <span class="op">=</span> normalisation_str_gm(nir, <span class="op">*</span>contrast_stretch_percentile, gamma)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>blue_processed <span class="op">=</span> normalisation_str_gm(blu, <span class="op">*</span>contrast_stretch_percentile, gamma)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Use np.dstack to create a false-colour composite from the processed bands</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>false_composite<span class="op">=</span> np.dstack((swir_processed, nir_processed, blue_processed)).astype(np.float32)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Output:</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>plt.imshow(false_composite)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'False Composite'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>Text(0.5, 1.0, 'False Composite')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="61_sardinia_s2_tfci_files/figure-html/cell-18-output-2.png" width="552" height="431" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We then continue and also apply the equalisation function.</p>
<div id="49" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply adaptive histogram equalisation to enhance contrast for fire detection</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fire_fc <span class="op">=</span> exposure.equalize_adapthist(false_composite)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure to plot</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>plt.imshow(fire_fc)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Equalised False Composite'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>Text(0.5, 1.0, 'Equalised False Composite')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="61_sardinia_s2_tfci_files/figure-html/cell-19-output-2.png" width="552" height="431" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="post-fire-visualisation" class="level2">
<h2 class="anchored" data-anchor-id="post-fire-visualisation">Post-Fire Visualisation</h2>
<p>Now, we will replicate the same visualisation for a specific time after the fire: 10 June 2025. Considering this new date, we will retrieve images from the same collection that correspond to our new timeframe of interest.</p>
<div id="52" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>date_post <span class="op">=</span> post_f <span class="op">+</span> <span class="st">'T00:00:00Z/'</span> <span class="op">+</span> post_f <span class="op">+</span> <span class="st">'T23:59:59.999999Z'</span> <span class="co"># interest period</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>s2_post <span class="op">=</span> <span class="bu">list</span>(eopf_catalog.search(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                bbox<span class="op">=</span> search_bbox, </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                datetime<span class="op">=</span> date_post,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                collections<span class="op">=</span>def_collection).item_collection())</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>av_urls <span class="op">=</span> [item.assets[<span class="st">"product"</span>].href <span class="cf">for</span> item <span class="kw">in</span> s2_post]</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>av_urls</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>['https://objects.eodc.eu:443/e05ab01a9d56408d82ac32d69a5aae2a:202506-s02msil2a/21/products/cpm_v256/S2C_MSIL2A_20250621T100611_N0511_R022_T32TMK_20250623T084315.zarr']</code></pre>
</div>
</div>
<p>We open again the the retrieved item from our filtered results, followed by the masking and validation steps to ensure a clean, cloud-free composite.</p>
<div id="54" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>post_zarr <span class="op">=</span> xr.open_datatree(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    av_urls[<span class="dv">0</span>], engine<span class="op">=</span><span class="st">"zarr"</span>, <span class="co">#we always get the earliest one (last)</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    chunks<span class="op">=</span>{},</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    decode_timedelta<span class="op">=</span><span class="va">False</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>zarr_meas <span class="op">=</span> post_zarr.measurements.reflectance.r20m</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Extractthe cloud free mask at 20m resolution:</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>l2a_class_20m <span class="op">=</span> post_zarr.conditions.mask.l2a_classification.r20m.scl</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>valid_mask <span class="op">=</span> validate_scl(l2a_class_20m)  <span class="co"># Boolean mask (10980x10980)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="post-fire-true-colour-image" class="level3">
<h3 class="anchored" data-anchor-id="post-fire-true-colour-image">Post-Fire True Colour Image</h3>
<p>Once invalid pixels are filtered out, we can generate the corresponding True-Color composite to get a view of our area of interest after the fire event. We again clip the retrieved assets to our specific bounding box.</p>
<div id="57" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create UTM masks for rows and columns based on the bounding box.</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>cols_post, rows_post <span class="op">=</span> zarr_mask_utm(bbox_utm, zarr_meas)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the red, green, and blue bands and apply the valid mask.</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>red <span class="op">=</span> zarr_meas[tc_red].where(valid_mask)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>gre <span class="op">=</span>  zarr_meas[tc_green].where(valid_mask)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>blu <span class="op">=</span>  zarr_meas[tc_blue].where(valid_mask)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Mask and clip the selected bands using the row and column indices.</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>red <span class="op">=</span> mask_sub_utm(red,rows_post, cols_post).values</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>gre <span class="op">=</span> mask_sub_utm(gre,rows_post, cols_post).values</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>blu <span class="op">=</span> mask_sub_utm(blu,rows_post, cols_post).values</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Slice the y-dimension values using the new row indices.</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>y_zarr <span class="op">=</span> zarr_meas[<span class="st">'y'</span>].isel(y<span class="op">=</span><span class="bu">slice</span>(rows_post.<span class="bu">min</span>(), rows_post.<span class="bu">max</span>() <span class="op">+</span> <span class="dv">1</span>)).values</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Slice the x-dimension values using the new column indices.</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>x_zarr <span class="op">=</span> zarr_meas[<span class="st">'x'</span>].isel(x<span class="op">=</span><span class="bu">slice</span>(cols_post.<span class="bu">min</span>(), cols_post.<span class="bu">max</span>() <span class="op">+</span> <span class="dv">1</span>)).values</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co"># We transform the original x,y bbox from our clip to decimal degree coordinates</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>map_ext_deg_post <span class="op">=</span> <span class="bu">list</span>(t_utm_to_deg.transform(np.nanmin(x_zarr),np.nanmin(y_zarr)) <span class="op">+</span> </span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>                   t_utm_to_deg.transform(np.nanmax(x_zarr),np.nanmax(y_zarr)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>And, once the new area is defined, we normalise, stack and equalize the composite.</p>
<div id="59" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply normalisation and gamma correction to the red, green, and blue bands.</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>red_processed <span class="op">=</span> normalisation_str_gm(red, <span class="op">*</span>contrast_stretch_percentile, gamma)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>green_processed <span class="op">=</span> normalisation_str_gm(gre, <span class="op">*</span>contrast_stretch_percentile, gamma)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>blue_processed <span class="op">=</span> normalisation_str_gm(blu, <span class="op">*</span>contrast_stretch_percentile, gamma)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack the processed bands to create a single true-colour composite image.</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>rgb_composite_sm <span class="op">=</span> np.dstack((red_processed, green_processed, blue_processed)).astype(np.float32)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply adaptive histogram equalisation to enhance the composite image.</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>tc_post <span class="op">=</span> exposure.equalize_adapthist(rgb_composite_sm)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>plt.imshow(tc_post)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Equalised Composite'</span>) <span class="co"># Add a title for clarity</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>Text(0.5, 1.0, 'Equalised Composite')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="61_sardinia_s2_tfci_files/figure-html/cell-23-output-2.png" width="552" height="431" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="post-fire-false-colour-image" class="level3">
<h3 class="anchored" data-anchor-id="post-fire-false-colour-image">Post-Fire False Colour Image</h3>
<p>And as the last processing step, we create the False Colour composite for the same day, to clearly visualise the extent of the burn scars and vegetation recovery.</p>
<div id="62" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the red, green, and blue bands and apply the valid mask.</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>swir <span class="op">=</span> zarr_meas[fc_swir].where(valid_mask)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>nir <span class="op">=</span>  zarr_meas[fc_nir].where(valid_mask)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>blu <span class="op">=</span>  zarr_meas[fc_blue].where(valid_mask)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Mask and clip the selected bands using the row and column indices.</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>swir <span class="op">=</span> mask_sub_utm(swir,rows_post, cols_post).values</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>nir <span class="op">=</span> mask_sub_utm(nir,rows_post, cols_post).values</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>blu <span class="op">=</span> mask_sub_utm(blu,rows_post, cols_post).values</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply normalisation and gamma correction to the red, green, and blue bands.</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>swir_processed <span class="op">=</span> normalisation_str_gm(swir, <span class="op">*</span>contrast_stretch_percentile, gamma)</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>nir_processed <span class="op">=</span> normalisation_str_gm(nir, <span class="op">*</span>contrast_stretch_percentile, gamma)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>blue_processed <span class="op">=</span> normalisation_str_gm(blu, <span class="op">*</span>contrast_stretch_percentile, gamma)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack the processed bands to create a single false-colour composite image.</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>false_composite<span class="op">=</span> np.dstack((swir_processed, nir_processed, blue_processed)).astype(np.float32)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply adaptive histogram equalisation to enhance the composite image.</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>fc_post <span class="op">=</span> exposure.equalize_adapthist(false_composite)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>plt.imshow(fc_post)</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Equalised Composite'</span>) <span class="co"># Add a title for clarity</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>Text(0.5, 1.0, 'Equalised Composite')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="61_sardinia_s2_tfci_files/figure-html/cell-24-output-2.png" width="552" height="431" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="compare-pre--and-post-fire-composites" class="level2">
<h2 class="anchored" data-anchor-id="compare-pre--and-post-fire-composites">Compare pre- and post-fire composites</h2>
<p>As a last step, we will <strong>georeference</strong> and <strong>visualise</strong> the created composites together, presenting it in a way that makes it easier to recognise and understand the monitored areas.</p>
<p>We will use the <code>cartopy</code> library to pinpoint the location of our georeferenced datasets based on their CRS and geospatial bounding box. The visualisation will be a 2x2 matrix, offering a comprehensive, multi-channel overview.<br></p>
<p>Finally, the plot will be enhanced by adding key elements such as grid lines for improved geolocation, a clear title, and a bounding box to highlight the specific area of the fire. This approach allows for a direct visual comparison of the landscape’s state before and after the event.</p>
<div id="65" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>data_ll <span class="op">=</span> ccrs.PlateCarree()</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">9</span>), subplot_kw<span class="op">=</span>{<span class="st">'projection'</span>: data_ll})</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Pre fire TCI</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> axs[<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>ax1.imshow(fire_tc, origin<span class="op">=</span><span class="st">'upper'</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>                extent<span class="op">=</span>[map_ext_deg_pre[<span class="dv">0</span>],map_ext_deg_pre[<span class="dv">2</span>],</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>                        map_ext_deg_pre[<span class="dv">1</span>],map_ext_deg_pre[<span class="dv">3</span>]],  <span class="co"># item</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>                transform<span class="op">=</span>data_ll)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>ax1.add_geometries(map_box, crs<span class="op">=</span>data_ll, facecolor<span class="op">=</span><span class="st">'none'</span>, </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>                   edgecolor<span class="op">=</span><span class="st">'yellow'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">'-'</span>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>ax1.gridlines(draw_labels<span class="op">=</span><span class="va">True</span>, dms<span class="op">=</span><span class="va">True</span>, x_inline<span class="op">=</span><span class="va">False</span>, y_inline<span class="op">=</span><span class="va">False</span>) <span class="co"># gridlines and labels</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="ss">f'TCI for </span><span class="sc">{</span>pre_f<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Pre fire FCI</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> axs[<span class="dv">0</span>,<span class="dv">1</span>]</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>ax2.imshow(fire_fc, origin<span class="op">=</span><span class="st">'upper'</span>,</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>                extent<span class="op">=</span>[map_ext_deg_pre[<span class="dv">0</span>],map_ext_deg_pre[<span class="dv">2</span>],</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>                        map_ext_deg_pre[<span class="dv">1</span>],map_ext_deg_pre[<span class="dv">3</span>]],  <span class="co"># item</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>                transform<span class="op">=</span>data_ll)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>ax2.add_geometries(map_box, crs<span class="op">=</span>data_ll, facecolor<span class="op">=</span><span class="st">'none'</span>, </span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>                   edgecolor<span class="op">=</span><span class="st">'yellow'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">'-'</span>)</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>ax2.gridlines(draw_labels<span class="op">=</span><span class="va">True</span>, dms<span class="op">=</span><span class="va">True</span>, x_inline<span class="op">=</span><span class="va">False</span>, y_inline<span class="op">=</span><span class="va">False</span>) <span class="co"># gridlines and labels</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="ss">f'FCI for </span><span class="sc">{</span>pre_f<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="co">#Post fire TCO</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> axs[<span class="dv">1</span>,<span class="dv">0</span>]</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>ax3.imshow(tc_post, origin<span class="op">=</span><span class="st">'upper'</span>,</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>                extent<span class="op">=</span>[map_ext_deg_post[<span class="dv">0</span>],map_ext_deg_post[<span class="dv">2</span>],</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>                        map_ext_deg_post[<span class="dv">1</span>],map_ext_deg_post[<span class="dv">3</span>]],  <span class="co"># item</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>                transform<span class="op">=</span>data_ll)</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>ax3.add_geometries(map_box, crs<span class="op">=</span>data_ll, facecolor<span class="op">=</span><span class="st">'none'</span>, </span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>                   edgecolor<span class="op">=</span><span class="st">'yellow'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">'-'</span>)</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>ax3.gridlines(draw_labels<span class="op">=</span><span class="va">True</span>, dms<span class="op">=</span><span class="va">True</span>, x_inline<span class="op">=</span><span class="va">False</span>, y_inline<span class="op">=</span><span class="va">False</span>) <span class="co"># gridlines and labels</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="ss">f'TCI for </span><span class="sc">{</span>post_f<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Post fire FCI</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>ax4 <span class="op">=</span> axs[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>ax4.imshow(fc_post, origin<span class="op">=</span><span class="st">'upper'</span>,</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>                extent<span class="op">=</span>[map_ext_deg_post[<span class="dv">0</span>],map_ext_deg_post[<span class="dv">2</span>],</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>                        map_ext_deg_post[<span class="dv">1</span>],map_ext_deg_post[<span class="dv">3</span>]],  <span class="co"># item</span></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>                transform<span class="op">=</span>data_ll)</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>ax4.add_geometries(map_box, crs<span class="op">=</span>data_ll, facecolor<span class="op">=</span><span class="st">'none'</span>, </span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>                   edgecolor<span class="op">=</span><span class="st">'yellow'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">'-'</span>)</span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>ax4.gridlines(draw_labels<span class="op">=</span><span class="va">True</span>, dms<span class="op">=</span><span class="va">True</span>, x_inline<span class="op">=</span><span class="va">False</span>, y_inline<span class="op">=</span><span class="va">False</span>) <span class="co"># gridlines and labels</span></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>ax4.set_title(<span class="ss">f'FCI for </span><span class="sc">{</span>post_f<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the layout to prevent titles from overlapping</span></span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="ss">f'Sentinel-2 L2A TCI and FCI'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the combined plot</span></span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="61_sardinia_s2_tfci_files/figure-html/cell-25-output-1.png" width="1255" height="787" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="calculating-processing-time" class="level2">
<h2 class="anchored" data-anchor-id="calculating-processing-time">Calculating processing time</h2>
<div id="67" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>et <span class="op">=</span> time.time()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>total_t <span class="op">=</span> et <span class="op">-</span> st</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Total Running Time: '</span>, total_t,<span class="st">' seconds'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total Running Time:  72.35032558441162  seconds</code></pre>
</div>
</div>
<p>As our plots show, the <strong>True Colour Image</strong> reveals a clear change in the state of the vegetation, with an evident burn scar visible on the ground. The <strong>False Colour Image</strong> also highlights a significant change in the spectral response, which precisely encloses the spot where the fire occurred.<br></p>
<p>It is important to note the efficiency of this monitoring workflow. The entire process from defining the area of interest to searching, accessing, processing, and visualising the data takes less than a minute, without the need to download data.</p>
<hr>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Having processed the key spectral bands, we have successfully established a visual baseline for <strong>our monitoring workflow</strong>.<br></p>
<p>The generation of these composites allows us to quickly gain an overview of the spatial changes resulting from a fire event, as observed by <strong>Sentinel-2 L-2A</strong>.</p>
<p>This workflow is <strong>highly replicable</strong>, enabling us to replicate these defined steps at various points in time. This ability to generate consistent visualisations will allow us to understand the full dynamics of a <strong>fire’s event lifecycle</strong> over time, from its beginning to the subsequent recovery of the landscape.</p>
<hr>
</section>
<section id="whats-next" class="level2">
<h2 class="anchored" data-anchor-id="whats-next">What’s next?</h2>
<p>In the <a href="./62_sardinia_s3_lst.html">next tutorial</a>, we will apply the workflow we have generated to create a <strong>True Colour Image</strong> from <strong>Sentinel-2 L2A</strong> data for the day of the fire.</p>
<p>To obtain a more detailed overview of the fire’s state, we will integrate a new dataset into our workflow: <strong>Sentinel-3</strong> data. This will enable us to analyse thermal information and pinpoint the active fire’s location.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./44_eopf_stac_xarray_tutorial.html" class="pagination-link" aria-label="From STAC to Data: Accessing EOPF Zarr with xarray">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">From STAC to Data: Accessing EOPF Zarr with xarray</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./62_sardinia_s3_lst.html" class="pagination-link" aria-label="Fire in Sardinia 2025 - Part 2">
        <span class="nav-page-text"><span class="chapter-title">Fire in Sardinia 2025 - Part 2</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Development Seed, thriveGEO and SparkGeo</p>
</div>   
    <div class="nav-footer-center">
<p>License: Apache 2.0</p>
</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link active" href="https://github.com/eopf-toolkit/eopf-101" aria-current="page">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>